---
title: Reduce application image size by using artifacts
sidebar: reference
permalink: artifact.html
---

Артефакт (artifact) — это набор правил для сборки образа с файловым ресурсом (образа артефакта), который затем используется в одном или нескольких образах приложений. Образ артефакта не используется и не остается после окончания процесса сборки образов приложений, он нужен для изолирования процесса сборки ресурсов, или инструментов сборки (среды, программного обеспечение, данных) от процесса сборки образов приложений, использующих эти ресурсы или инструменты.

Количество артефактов, описываемых в одном dappfile строго не ограничено

Основное различие при использовании разного синтаксиса dappfile в части описания артефактов - в случае с YAML синтаксисом доступен только импорт артефакта, в случае же с ruby синтаксисом, доступен как вариант описания импорта артефакта в образ приложения так и описание экспорта артефакта из образа артефакта.

## Правила использования

* пути добавления не должны пересекаться между артефактами
* изменение любого параметра артефакта ведёт к смене сигнатур, пересборке связанных [стадий](stages.html#стадия) приложения
* приложение может содержать любое количество артефактов
* артефакты обязаны иметь имя
* имена образов приложений и образов артефактов должны различаться


## Синтаксис

Описание образа артефакта выполняется с помощью директивы `artifact: <name>`, где `<name>` - обязательное имя артефакта. Имя артефакта используется для указания артефакта по имени в описании образа приложения, при импорте файлов из артефакта в образ приложения. При использовании YAML синтаксиса доступен только импорт из артефакта (отсутствует директива `export`).

Указание базового образа при описании образа приложения или образа артефакта выполняется с помощью обязательной директивы `from: <DOCKER_IMAGE>`, где `<DOCKER_IMAGE>` - имя образа в формате `image:tag` (tag может отсутствовать, тогда используется latest). Как и при описании образов приложений, описание нескольких образов артефактов выполняется линейно - друг за другом, отделяются строкой состоящей из последовательности `---` (согласно YAML спецификации).

Использование артефакта в образе приложения описывается с помощью директивы `import:`, которая представляет собой массив следующих элементов:
* `artifact: ARTIFACT_NAME`, где `ARTIFACT_NAME` - имя артефакта, из которого необходимо скопировать файлы в образ приложения;
* `add: SOURCE_DIRECTORY_TO_IMPORT`, где `SOURCE_DIRECTORY_TO_IMPORT` - путь в образе артефакта к файлу или папке, которые должны быть скопированы в образ приложения;
* `to: DESTINATION_DIRECTORY`, где `DESTINATION_DIRECTORY` - путь в образе приложения, куда должны быть скопированы файлы из образа артефакта. Необязательный элемент, в случае отсутствия принимается равным значению `SOURCE_DIRECTORY_TO_IMPORT`;
* `before: STAGE | after: STAGE`, где `STAGE` - стадия `install` или `setup`, соответственно до (`before`) или после (`after`) которой необходимо импортировать файлы артефакта в образ.

### Пример использования артефакта
```
import:
- artifact: application-assets
  add: /app/public/assets
  after: install
- artifact: application-assets
  add: /vendor
  to: /app/vendor
  before: setup
```

### Пример описания образа приложения с использованием артефакта

В следующем примере используется описание образа приложения и образа артефакта. В артефакте создается файл, который импортируется в образ `application`, и на стадии setup выводится его содержимое.

```
artifact: assets
from: alpine
shell:
  install:
  - mkdir /tmp/asset-files
  - echo 'Artifact file for import' >/tmp/asset-files/asset
---
dimg: application
from: ubuntu:16.04
import:
  - artifact: assets
    add: /tmp/asset-files
    to: /app
    after: install
shell:
  setup:
    - cat /app/asset
```
