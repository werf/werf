---
title: Cобрать dimg
sidebar: reference
permalink: dimg_build.html
folder: command
---

### dapp dimg build
Собрать dimg-ы, удовлетворяющие хотя бы одному из **DIMG**-ов (по умолчанию *).

```
dapp dimg build [options] [DIMG ...]
```

#### Опции среды сборки

##### `--dir PATH`
Определяет директорию, которая используется при поиске **dappfile**.

По умолчанию поиск ведётся в текущей директории пользователя.

##### `--build-dir PATH`
Переопределяет директорию хранения кэша, который может использоваться между сборками. Значение по умолчанию - `~/.dapp/builds/<project-name>`. Изменение опции build-dir не ведет к изменениям в системе именования helm-релизов и docker-образов, поэтому это безопасное изменение.

##### `--tmp-dir-prefix PREFIX`
Переопределяет префикс временной директории, файлы которой используются только во время сборки.

##### `--name NAME`
Переопределяет [имя проекта dapp](definitions.html#имя-dapp). По умолчанию, имя проекта — это последний элемент пути к git репозиторию из параметра конфигурации remote.origin.url или, при отсутствии git или параметра конфигурации remote.origin.url, это имя [директории dapp](definitions.html#директория-dapp).

**Важно:** Изменение имени ранее собранного проекта приведет к тому, что кэш проекта будет пересобран заново. Также, будет изменено имя релиза в helm, поэтому указывать `--name` надо только при возникающей необходимости, когда есть например конфликтующее имя проекта в другой группе. `--build-dir` будет изменен автоматически, при условии, что опция `--build-dir` не указана (см описании опции `--build-dir` [выше](#build-dir-path).

При переопределении имени проекта в `dapp dimg build`, его следует переопределять и впоследствии, например при вызове команд `dapp dimg push`, `dapp dimg cleanup`, `dapp kube deploy`.

Использование опции `--name` может быть нужно, если например в рамках одного GitLab в разных группах конфликтуют имена проектов. В этом случае надо обязательно использовать опцию `--name`, в которой указать составленное уникальное имя проекта (например `<имя-группы>_<имя-проекта>`).

##### `--ssh-key SSH_KEY`
Позволяет указать ssh ключ для доступа к удаленному репозиторию, вместо используемого по умолчанию ssh-agent.

В случае, если явно не указана опция `--ssh-key` и не запущен системный ssh-agent (проверяется по переменной окружения SSH_AUTH_SOCK), dapp автоматически запускает временный ssh-agent и добавляет в него ключи по умолчанию - ~/.ssh/id_rsa, ~/.ssh/id_dsa. Данный агент будет использоваться для операций с git, chef berks, в сборочных контейнерах.

#### Опции логирования и отладки

##### `--dev`
Включает [режим разработчика](debug_for_advanced_build.html#режим-разработчика).

##### `--dry-run`
Позволяет запустить сборщик вхолостую и посмотреть процесс сборки.

##### `--ignore-config-sequential-processing-warnings`
Отключает вывод предупреждений при обработке dappfile.

##### `-q, --quiet`
Отключает логирование.

##### `--color MODE`
Отвечает за регулирование цвета при выводе в терминал.

Существует несколько режимов (**MODE**): **on**, **off**, **auto**.

По умолчанию используется **auto**, который окрашивает вывод, если вывод производится непосредственно в терминал.

##### `--build-context-directory DIR_PATH`
Включает сохранение контекста при неудачной сборке, а также определяет директорию сохранения.

##### `--use-system-tar`
При указании опции `--use-system-tar`, для создания tar-архивов будет использоваться вызов системной команды `tar`, вместо используемой по умолчанию ruby библиотеки `tar_writer`. Библиотека `tar_writer` накладывает ряд ограничений, и иногда ее использование может приводить к ошибкам (например такой - `File "XXX" has a too long name (should be 100 or less)`).

##### `--time`
Добавляет время каждому событию лога.

##### `--lock-timeout TIMEOUT`
Определяет таймаут ожидания заблокированных ресурсов в секундах (по умолчанию - 86400 секунд, т.е. 24 часа).

Если в параллельно запущенных сборках разных проектов в одинаковых стадиях присутствует одинаковый набор инструкций (например одинаковая стадия beforeInstall), то сигнатура образа стадии будет одинаковая. В этой ситуации два запущенных параллельно процеса dapp не будут собирать один и тот же образ (в этом нет смысла - результат обоих сборок будет одинаков). Сборка будет осуществляться первым запущенным процессом, а второй процесс будет ожидать окончания сборки до достижения таймаута.

#### Опции интроспекции
Позволяют поработать с образом на определённом этапе сборки. [Узнайте больше](debug_for_advanced_build.html), о работе с опциями интроспекции.

##### `--introspect-stage STAGE`, `--introspect-artifact-stage STAGE`
Интроспекция собранной стадии STAGE, т.е. после успешного прохождения стадии **STAGE** (`--introspect-artifact-stage` - используется для образа артефакта).

##### `--introspect-before STAGE`, `--introspect-artifact-before STAGE`
Интроспекция до выполнения инструкций стадии STAGE (`--introspect-artifact-before` - используется для образа артефакта).

##### `--introspect-before-error`
Интроспекция стадии предшествующей той, на которой произошла ошибка.

##### `--introspect-error`
Интроспекция стадии на которой произошла ошибка, сразу после исполнения завершившейся ошибкой команды.

#### Примеры

##### Сборка в текущей директории
```bash
$ dapp dimg build
```

##### Сборка dimg-ей из соседней директории
```bash
$ dapp dimg build --dir ../project
```

##### Запуск вхолостую с выводом процесса сборки
```bash
$ dapp dimg build --dry-run
```

##### Выполнить сборку, а в случае ошибки, предоставить образ для тестирования
```bash
$ dapp dimg build --introspect-error
```

##### Выполнить сборку, а в случае ошибки, сохранить контекст сборки в директории 'context'
```bash
$ dapp dimg build --build-context-directory context
```
