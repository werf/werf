---
title: Базовые определения
sidebar: doc_sidebar
permalink: definitions.html
folder: definition
---

### Dapp
Dapp — это проект, который:

* содержит код приложения или нескольких приложений;
* описывает правила сборки docker-образов для этих приложений;
* описывает правила развертывания docker-образов.

### dappfile
dappfile — файл описания правил сборки и развертывания приложений проекта.

dappfile может быть двух типов:
- Dappfile - для языка описания — Ruby.
- dappfile.yaml или dappfile.yml — для языка описания YAML.

Правила поиска dappfile в [директории dapp](#директория-dapp):
- dappfile.yml
- dappfile.yaml
- Dappfile

### Директория dapp
Директория dapp — это директория, содержащая [dappfile](#dappfile).

### Имя dapp
Имя dapp — это последний элемент пути к git репозиторию из параметра конфигурации remote.origin.url или, при отсутствии git или параметра конфигурации remote.origin.url, это имя [директории dapp](#директория-dapp). Можно переопределить с помощью опции `--name`.

### Dimg
Dimg — это именованный набор правил для сборки одного образа. Также dimg или образ dimg — это сам образ, собранный по данным правилам.

### Группа dimg
Группа dimg — это неименованный набор правил для сборки образов, который наследуется:

* другой группой dimg или
* одним или несколькими [dimg](#dimg).

Актуально только в Dappfile (см [подробнее](#dappfile) про типы dappfile).

### Scratch dimg
Scratch dimg — это образ состоящий из одного docker-слоя с файловыми ресурсами, объявленными пользователем dapp.

* Базовый образ не указывается.
* [Файловые ресурсы](#файловый-ресурс-артефакта) добавляются в итоговый образ с помощью функционала [артефактов](#артефакт).

### Артефакт
Артефакт (artifact) — это набор правил для сборки образа с [файловым ресурсом](#файловый-ресурс-артефакта), который импортируется в [dimg](#dimg).

Также артефакт или образ артефакта — это сам образ, собранный по данным правилам.

Используется для изолирования процесса сборки и инструментов сборки (среды, программного обеспечение, данных) ресурсов от образов, использующих эти ресурсы.

В один [dimg](#dimg) или [группу dimg](#группа-dimg) может быть добавлено произвольное количество артефактов.

#### Правила сборки

* Наследование правил сборки от [dimg](#dimg) или [группы dimg](#группа-dimg) происходит по тем же правилам, что и у [группы dimg](#группа-dimg).
* Стадии артефакта:
  * from
  * before_install
  * before_install_artifact
  * git_artifact_archive
  * git_artifact_pre_install_patch
  * install
  * git_artifact_post_install_patch
  * after_install_artifact
  * before_setup
  * before_setup_artifact
  * git_artifact_pre_setup_patch
  * setup
  * after_setup_artifact
  * git_artifact_artifact_patch
  * build_artifact
* Могут использоваться такие же директивы, как у dimg и dimg_group, но с некоторыми особенностями:
  * Для [docker](docker_directives.html) не используются директивы применения dockerfile-инструкций
  * Для shell dimg и [chef dimg](chef.html#chef-dimg) добавляется стадия build_artifact
    * Для [shell](shell_directives.html) добавляется директива [build_artifact](shell_directives.html#shell-build_artifact-<cmd>-<cmd>-cache_version-<cache_version>).
  * У артефакта не может быть потомков, поэтому отсутствуют директивы dimg, dimg_group и artifact.

### Файловый ресурс артефакта

Файловый ресурс артефакта — это экспортируемая артефактом директория с произвольными файлами внутри образа артефакта.

* Каждый артефакт имеет один файловый ресурс, путь к которому указывается при его описании через параметр export.
* При отсутствии директории в образе — считается, что это пустая директория (при импорте такого артефакта будет создана пустая директория).

### Кэш приложения FIXME

Набор docker-образов, который определяется [стадиями приложения](stages.html#стадия).

### Тип сборщика

Тип сборщика — это способ указания инструкций по сборке образа пользователем dapp.

Dapp поддерживает 3 [типа сборщика](#тип-сборщика): shell сборщик], [chef сборщик](chef.html#chef-сборщик) и [ansible сборщик](https://github.com/flant/dapp/blob/master/docs/rfc/yaml_with_ansible.md).

* В одном [dimg](#dimg) может быть использован один тип сборщика.
  * Соответственно существует 3 типа dimg: shell dimg, [Chef dimg](chef.html##chef-dimg) и [ansible dimg](https://github.com/flant/dapp/blob/master/docs/rfc/yaml_with_ansible.md).
* Тип сборщика определяется автоматически при первом использовании соответствующей инструкции в [dappfile](#dappfile).

### Shell проект

Shell проект — это проект, для сборки которого используются команды shell, заданные в [dappfile](#dappfile).

### Директория сборки dapp

Директория сборки dapp (build dir) — это директория для хранения кэша и производных данных сборки образов [dapp](#dapp).

* Используется для:
  * Хранения [дерева cookbooks](chef.html#дерево-cookbooks) в случае chef сборщика.
    * Этот результат при возможности кэшируется между сборками.
  * Кэширования [контрольных сумм стадий](chef.html#контрольная-сумма-cookbook’ов-стадии).
  * Хранения файлов блокировок проекта.
* Путь к build директории.
  * По умолчанию: `~/.dapp/builds/<[dapp name]>(#имя-dapp)`.
  * Переопределяется параметром `--build-dir`.
* Необходимо указывать одну и ту же build директорию для каждой из вызываемых команд dapp (или использовать путь к директории по умолчанию).
* При указании build директории необходимо иметь в виду, что для каждого [проекта](#проект) нужна отдельная директория.
* Одна и та же build директория используется всеми [приложениями](#приложение), описанными в данном [проекте](#проект).

### Временная директория приложения

Временная директория приложения (tmp dir) — это временная рабочая директория сборщика [приложения](#приложение).

* Создается для каждого [приложения](#приложение) во время сборки.
* Используется для хранения:
  * Склонированных remote git репозиториев.
  * [Стадий cookbook\`ов](chef.html#стадия-cookbook’а), [установленных](chef.html#установка-стадии-cookbook’а) для сборки стадии, [ansible playbook'ов](https://github.com/flant/dapp/blob/master/docs/rfc/yaml_with_ansible.md).
  * Артефактов.
* Путь к директории: /tmp/dapp-\<date\>-\<random\>.
* Удаление директории происходит автоматически при ожидаемом успешном или неуспешном завершении работы dapp.

### Режим разработки

* Включается опцией командной строки `--dev`.
* Используется для:
  * включения создания файла Berksfile.lock в случае его отсутствия (см. [cookbook приложения](chef.html#cookbook-dapp)).

[Подробнее](debug_for_advanced_build.html#режим-разработчика) про режим разработки.

### Блокировка ресурса

Блокировки обеспечивают корректную работу команд dapp при их параллельном запуске в рамках одного проекта на одном сервере.

* Блокировки реализованы с использованием механизма файловых блокировок ОС.
* Файлы блокировок хранятся в директории \<[build dir](#директория-сборки)\>/locks.

Для управления таймаутом ожидания блокировки в некоторых командах используется параметр `--lock-timeout TIMEOUT`.

### Внешняя директория сборки # TODO

Директория, которая монтируется в docker-контейнеры в процессе сборки [приложения](#приложение).

* Используется для уменьшения размера [кэша приложения](#кэш-приложения) и конечного образа приложения соответственно.
* Ожидается директория с данными порождаемыми в процессе сборки, которые:
  * не требуются конечному пользователю;
  * занимают значительный размер.
* Для добавления используются директивы [tmp_dir](base_directives.html#tmp_dir-<dir>-dir) и [build_dir](base_directives.html#build_dir-<dir>-dir), которые различаются местом размещения внешней директории.

### Scratch образ # TODO

Пустой docker образ, используемый в качестве окружения приложения по умолчанию, если пользователь не указал его ([docker.from](docker_directives.html#docker-from-<image>-cache_version-<cache_version>)).
