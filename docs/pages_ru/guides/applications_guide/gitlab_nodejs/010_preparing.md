---
title: Подготовка к работе
sidebar: applications_guide
guide_code: gitlab_nodejs
permalink: documentation/guides/applications_guide/gitlab_nodejs/010_preparing.html
layout: guide
toc: false
---
В этой главе мы рассмотрим, как подготовить приложение и инфраструктуру для того, чтобы можно было это приложение развернуть в Kubernetes.

Для того, чтобы переходить к следующей главе, у читателя должны быть

- Установлен Kubernetes
- На Kubernetes направлен траффик
- Установлен Gitlab
- Настроен раннер, на нём установлен werf, и с раннера есть доступ к кластеру Kubernetes
- Приложение соответствует требованиям для работы в Kubernetes

Ниже мы максимально кратко объясним, что мы имеем ввиду под каждым из этих пунктов.

## Требования к кластеру

Мы не предъявляем специальных требований к кластеру: вы можете развернуть его самостоятельно, воспользоваться предложением одного из облачных провайдеров или воспользоваться локальным minikube.

Объект Ingress описывается в нашем гайде в расчёте на nginx-ingress. Если вы используете другой контроллер — вам предстоит адаптировать конфигурацию самостоятельно.

## Домен

Мы предполагаем, что к началу прохождения гайда вы привязали к своёму кластеру какой-то домен.

{% offtopic title="Что это значит?" %}
Предполагается, что у вас есть домен. И к этому домену вы привязываете некий DNS-сервер, позволяющий настраивать [ресурсные записи DNS](https://ru.wikipedia.org/wiki/%D0%A2%D0%B8%D0%BF%D1%8B_%D1%80%D0%B5%D1%81%D1%83%D1%80%D1%81%D0%BD%D1%8B%D1%85_%D0%B7%D0%B0%D0%BF%D0%B8%D1%81%D0%B5%D0%B9_DNS). Он может быть предоставлен вашим регистратором, предоставляющим домен, или клауд-платформой, или, возможно, вы самостоятельно его установили и настраиваете (см. также [как работает DNS](https://firstwiki.ru/index.php/%D0%9A%D0%B0%D0%BA_%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D0%B0%D0%B5%D1%82_DNS))
Также, у вашего кластера есть какие-то IP адреса, на которых он отвечает.

Вам нужно прописать правильные A-записи в DNS-сервере, чтобы нужные домены были направлены на кластер.
{% endofftopic %}

В гайде мы будем использовать следующие домены:

- mydomain.io — направлен на кластер
- *.mydomain.io — направлен на кластер
- registry.mydomain.io — для gitlab registry
- gitlab.mydomain.io — для gitlab

## Требования к Gitlab

Мы предполагаем, что в Gitlab будет включён Gitlab CI и Registry.
Для прохождения гайда не обязательна собственная установка Gitlab — можно ограничиться заведением учётной записи на gitlab.com.

## Требования к раннеру

{% offtopic title="Что такое раннер?" %}
Под термином "раннер" зачастую подразумевают три вещи:

- CLI-утилиту, которая устанавливается куда-то в кластере и осуществляет запуск сценария сборки и деплоя
- Настройки, которые делаются в Gitlab CI в связи с установкой CLI-утилиты на какой-то из серверов
- Выделенный сервер (если такой есть), на котором запускается CLI-утилита
{% endofftopic %}

Есть несколько вариантов установки и настройки раннера: он может быть установлен на отдельном сервере, на нескольких серверах или запускаться на динамически создаваемых узлах. В гайде будет рассматриваться самый простой сценарий — использование одного узла.

{% offtopic title="Как быть с более сложными конфигурациями раннеров?" %}
На данный момент Werf поддерживает [распределённый режим сборки](https://ru.werf.io/documentation/guides/switch_to_distributed_mode.html).
При необходимости есть возможность сделать образ с Werf и запускать его внутри docker. Готовый docker-образ со всем необходимым сейчас находится в разработке.  

Также в разработке находится механика параллельной сборки.
{% endofftopic %}

Требований не много:

*   У раннера есть сетевая доступность до Kubernetes и до Registry
*   Для пользователя, которого использует gitlab-runner, [установлен multiwerf](https://ru.werf.io/documentation/guides/installation.html#installing-multiwerf)
*   Для пользователя, которого использует gitlab-runner, установлен kubectl и добавлен конфигурационный файл для подключения к Kubernetes.
*   Gitlab-runner подключен к нашему Gitlab с тегом `werf` 

## Требования к приложению

Гайд основывается на приложении, которое соответствует необходимым требованиям. Однако, когда вы будете реализовывать собственные приложения — возможно, вам нужно будет немного доработать приложение.

{% offtopic title="Что за требования?" %}

Наилучшим образом приложения будут работать в Kubernetes - если они соответствуют [12 факторам heroku](https://12factor.net/). Благодаря этому - у нас в Kubernetes работают stateless приложения, которые не зависят от среды. Это важно, так как кластер может самостоятельно переносить приложения с одного узла на другой, заниматься масштабированием и т.п. — и мы не указываем, где конкретно запускать приложение, а лишь формируем правила, на основании которого кластер принимает свои собственные решения.

Если приложение не соответствует этим требованиям полностью или частично — можно найти обходные пути, однако это является задачей продвинутого уровня и мы не будем рассматривать такие решения в этом гайде.

{% endofftopic %}

<div>
    <a href="020_basic.html" class="nav-btn">Далее: Базовые настройки</a>
</div>
