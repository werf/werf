---
title: –°–±–æ—Ä–∫–∞
permalink: usage/build.html
---

# –°–µ–∫—Ü–∏—è image

–û–±—Ä–∞–∑—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã _image_: `image: string`, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –æ–ø–∏—Å–∞–Ω–∏–µ –æ–±—Ä–∞–∑–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

```yaml
image: frontend
```

–ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –æ–±—Ä–∞–∑, —Ç–æ –æ–Ω –º–æ–∂–µ—Ç –±—ã—Ç—å –±–µ–∑—ã–º—è–Ω–Ω—ã–º:

```yaml
image: ~
```

–ï—Å–ª–∏ –≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –±–æ–ª–µ–µ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞, —Ç–æ **–∫–∞–∂–¥—ã–π –æ–±—Ä–∞–∑** –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∏–º—è:

```yaml
image: frontend
...
---
image: backend
...
```

–û–±—Ä–∞–∑ –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–º–µ–Ω, —É–∫–∞–∑—ã–≤–∞–µ–º—ã—Ö –≤ –≤–∏–¥–µ YAML-—Å–ø–∏—Å–∫–∞ (—ç—Ç–æ —ç–∫–≤–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ –æ–ø–∏—Å–∞–Ω–∏—é –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ –∏–º–µ–Ω–∞–º–∏):

```yaml
image: [main-front,main-back]
```

–ò–º—è –æ–±—Ä–∞–∑–∞ —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ helm-—à–∞–±–ª–æ–Ω–∞—Ö, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–º–∞–Ω–¥ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞, –æ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –≤ `werf.yaml`.

## –°–±–æ—Ä—â–∏–∫ Dockerfile

–°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–º–µ—é—â–µ–≥–æ—Å—è Dockerfile ‚Äî —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π –ø—É—Ç—å –Ω–∞—á–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å werf –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –ø—Ä–æ–µ–∫—Ç–µ. –ù–∏–∂–µ –ø—Ä–∏–≤–µ–¥–µ–Ω –ø—Ä–∏–º–µ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ `werf.yaml`, –æ–ø–∏—Å—ã–≤–∞—é—â–µ–≥–æ –æ–±—Ä–∞–∑ `example` –ø—Ä–æ–µ–∫—Ç–∞:

```yaml
project: my-project
configVersion: 1
---
image: example
dockerfile: Dockerfile
```

–¢–∞–∫–∂–µ, –≤—ã –º–æ–∂–µ—Ç–µ –æ–ø–∏—Å—ã–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ–±—Ä–∞–∑–æ–≤ –∏–∑ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ Dockerfile:

```yaml
image: backend
dockerfile: Dockerfile
target: backend
---
image: frontend
dockerfile: Dockerfile
target: frontend
```

–ò –∫–æ–Ω–µ—á–Ω–æ, –≤—ã –º–æ–∂–µ—Ç–µ –æ–ø–∏—Å—ã–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã, –æ—Å–Ω–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö Dockerfile:

```yaml
image: backend
dockerfile: dockerfiles/DockerfileBackend
---
image: frontend
dockerfile: dockerfiles/DockerfileFrontend
```

#### contextAddFiles

–ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ Dockerfile-–æ–±—Ä–∞–∑–∞ –≤–∫–ª—é—á–∞–µ—Ç —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π `context` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞), –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞.

–î–∏—Ä–µ–∫—Ç–∏–≤–∞ `contextAddFiles` –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

```yaml
image: app
context: app
contextAddFiles:
 - file1
 - dir1/
 - dir2/file2.out
```

–í –¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ –±—É–¥–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Ñ–∞–π–ª–æ–≤:

- `app/**/*` –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞;
- –§–∞–π–ª—ã `app/file1`, `app/dir2/file2.out` –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `dir1`, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

–§–∞–π–ª—ã `contextAddFiles` –∏–º–µ—é—Ç –±–æ–ª—å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç, —á–µ–º —Ñ–∞–π–ª—ã –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–∏–º–∏.

> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `contextAddFiles` –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≥–∏—Ç–µ—Ä–º–∏–Ω–∏–∑–º–æ–º (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–º –≤ [—Å—Ç–∞—Ç—å–µ]({{ "/advanced/giterminism.html#contextaddfiles" | true_relative_url }}))

## Stapel —Å–±–æ—Ä—â–∏–∫

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç.–Ω. —Å–±–æ—Ä—â–∏–∫–∞ Stapel. –ï–≥–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

* –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å git –∏ –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø–µ—Ä–µ—Å–±–æ—Ä–∫—É —Å —É—á–µ—Ç–æ–º –∏—Å—Ç–æ—Ä–∏–∏ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–∏—Å—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ —Å –ø–æ–º–æ—â—å—é Ansible-–∑–∞–¥–∞–Ω–∏–π.
* –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–∂–¥—É —Å–±–æ—Ä–∫–∞–º–∏ –æ–±—â–∏–π –∫—ç—à, —Å –ø–æ–º–æ—â—å—é –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
* –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å –∫–æ–Ω–µ—á–Ω—ã–π —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞, –∏—Å–∫–ª—é—á–∞—è –∏–∑ –Ω–µ–≥–æ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–±–æ—Ä–∫–∏.

# –°—Ç–∞–¥–∏–∏ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–ú—ã —Ä–∞–∑–¥–µ–ª–∏–ª–∏ —Å–±–æ—Ä–æ—á–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–∑–æ–≤, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ [werf.yaml]({{ "reference/werf_yaml.html" | true_relative_url }}) –Ω–∞ —ç—Ç–∞–ø—ã, [—Å —á–µ—Ç–∫–∏–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ–º](#–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏-—Å—Ç–∞–¥–∏–∏). –ö–∞–∂–¥—ã–π —Ç–∞–∫–æ–π —ç—Ç–∞–ø —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–º—É –æ–±—Ä–∞–∑—É, –ø–æ–¥–æ–±–Ω–æ —Å–ª–æ—è–º –≤ Docker. –í werf —Ç–∞–∫–æ–π —ç—Ç–∞–ø –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è [—Å—Ç–∞–¥–∏–µ–π](#–∫–æ–Ω–≤–µ–µ—Ä-—Å—Ç–∞–¥–∏–π), –∞ **–∫–æ–Ω–µ—á–Ω—ã–π –æ–±—Ä–∞–∑** —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å–æ–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è git –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ werf.yaml.

–°—Ç–∞–¥–∏–∏ ‚Äî —ç—Ç–æ —ç—Ç–∞–ø—ã —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞. ***–°—Ç–∞–¥–∏—è*** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≥—Ä—É–ø–ø–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, —É–∫–∞–∑–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ü—Ä–∏—á–µ–º –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —ç—Ç–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –Ω–µ —Å–ª—É—á–∞–π–Ω–∞, –∏–º–µ–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å–ª–æ–≤–∏—è –∏ –ø—Ä–∞–≤–∏–ª–∞ —Å–±–æ—Ä–∫–∏. –° –∫–∞–∂–¥–æ–π _—Å—Ç–∞–¥–∏–µ–π_ —Å–≤—è–∑–∞–Ω –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π Docker-–æ–±—Ä–∞–∑. –í—Å–µ —Å—Ç–∞–¥–∏–∏ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ [—Ö—Ä–∞–Ω–∏–ª–∏—â–µ](#—Ö—Ä–∞–Ω–∏–ª–∏—â–µ).

–í—ã –º–æ–∂–µ—Ç–µ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å—Ç–∞–¥–∏–∏ –∫–∞–∫ –∫—ç—à —Å–±–æ—Ä–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–æ –≤ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —ç—Ç–æ –Ω–µ —Å–æ–≤—Å–µ–º –∫—ç—à, –∞ —á–∞—Å—Ç—å —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

## –ö–æ–Ω–≤–µ–µ—Ä —Å—Ç–∞–¥–∏–π

_–ö–æ–Ω–≤–µ–π–µ—Ä —Å—Ç–∞–¥–∏–π_ ‚Äî –Ω–∞–±–æ—Ä —É—Å–ª–æ–≤–∏–π –∏ –ø—Ä–∞–≤–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–π, –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞—é—â–∏–π —Ç–∞–∫–∂–µ —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –ø–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–π. werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–µ –æ–¥–∏–Ω, –∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ _–∫–æ–Ω–≤–µ–π–µ—Ä–æ–≤ —Å—Ç–∞–¥–∏–π_ –≤ —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç–µ, –ø–æ-—Ä–∞–∑–Ω–æ–º—É —Å–æ–±–∏—Ä–∞—è –æ–±—Ä–∞–∑—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Ö –æ–ø–∏—Å–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

<div class="tabs">
  <a href="javascript:void(0)" class="tabs__btn active" onclick="openTab(event, 'tabs__btn', 'tabs__content', 'dockerfile-image-tab')">Dockerfile-–æ–±—Ä–∞–∑</a>
  <a href="javascript:void(0)" class="tabs__btn" onclick="openTab(event, 'tabs__btn', 'tabs__content', 'stapel-image-tab')">Stapel-–æ–±—Ä–∞–∑</a>
  <a href="javascript:void(0)" class="tabs__btn" onclick="openTab(event, 'tabs__btn', 'tabs__content', 'stapel-artifact-tab')">Stapel-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç</a>
</div>

<div id="dockerfile-image-tab" class="tabs__content active">
<a class="google-drawings" href="{{ "images/reference/stages_and_images1.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/reference/stages_and_images1_preview.png" | true_relative_url }}">
</a>
</div>

<div id="stapel-image-tab" class="tabs__content">
<a class="google-drawings" href="{{ "images/reference/stages_and_images2.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/reference/stages_and_images2_preview.png" | true_relative_url }}" >
</a>
</div>

<div id="stapel-artifact-tab" class="tabs__content">
<a class="google-drawings" href="{{ "images/reference/stages_and_images3.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/reference/stages_and_images3_preview.png" | true_relative_url }}">
</a>
</div>

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é, –æ—Å—Ç–∞–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å–æ —Å—Ç–∞–¥–∏—è–º–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è werf.**

–î–ª—è –∫–∞–∂–¥–æ–π _—Å—Ç–∞–¥–∏–∏_, werf –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–±–æ—Ä–æ—á–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä ‚Äî [–¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏](#–¥–∞–π–¥–∂–µ—Å—Ç-—Å—Ç–∞–¥–∏–∏).

–í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —É —Å—Ç–∞–¥–∏–∏ [–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å—Ç–∞–¥–∏–∏](#–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏-—Å—Ç–∞–¥–∏–∏), –æ–Ω–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, _–∫–æ–Ω–≤–µ–π–µ—Ä —Å—Ç–∞–¥–∏–π_ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –Ω–∞ –æ–¥–Ω—É —Å—Ç–∞–¥–∏—é. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –∫–æ–Ω–≤–µ–π–µ—Ä —Å—Ç–∞–¥–∏–π –º–æ–∂–µ—Ç —É–º–µ–Ω—å—à–∞—Ç—å—Å—è, –≤–ø–ª–æ—Ç—å –¥–æ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ _from_.

<a class="google-drawings" href="{{ "images/reference/stages_and_images4.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/reference/stages_and_images4_preview.png" | true_relative_url }}">
</a>

## –î–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏

_–î–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏_ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è [—Ç–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è](#–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ-—Å—Ç–∞–¥–∏–π) _—Å—Ç–∞–¥–∏–∏_ (–¥–∞–π–¥–∂–µ—Å—Ç —è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–∞—Å—Ç—å—é —Ç–µ–≥–∞) –≤ _—Ö—Ä–∞–Ω–∏–ª–∏—â–µ_.
werf –Ω–µ —Å–æ–±–∏—Ä–∞–µ—Ç —Å—Ç–∞–¥–∏—é, –µ—Å–ª–∏ —Å—Ç–∞–¥–∏—è —Å —Ç–∞–∫–∏–º –∂–µ _–¥–∞–π–¥–∂–µ—Å—Ç–æ–º_ —É–∂–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ _—Ö—Ä–∞–Ω–∏–ª–∏—â–µ_ (—ç—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–µ –Ω–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Docker, —Ç–æ–ª—å–∫–æ –∏–º–µ–µ—Ç –±–æ–ª–µ–µ —Å–ª–æ–∂–Ω—É—é –ª–æ–≥–∏–∫—É).

***–î–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏*** ‚Äî —ç—Ç–æ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è —Å—É–º–º–∞ –æ—Ç:
- –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω–æ–π —Å—É–º–º—ã [–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å—Ç–∞–¥–∏–∏](#–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏-—Å—Ç–∞–¥–∏–∏).
- –¥–∞–π–¥–∂–µ—Å—Ç–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞–¥–∏–∏;
- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞ git –∫–æ–º–º–∏—Ç–∞ —Å–≤—è–∑–∞–Ω–Ω–æ–≥–æ —Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞–¥–∏–µ–π (–µ—Å–ª–∏ —ç—Ç–∞ —Å—Ç–∞–¥–∏—è —Å–≤—è–∑–∞–Ω–∞ —Å git).

_–î–∞–π–¥–∂–µ—Å—Ç_ —Å—Ç–∞–¥–∏–∏ –∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Å—Ç–∞–¥–∏–∏ –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∞–≤–æ–∫ –≤ git, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–µ–ª–∏ –∫ —ç—Ç–æ–º—É –∫–æ–º–º–∏—Ç—É.

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç–∞–¥–∏–∏

_–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç–∞–¥–∏–∏_ ‚Äî —ç—Ç–æ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞–ø—Ä—è–º—É—é —Å–≤—è–∑–∞–Ω—ã –∏ –≤–ª–∏—è—é—Ç –Ω–∞ [–¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏](#–¥–∞–π–¥–∂–µ—Å—Ç-—Å—Ç–∞–¥–∏–∏). –ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º —Å—Ç–∞–¥–∏–∏ –æ—Ç–Ω–æ—Å—è—Ç—Å—è:

- —Ñ–∞–π–ª—ã (–∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ) –∏–∑ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤;
- –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ —Å—Ç–∞–¥–∏–∏ –∏–∑ —Ñ–∞–π–ª–∞ `werf.yaml`;
- –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –≤ `werf.yaml`
- –∏ —Ç.–ø.

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ _–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å—Ç–∞–¥–∏–∏_ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `werf.yaml`, –æ—Å—Ç–∞–ª—å–Ω—ã–µ ‚Äî –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞.

–°–ª–µ–¥—É—é—â–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–ª–ª—é—Å—Ç—Ä–∏—Ä—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ Dockerfile-–æ–±—Ä–∞–∑–µ, Stapel-–æ–±—Ä–∞–∑–µ –∏ [Stapel-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–µ]({{ "advanced/building_images_with_stapel/artifacts.html" | true_relative_url }}).
–ö–∞–∂–¥–∞—è —Å—Ç—Ä–æ–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏. –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø—Ä–∞–≤–∞—è —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é —á–∞—Å—Ç—å `werf.yaml` –∏ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ä–∞–∑–¥–µ–ª—ã —Å –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.

<div class="tabs">
  <a href="javascript:void(0)" id="image-from-dockerfile-dependencies" class="tabs__btn dependencies-btn active">Dockerfile-–æ–±—Ä–∞–∑</a>
  <a href="javascript:void(0)" id="image-dependencies" class="tabs__btn dependencies-btn">Stapel-–æ–±—Ä–∞–∑</a>
  <a href="javascript:void(0)" id="artifact-dependencies" class="tabs__btn dependencies-btn">Stapel-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç</a>
</div>

<div id="dependencies">
{% for stage in site.data.stages.ru.entries %}
<div class="stage {{stage.type}}">
  <div class="stage-body">
    <div class="stage-base">
      <p>stage {{ stage.name | escape }}</p>

      {% if stage.dependencies %}
      <div class="dependencies">
        {% for dependency in stage.dependencies %}
        <div class="dependency">
          {{ dependency | escape }}
        </div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

<div class="werf-config" markdown="1">

{% if stage.werf_config %}
```yaml
{{ stage.werf_config }}
```
{% endif %}

{% if stage.references %}
<div class="references">
    –ü–æ–¥—Ä–æ–±–Ω–µ–µ:
    <ul>
    {% for reference in stage.references %}
        <li><a href="{{ reference.link | true_relative_url }}">{{ reference.name }}</a></li>
    {% endfor %}
    </ul>
</div>
{% endif %}

</div>

    </div>
</div>
{% endfor %}
</div>

<link rel="stylesheet" type="text/css" href="{{ assets["stages.css"].digest_path | true_relative_url }}" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script>
function application() {
  if ($("a[id=image-from-dockerfile-dependencies]").hasClass('active')) {
    $(".image").addClass('hidden');
    $(".artifact").addClass('hidden');
    $(".image-from-dockerfile").removeClass('hidden')
  }
  else if ($("a[id=image-dependencies]").hasClass('active')) {
    $(".image-from-dockerfile").addClass('hidden');
    $(".artifact").addClass('hidden');
    $(".image").removeClass('hidden')
  }
  else if ($("a[id=artifact-dependencies]").hasClass('active')) {
    $(".image-from-dockerfile").addClass('hidden');
    $(".image").addClass('hidden');
    $(".artifact").removeClass('hidden')
  }
  else {
    $(".image-from-dockerfile").addClass('hidden');
    $(".image").addClass('hidden');
    $(".artifact").addClass('hidden')
  }
}

$('.tabs').on('click', '.dependencies-btn', function() {
  $(this).toggleClass('active').siblings().removeClass('active');
  application()
});

application();
$.noConflict();
</script>

## –•—Ä–∞–Ω–∏–ª–∏—â–µ

_–•—Ä–∞–Ω–∏–ª–∏—â–µ_ —Ö—Ä–∞–Ω–∏—Ç —Å—Ç–∞–¥–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç–∞. –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ —Ö–æ—Å—Ç-–º–∞—à–∏–Ω–µ, –ª–∏–±–æ –≤ Docker Repo.

–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥ werf –∏—Å–ø–æ–ª—å–∑—É—é—Ç _—Å—Ç–∞–¥–∏–∏_. –¢–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —Ç—Ä–µ–±—É—é—Ç —É–∫–∞–∑–∞–Ω–∏—è –º–µ—Å—Ç–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è _—Ö—Ä–∞–Ω–∏–ª–∏—â–∞_ —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–∞ `--repo` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_REPO`.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Ç–∏–ø–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞:
1. _–õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ_. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π docker-server –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è docker-–æ–±—Ä–∞–∑–æ–≤.
2. _–£–¥–∞–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ_. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç container registry –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è docker-–æ–±—Ä–∞–∑–æ–≤. –í–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `--repo=CONTAINER_REGISTRY_REPO`, –Ω–∞–ø—Ä–∏–º–µ—Ä, `--repo=registry.mycompany.com/web`. **–ó–ê–ú–ï–ß–ê–ù–ò–ï** –ö–∞–∂–¥—ã–π –ø—Ä–æ–µ–∫—Ç –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —ç—Ç–∏–º –ø—Ä–æ–µ–∫—Ç–æ–º.

–°—Ç–∞–¥–∏–∏ –±—É–¥—É—Ç [–∏–º–µ–Ω–æ–≤–∞—Ç—å—Å—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É](#–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ-—Å—Ç–∞–¥–∏–π) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ container registry –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–π, –ª–æ–∫–∞–ª—å–Ω—ã–π docker-server –Ω–∞ –≤—Å–µ—Ö —Ö–æ—Å—Ç–∞—Ö, –≥–¥–µ –∑–∞–ø—É—Å–∫–∞—é—Ç werf, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –∫–µ—à. –≠—Ç–æ—Ç –∫–µ—à –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–∏—â–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∞–º–∏–º werf-–æ–º, –ª–∏–±–æ —É–¥–∞–ª—ë–Ω —Å –ø–æ–º–æ—â—å—é –¥—Ä—É–≥–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä `docker rmi`) –±–µ–∑ –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.

### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–π

–°—Ç–∞–¥–∏–∏ –≤ _–ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ_ –∏–º–µ–Ω—É—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ö–µ–º—ã: `PROJECT_NAME:STAGE_DIGEST-TIMESTAMP_MILLISEC`. –ù–∞–ø—Ä–∏–º–µ—Ä:

```
myproject                   9f3a82975136d66d04ebcb9ce90b14428077099417b6c170e2ef2fef-1589786063772   274bd7e41dd9        16 seconds ago      65.4MB
myproject                   7a29ff1ba40e2f601d1f9ead88214d4429835c43a0efd440e052e068-1589786061907   e455d998a06e        18 seconds ago      65.4MB
myproject                   878f70c2034f41558e2e13f9d4e7d3c6127cdbee515812a44fef61b6-1589786056879   771f2c139561        23 seconds ago      65.4MB
myproject                   5e4cb0dcd255ac2963ec0905df3c8c8a9be64bbdfa57467aabeaeb91-1589786050923   699770c600e6        29 seconds ago      65.4MB
myproject                   14df0fe44a98f492b7b085055f6bc82ffc7a4fb55cd97d30331f0a93-1589786048987   54d5e60e052e        31 seconds ago      64.2MB
```

–°—Ç–∞–¥–∏–∏ –≤ _—É–¥–∞–ª—ë–Ω–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ_ –∏–º–µ–Ω—É—é—Ç—Å—è —Å–æ–≥–ª–∞—Å–Ω–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ö–µ–º—ã: `CONTAINER_REGISTRY_REPO:STAGE_DIGEST-TIMESTAMP_MILLISEC`. –ù–∞–ø—Ä–∏–º–µ—Ä:

```
localhost:5000/myproject-stages                 d4bf3e71015d1e757a8481536eeabda98f51f1891d68b539cc50753a-1589714365467   7c834f0ff026        20 hours ago        66.7MB
localhost:5000/myproject-stages                 e6073b8f03231e122fa3b7d3294ff69a5060c332c4395e7d0b3231e3-1589714362300   2fc39536332d        20 hours ago        66.7MB
localhost:5000/myproject-stages                 20dcf519ff499da126ada17dbc1e09f98dd1d9aecb85a7fd917ccc96-1589714359522   f9815cec0867        20 hours ago        65.4MB
localhost:5000/myproject-stages                 1dbdae9cc1c9d5d8d3721e32be5ed5542199def38ff6e28270581cdc-1589714352200   6a37070d1b46        20 hours ago        65.4MB
localhost:5000/myproject-stages                 f88cb5a1c353a8aed65d7ad797859b39d357b49a802a671d881bd3b6-1589714347985   5295f82d8796        20 hours ago        65.4MB
localhost:5000/myproject-stages                 796e905d0cc975e718b3f8b3ea0199ea4d52668ecc12c4dbf85a136d-1589714344546   a02ec3540da5        20 hours ago        64.2MB
```

- `PROJECT_NAME` ‚Äî –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞;
- `CONTAINER_REGISTRY_REPO` ‚Äî —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∑–∞–¥–∞–Ω–Ω—ã–π –æ–ø—Ü–∏–µ–π `--repo`;
- `STAGE_DIGEST` ‚Äî –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏. –î–∞–π–¥–∂–µ—Å—Ç —è–≤–ª—è–µ—Ç—Å—è –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Ç–∞–¥–∏–∏ –∏ —Ç–∞–∫–∂–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –ø—Ä–∞–≤–æ–∫ –≤ git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–µ–ª–∏ –∫ —Ç–∞–∫–æ–º—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É.
- `TIMESTAMP_MILLISEC` ‚Äî —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ [–ø—Ä–æ—Ü–µ–¥—É—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å—Ç–∞–¥–∏–∏]({{ "internals/build_process.html#—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-—Å—Ç–∞–¥–∏–π-–≤-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ" | true_relative_url }}) –ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ —Å—Ç–∞–¥–∏—è –±—ã–ª–∞ —Å–æ–±—Ä–∞–Ω–∞.

# –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å—Ç–∞–¥–∏–π

–í –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–µ –æ–ø–∏—Å–∞–Ω–æ, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –≤ werf, –∫–∞–∫–∏–µ –±—ã–≤–∞—é—Ç —Ç–∏–ø—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç —ç—Ç–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞, –∞ —Ç–∞–∫–∂–µ —Ä–∞–∑–ª–∏—á–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ.

## –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞–¥–∏–π

werf —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±—Ä–∞–∑—ã, —Å–æ—Å—Ç–æ—è—â–∏–µ –∏–∑ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–∞–¥–∏–π. –í—Å–µ —Å—Ç–∞–¥–∏–∏ —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–æ–µ **—Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞–¥–∏–π** –ø–æ –º–µ—Ä–µ —Å–±–æ—Ä–∫–∏.

–ï—Å—Ç—å –¥–≤–∞ –≤–∏–¥–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å—Ç–∞–¥–∏–π: **–ª–æ–∫–∞–ª—å–Ω–æ–µ** –∏ **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π** (container registry).

* –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞–¥–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ _—Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏_ –∏ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤. –í –∫–∞—á–µ—Å—Ç–≤–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –≤—ã—Å—Ç—É–ø–∞–µ—Ç Docker server. –õ–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞–¥–∏–π –±—É–¥–µ—Ç –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `werf build` –±–µ–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ `--repo`.
* –í–æ –≤—Å–µ—Ö –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Å–ª—É—á–∞—è—Ö (—Ç.–µ. –∫—Ä–æ–º–µ –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏) –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å—Ç–∞–¥–∏–π –≤—Å–µ–≥–¥–∞ –≤—ã—Å—Ç—É–ø–∞–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ container registry. –ï—Å–ª–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä–∫—É —Å —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —Å—Ç–∞–¥–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `werf build` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--repo ghcr.io/example/myrepo`), —Ç–æ werf —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç –Ω–∞–ª–∏—á–∏–µ —Ç—Ä–µ–±—É–µ–º—ã—Ö —Å—Ç–∞–¥–∏–π –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ —Å–∫–æ–ø–∏—Ä—É–µ—Ç –æ—Ç—Ç—É–¥–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Å—Ç–∞–¥–∏–∏, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å —ç—Ç–∏ —Å—Ç–∞–¥–∏–∏ –∑–∞–Ω–æ–≤–æ.

–î–ª—è –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π –≤–≤–µ–¥—ë–º —Ç–∞–∫–∂–µ –ø–æ–Ω—è—Ç–∏–µ **–∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞** ‚Äî —ç—Ç–æ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –Ω–∏–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å—Ç–∞–¥–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –í–æ –≤—Å–µ—Ö –≤—ã–∑–æ–≤–∞—Ö werf –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–≥–æ –∏ —Ç–æ–≥–æ –∂–µ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –æ–¥–Ω–∏—Ö –∏ —Ç–µ—Ö –∂–µ —Ö—Ä–∞–Ω–∏–ª–∏—â —Å—Ç–∞–¥–∏–π *(–º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–æ –æ–¥–Ω–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ ‚Äî –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ —Å–º. –¥–∞–ª–µ–µ)*.

–¢–∞–∫–∂–µ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å—Ç–∞–¥–∏–π –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–¥–∞–ª–µ–Ω–æ –∏–ª–∏ –æ—á–∏—â–µ–Ω–æ —Å—Ç–æ—Ä–æ–Ω–Ω–∏–º–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –±–µ–∑ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã—Ö –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã werf *(–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–º. [–ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](#–ø–µ—Ä–≤–∏—á–Ω—ã–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π))*. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–ª—è—é—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ç–∏–ø—ã —Ö—Ä–∞–Ω–∏–ª–∏—â, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ —É–¥–∞–ª–µ–Ω—ã –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ *(–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–º. [–∫—ç—à–∏—Ä—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π](#–∫—ç—à–∏—Ä—É—é—â–∏–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π))*.

### –ü–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

* –ó–∞–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--repo` (–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_REPO`).
* –£ –ø—Ä–æ–µ–∫—Ç–∞ –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ç–∞–∫–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

–î–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω—ã–º –∏ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤ —Å–µ–±–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π:

1. –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞.
  - –•—Ä–∞–Ω–∏–ª–∏—â–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º, –¥–ª—è —Å–æ–±–∏—Ä–∞–µ–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –∏ —Å—Ç–∞–¥–∏–π.
  - –ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –±–µ–∑–æ–ø–∞—Å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ —Å—Ç–∞—Ä—ã—Ö —Å—Ç–∞–¥–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–∫–æ–º–∞–Ω–¥–∞ `werf cleanup`).
2. –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏ –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.
  - –î–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–±–æ—Ä–∫—É –≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–±–∏—Ä–∞–µ–º—ã–µ —Å—Ç–∞–¥–∏–∏ –≤ —Ç–∞–∫–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏. –≠—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ –∑–∞ —Å—á—ë—Ç –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã—Ö –≤ werf. –≠—Ç–∏ –º–µ—Ö–∞–Ω–∏–∑–º—ã —Ä–∞–±–æ—Ç–∞—é—Ç –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º.
  - –ö–∞–∫ —Ç–æ–ª—å–∫–æ —Å—Ç–∞–¥–∏—è –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, —ç—Ç–∞ —Å—Ç–∞–¥–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞ –¥—Ä—É–≥–∏–º–∏ —Å–±–æ—Ä–æ—á–Ω—ã–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã —Å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞.
3. –°–±–æ—Ä–æ—á–Ω—ã–π –∫—ç—à —Ä–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–¥–∏–π.
  - –†–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ –ø–æ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –∑–∞–Ω–æ–≤–æ.
  - –î–∞–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å—Ö–æ–∂–∞ —Å –ø—Ä–∏–≤—ã—á–Ω—ã–º –ª–æ–∫–∞–ª—å–Ω—ã–º —Å–±–æ—Ä–æ—á–Ω—ã–º –∫—ç—à–æ–º –≤ Docker server, –æ–¥–Ω–∞–∫–æ –≤ —Å–ª—É—á–∞–µ werf —ç—Ç–æ—Ç –∫—ç—à –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ container registry.
4. –•—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Kubernetes.
  - Kubernetes –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å –æ–±—Ä–∞–∑—ã –∏–∑ —ç—Ç–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
  - –í –∫–∞—á–µ—Å—Ç–≤–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ –∂–µ —Å—Ç–∞–¥–∏–∏, –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ—Å—Ç–æ–∏—Ç —Å–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑.

**–û—á–∏—Å—Ç–∫–∞ (–í–ê–ñ–ù–û!).** –î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Ä–∞–±–æ—Ç—ã werf –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–¥—ë–∂–Ω—ã–º (persistent) —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º, –æ–±—Ä–∞–∑—ã –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —É–¥–∞–ª—è—é—Ç—Å—è –ª–∏—à—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π –æ—á–∏—Å—Ç–∫–∏ `werf cleanup`. –ü–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Äî —ç—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–±–æ—Ä–æ—á–Ω—ã–π –∫—ç—à –ø—Ä–æ–µ–∫—Ç–∞, –Ω–æ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –µ–≥–æ –∏—Å—Ç–æ—Ä–∏–∏, –ø–æ—Ö–æ–∂–µ–µ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤ –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

–ü–æ–º–∏–º–æ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ werf –µ—Å—Ç—å –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —á–∞—Å—Ç—å –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π. –û–Ω–∏ –±—É–¥—É—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã –¥–∞–ª–µ–µ. –°—Ç–æ–∏—Ç –ø–æ–º–Ω–∏—Ç—å, —á—Ç–æ **–±–µ–∑ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è werf –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∞ –≤—Å–µ –¥—Ä—É–≥–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Äî –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ**; –æ–Ω–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã, —á—Ç–æ–±—ã —Å–Ω—è—Ç—å —á–∞—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–π –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –≤–∞—à–µ–π –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞.

### –í—Ç–æ—Ä–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

* –ó–∞–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--secondary-repo` (–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_SECONDARY_REPO_<NAME>`).
* –ú–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–∫–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤.

–î–∞–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ ‚Äî —ç—Ç–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ç–æ–ª—å–∫–æ –¥–ª—è —á—Ç–µ–Ω–∏—è (read-only), –≤—ã–ø–æ–ª–Ω—è—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏—é —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫—ç—à–∞ —Ä–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–¥–∏–π *(—Å–º. —Ñ—É–Ω–∫—Ü–∏–∏ [–ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#–ø–µ—Ä–≤–∏—á–Ω—ã–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π))*.

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –≤ –∫–∞—á–µ—Å—Ç–≤–µ secondary-repo –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ç –¥—Ä—É–≥–æ–π –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∞–¥–∏–∏ –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –±—É–¥—É—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π –≤–º–µ—Å—Ç–æ —Å–±–æ—Ä–∫–∏ —Å –Ω—É–ª—è. –í–Ω–æ–≤—å —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –∂–µ —Å—Ç–∞–¥–∏–∏ –±—É–¥—É—Ç –ø–æ–º–µ—â–µ–Ω—ã —Ç–æ–ª—å–∫–æ –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—Ç–æ—Ä–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤—Å–µ–≥–¥–∞ read-only, —Ç.–µ. –º—ã –Ω–µ –∏–º–µ–µ–º –ø—Ä–∞–≤–∞ –≤ –Ω–µ–≥–æ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–û—á–∏—Å—Ç–∫–∞** –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —Ç.–∫. —ç—Ç–æ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ —Ç–æ –∂–µ –≤—Ä–µ–º—è —è–≤–ª—è–µ—Ç—Å—è –ø–µ—Ä–≤–∏—á–Ω—ã–º –¥–ª—è –¥—Ä—É–≥–æ–π –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –µ–≥–æ –¥–∞–Ω–Ω—ã–µ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–∞–º.

### –ö—ç—à–∏—Ä—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

* –ó–∞–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--cache-repo` (–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_CACHE_REPO_<NAME>`).
* –ú–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω –æ–¥–∏–Ω –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ç–∞–∫–∏—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤.

–í—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫—ç—à–∞ —Ä–∞–Ω–µ–µ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–¥–∏–π *(—Å–º. —Ñ—É–Ω–∫—Ü–∏–∏ [–ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#–ø–µ—Ä–≤–∏—á–Ω—ã–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π))*. –ö—ç—à–∏—Ä—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –≤—Ç–æ—Ä–∏—á–Ω–æ–≥–æ —Ç–µ–º, —á—Ç–æ –æ–Ω read-write, —Ç.–µ. –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–æ–≤—ã—Ö —Å—Ç–∞–¥–∏–π –≤ –∫—ç—à, —Ç–∞–∫ –∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö —Å—Ç–∞–¥–∏–π –∏–∑ —ç—Ç–æ–≥–æ –∫—ç—à–∞.

–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Å—Ç–∞–¥–∏–∏ –±—É–¥—É—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ –∫—ç—à–∏—Ä—É—é—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π, –ø–æ—Å–∫–æ–ª—å–∫—É –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ–±—è–∑–∞–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –≤—Å–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ –æ–±—Ä–∞–∑–æ–≤ –ø—Ä–æ–µ–∫—Ç–∞. –í–Ω–æ–≤—å —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ –±—É–¥—É—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω—ã –∏ –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∏ –≤ –∫—ç—à–∏—Ä—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

–°—Ç–∞–¥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –±–∞–∑–æ–≤—ã—Ö –¥–ª—è —Å–±–æ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —Å—Ç–∞–¥–∏–π:
* –±—É–¥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è –∏–∑ –∫—ç—à–∞,
* –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ –∫—ç—à–∏—Ä—É—é—â–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ ‚Äî –±—É–¥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è –∏–∑ –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –∞ –∑–∞—Ç–µ–º –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –∫—ç—à–∏—Ä—É—é—â–∏–π –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.

–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏, –∫—ç—à–∏—Ä—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ –≤–Ω–æ–≤—å —Å–æ–±–∏—Ä–∞–µ–º—ã–º–∏ —Å—Ç–∞–¥–∏—è–º–∏, –Ω–æ –∏ –±–∞–∑–æ–≤—ã–º–∏ —Å—Ç–∞–¥–∏—è–º–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏ –Ω–æ–≤—ã—Ö —Å—Ç–∞–¥–∏–π.

–ö—ç—à–∏—Ä—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Kubernetes.

**–û—á–∏—Å—Ç–∫–∞** –∫—ç—à–∏—Ä—É—é—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –æ—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –ø—É—Ç—ë–º –µ–≥–æ –ø–æ–ª–Ω–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è. –ü–æ—Å–ª–µ –æ—á–∏—Å—Ç–∫–∏ —Ç–∞–∫–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –±—É–¥–µ—Ç –≤–Ω–æ–≤—å –Ω–∞–ø–æ–ª–Ω–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

### –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

* –ó–∞–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `--final-repo` (–∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_FINAL_REPO`).
* –ú–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ç–∞–∫–æ–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

–î–∞–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∏—Å–∫–ª—é—á–∏—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤, –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω–Ω—ã—Ö –¥–ª—è –¥–µ–ø–ª–æ—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Kubernetes.
- –í–Ω–æ–≤—å —Å–æ–±–∏—Ä–∞–µ–º—ã–µ –æ–±—Ä–∞–∑—ã –ø–æ–ø–∞–¥–∞—é—Ç —Å–Ω–∞—á–∞–ª–∞ –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∏ –∑–∞—Ç–µ–º –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π.
- –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ –æ–±—Ä–∞–∑–æ–≤, –≤ –Ω–µ–º –µ—Å—Ç—å –ª–∏—à—å –ø–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç–∞–¥–∏—è –æ–±—Ä–∞–∑–∞.
- –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–∑—ã (–∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã), –Ω—É–∂–Ω—ã–µ –¥–ª—è —Å–±–æ—Ä–∫–∏ –∫–æ–Ω–µ—á–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤. –°—é–¥–∞ –ø–æ–ø–∞–¥–∞—é—Ç —Ç–æ–ª—å–∫–æ –∫–æ–Ω–µ—á–Ω—ã–µ –æ–±—Ä–∞–∑—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤ Kubernetes.

**–û—á–∏—Å—Ç–∫–∞** –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–æ–π `werf cleanup` –≤ –ø–∞—Ä–µ —Å –ø–µ—Ä–≤–∏—á–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º (–¥–ª—è —ç—Ç–æ–≥–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–≤–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∫–æ–º–∞–Ω–¥–µ `werf cleanup`: `--repo` –∏ `--final-repo`).

## –ü—Ä–∏–º–µ—Ä—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å—Ç–∞–¥–∏–π

–†–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤. –°—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ª—é–±–æ–π –∏–∑ –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç—Ä–µ–±—É–µ—Ç —É–∫–∞–∑–∞–Ω–∏—è [–ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è](#–ø–µ—Ä–≤–∏—á–Ω—ã–π-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π).

### 1. –°—Ç–∞–Ω–¥–∞—Ä—Ç

* **–ü–µ—Ä–≤–∏—á–Ω—ã–π** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω —Å–æ –≤—Å–µ—Ö —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes. –î—Ä—É–≥–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.
* –ü—Ä–∏ —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–æ–≤ —Å–±–æ—Ä–æ—á–Ω—ã–π –∫—ç—à –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –ü—Ä–∏ –≤—ã–∫–∞—Ç–µ Kubernetes –±—É–¥–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–∑—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–∑ –¥–∞–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
* –í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–ª—É—á–∞–µ–≤ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–º–µ–Ω–Ω–æ —ç—Ç—É –ø—Ä–æ—Å—Ç—É—é —Å—Ö–µ–º—É. –¢–∞–∫–∂–µ –¥–∞–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –ø–æ–¥—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ –Ω–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –≤ —Ç–æ–º, —á—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞.

### 2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫—ç—à –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏

* **–ü–µ—Ä–≤–∏—á–Ω—ã–π** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω —Å–æ –≤—Å–µ—Ö —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤, –∞ —Ç–∞–∫–∂–µ –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes.
* **–ö—ç—à–∏—Ä—É—é—â–∏–π** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —Å –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º.
* –ü—Ä–∏ —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–æ–≤ —Å–±–æ—Ä–æ—á–Ω—ã–π –∫—ç—à –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –≤ –ø–µ—Ä–≤–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –∏ –≤ –∫—ç—à–∏—Ä—É—é—â–∏–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π. –°—Ç–∞–¥–∏–∏ –æ–±—Ä–∞–∑–æ–≤, —Ç—Ä–µ–±—É–µ–º—ã–µ –¥–ª—è —Å–±–æ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö —Å—Ç–∞–¥–∏–π, –±—É–¥—É—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å—Å—è –∏–∑ –∫—ç—à–∏—Ä—É—é—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

### 3. –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

* **–ü–µ—Ä–≤–∏—á–Ω—ã–π** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —Å –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º –∏ –¥–æ—Å—Ç—É–ø–µ–Ω —Å–æ –≤—Å–µ—Ö —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤. –î–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –∏–∑ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kubernetes –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –∫—ç—à–∏—Ä—É—é—â–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –ø–µ—Ä–≤–∏—á–Ω—ã–π –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—â–µ–Ω –∏–ª–∏ —É–¥–∞–ª—ë–Ω –±–µ–∑ –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã werf, –ø–æ—ç—Ç–æ–º—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å –ø–µ—Ä—Å–∏—Å—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
* –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–¥–Ω—è—Ç—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ **–∫—ç—à–∏—Ä—É—é—â–∏–µ** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —Å –±—ã—Å—Ç—Ä—ã–º –¥–æ—Å—Ç—É–ø–æ–º.
* **–§–∏–Ω–∞–ª—å–Ω—ã–π** —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –±–ª–∏–∑–∫–æ –∫ –∫–ª–∞—Å—Ç–µ—Ä—É Kubernetes –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –∑–∞–ø—É—Å–∫–∞–µ–º–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—ã—Å—Ç—Ä–æ —Å–∫–∞—á–∏–≤–∞–ª–æ –æ–±—Ä–∞–∑—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã Kubernetes –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å —á–∞—â–µ, —á–µ–º –∏—Ö –∑–∞–≥—Ä—É–∑–∫–∞ —Å–æ —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤). –¢–∞–∫–∂–µ –∫ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –Ω–∞ –∑–∞–ø–∏—Å—å —Å–æ –≤—Å–µ—Ö —Å–±–æ—Ä–æ—á–Ω—ã—Ö —Ö–æ—Å—Ç–æ–≤. –í —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏—à—å –∫–æ–Ω–µ—á–Ω—ã–µ –æ–±—Ä–∞–∑—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–±–µ–∑ –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ –¥—Ä—É–≥–∏—Ö –æ–±—Ä–∞–∑–æ–≤).

# –ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏

–°–±–æ—Ä–æ—á–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å werf –¥–ª—è –æ–±—Ä–∞–∑–æ–≤, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ [werf.yaml]({{ "reference/werf_yaml.html" | true_relative_url }}), –ø–æ–¥—Ä–∞–∑—É–º–µ–≤–∞–µ—Ç [–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É —Å—Ç–∞–¥–∏–π]({{ "internals/stages_and_storage.html" | true_relative_url }}#–∫–æ–Ω–≤–µ–µ—Ä-—Å—Ç–∞–¥–∏–π) –¥–ª—è –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤.

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ç–æ, —á—Ç–æ [_–∫–æ–Ω–≤–µ–π–µ—Ä—ã —Å—Ç–∞–¥–∏–π_]({{ "internals/stages_and_storage.html#–∫–æ–Ω–≤–µ–µ—Ä-—Å—Ç–∞–¥–∏–π" | true_relative_url }}) –¥–ª—è Dockerfile-–æ–±—Ä–∞–∑–∞, Stapel-–æ–±—Ä–∞–∑–∞ –∏ Stapel-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ –æ—Ç–ª–∏—á–∞—é—Ç—Å—è, –∫–∞–∂–¥–∞—è —Å—Ç–∞–¥–∏—è –ø–æ–¥—á–∏–Ω—è–µ—Ç—Å—è –æ–±—â–∏–º –ø—Ä–∞–≤–∏–ª–∞–º [–≤—ã–±–æ—Ä–∫–∏ –∏–∑ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞](#–≤—ã–±–æ—Ä–∫–∞-—Å—Ç–∞–¥–∏–π), [—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è](#—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ-—Å—Ç–∞–¥–∏–π-–≤-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ), –∞ —Ç–∞–∫–∂–µ [—Ä–∞–±–æ—Ç—ã –∫–µ—à–∞ –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫]({{ "advanced/synchronization.html" | true_relative_url }}) –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—É—Å–∫–∞—Ö.

## –°–±–æ—Ä–∫–∞ —Å—Ç–∞–¥–∏–∏ Dockerfile-–æ–±—Ä–∞–∑–∞

–î–ª—è —Å–±–æ—Ä–∫–∏ Dockerfile-–æ–±—Ä–∞–∑–∞ werf —Å–æ–∑–¥–∞–µ—Ç –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é [—Å—Ç–∞–¥–∏—é]({{ "internals/stages_and_storage.html#–∫–æ–Ω–≤–µ–µ—Ä-—Å—Ç–∞–¥–∏–π" | true_relative_url }}) ‚Äî `dockerfile`.

–í –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç, –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Å—Ç–∞–¥–∏–∏ werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –≤ Docker –∫–ª–∏–µ–Ω—Ç–∞ (—ç—Ç–æ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∫–æ–º–∞–Ω–¥—ã `docker build`), –∞ —Ç–∞–∫–∂–µ –∞—Ä–≥—É–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–ø–∏—Å—ã–≤–∞–µ—Ç –≤ `werf.yaml`. –ö—ç—à, —Å–æ–∑–¥–∞–≤–∞–µ–º—ã–π –ø—Ä–∏ —Å–±–æ—Ä–∫–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è, –∫–∞–∫ –∏ –ø—Ä–∏ –æ–±—ã—á–Ω–æ–π —Å–±–æ—Ä–∫–µ, –±–µ–∑ –ø–æ–º–æ—â–∏ werf.

–ò–Ω—Ç–µ—Ä–µ—Å–Ω–æ–π –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å—é werf —è–≤–ª—è–µ—Ç—Å—è —Ç–æ, —á—Ç–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ñ–∞–π–ª—ã –Ω–µ –∏–∑ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞, –∞ –∏–∑ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –í—Å–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∑–∞–¥–∞–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–∏–≤–æ–π `context` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —ç—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞), –±–µ—Ä—É—Ç—Å—è –∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞ (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –≥–∏—Ç–µ—Ä–º–∏–Ω–∏–∑–º –º–æ–∂–Ω–æ –ø–æ—á–∏—Ç–∞—Ç—å [–≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç—å–µ]({{ "advanced/giterminism.html#dockerfile-–æ–±—Ä–∞–∑" | true_relative_url }})).

–í –∏—Ç–æ–≥–µ —Å–±–æ—Ä–∫—É —Å—Ç–∞–¥–∏–∏ `dockerfile` –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```shell
docker build --file=Dockerfile - < ~/.werf/service/tmp/context/4b9d6bc2-a549-42f9-86b8-4032c146f888
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ `werf.yaml` –≤ [—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ]({{ "reference/werf_yaml.html#—Å–±–æ—Ä—â–∏–∫-dockerfile" | true_relative_url }}).

## –°–±–æ—Ä–∫–∞ —Å—Ç–∞–¥–∏–∏ Stapel-–æ–±—Ä–∞–∑–∞ –∏ Stapel-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞

–ü—Ä–∏ —Å–±–æ—Ä–∫–µ —Å—Ç–∞–¥–∏–∏ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å—Ç–∞–¥–∏–∏ –±—É–¥—É—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –æ—Å–Ω–æ–≤–∞–Ω–Ω–æ–º –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–æ–±—Ä–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –∏–ª–∏ –Ω–∞ [–±–∞–∑–æ–≤–æ–º –æ–±—Ä–∞–∑–µ]({{ "advanced/building_images_with_stapel/base_image.html#from-fromlatest" | true_relative_url }}). –¢–∞–∫–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –±—É–¥–µ—Ç —É–ø–æ–º–∏–Ω–∞—Ç—å—Å—è –¥–∞–ª–µ–µ –∫–∞–∫ **—Å–±–æ—Ä–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**.

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º _—Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞_ werf –ø–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–∏–ø–∞ —Å—Ç–∞–¥–∏–∏ –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –∫–∞–∫ —Å–ª—É–∂–µ–±–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã werf, —Ç–∞–∫ –∏ [–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ]({{ "advanced/building_images_with_stapel/assembly_instructions.html" | true_relative_url }}), —É–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `werf.yaml`. –ù–∞–ø—Ä–∏–º–µ—Ä, —Å—Ä–µ–¥–∏ —Å–ª—É–∂–µ–±–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤, –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –ø–∞—Ç—á–µ–π, –∑–∞–ø—É—Å–∫ ansible –∑–∞–¥–∞–Ω–∏–π –∏ —Ç.–ø.

Stapel-—Å–±–æ—Ä—â–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ –Ω–∏–∫–∞–∫ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ _—Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞_ werf –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –≤—Å—ë –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –∏–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–ª—É–∂–µ–±–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ `registry.werf.io/werf/stapel`. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –æ–±—Ä–∞–∑–µ –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å [–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞—Ç—å–µ]({{ "internals/development/stapel_image.html" | true_relative_url }}).

–í _—Å–±–æ—Ä–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä_ [–ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —Å–æ–∫–µ—Ç ssh-–∞–≥–µ–Ω—Ç–∞ —Å —Ö–æ—Å—Ç–∞]({{ "internals/integration_with_ssh_agent.html" | true_relative_url }}), –∞ —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è [–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –º–∞—É–Ω—Ç—ã]({{ "advanced/building_images_with_stapel/mount_directive.html" | true_relative_url }}).

–¢–∞–∫–∂–µ —Å—Ç–æ–∏—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ werf –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –º–∞–Ω–∏—Ñ–µ—Å—Ç–∞ –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞, –ø–µ—Ä–µ—Ç–∏—Ä–∞—è –∏—Ö –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
- `--user=0:0`;
- `--workdir=/`;
- `--entrypoint=/.werf/stapel/embedded/bin/bash`.

–í –∏—Ç–æ–≥–µ –∑–∞–ø—É—Å–∫ _—Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞_ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
```shell
docker run \
  --volume=/tmp/ssh-ln8yCMlFLZob/agent.17554:/.werf/tmp/ssh-auth-sock \
  --volumes-from=stapel_0.6.1 \
  --env=SSH_AUTH_SOCK=/.werf/tmp/ssh-auth-sock \
  --user=0:0 \
  --workdir=/ \
  --entrypoint=/.werf/stapel/embedded/bin/bash \
  sha256:d6e46aa2470df1d32034c6707c8041158b652f38d2a9ae3d7ad7e7532d22ebe0 \
  -ec eval $(echo c2V0IC14 | /.werf/stapel/embedded/bin/base64 --decode)
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ `werf.yaml` –≤ [—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ]({{ "reference/werf_yaml.html#stapel-—Å–±–æ—Ä—â–∏–∫" | true_relative_url }}).

### –ö–∞–∫ Stapel-—Å–±–æ—Ä—â–∏–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å CMD –∏ ENTRYPOINT

–î–ª—è —Å–±–æ—Ä–∫–∏ —Å—Ç–∞–¥–∏–∏ werf –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ —Å–ª—É–∂–µ–±–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ `CMD` –∏ `ENTRYPOINT` –∞ –∑–∞—Ç–µ–º, –∑–∞–º–µ–Ω—è–µ—Ç –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ [–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞]({{ "advanced/building_images_with_stapel/base_image.html" | true_relative_url }}). –ï—Å–ª–∏ –≤ –±–∞–∑–æ–≤–æ–º –æ–±—Ä–∞–∑–µ —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã, werf —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Ö —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:
- `[]` –¥–ª—è `CMD`;
- `[""]` –¥–ª—è `ENTRYPOINT`.

–¢–∞–∫–∂–µ werf —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—É—Å—Ç—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è) –∑–Ω–∞—á–µ–Ω–∏–µ `ENTRYPOINT` –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞, –µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ –∑–Ω–∞—á–µ–Ω–∏–µ `CMD` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`docker.CMD`).

–í –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ werf –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ [–ø–æ–≤–µ–¥–µ–Ω–∏—é Docker](https://docs.docker.com/engine/reference/builder/#understand-how-cmd-and-entrypoint-interact).

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Stapel-—Å–±–æ—Ä—â–∏–∫ –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –∫–æ–Ω—Ç—É—Ä–µ

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ _—Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞_ werf –º–æ–Ω—Ç–∏—Ä—É–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –∏–∑ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞, –∏–º—è –∏ —Ç–µ–≥ –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞—à–∏—Ç—ã –≤ –∫–æ–¥–µ.

–î–ª—è —Å–±–æ—Ä–∫–∏ —Å–æ Stapel –≤ –∑–∞–∫—Ä—ã—Ç–æ–º –∫–æ–Ω—Ç—É—Ä–µ (–±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–ª—É–∂–µ–±–Ω–æ–º—É –æ–±—Ä–∞–∑—É) –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑ –≤ –¥–æ—Å—Ç—É–ø–Ω—ã–π container registry –∏ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–º—è —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_STAPEL_IMAGE_NAME` –∏ `WERF_STAPEL_IMAGE_VERSION` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `WERF_STAPEL_IMAGE_NAME=localhost:5000/stapel` –∏ `WERF_STAPEL_IMAGE_VERSION=0.6.2`).

## –í—ã–±–æ—Ä–∫–∞ —Å—Ç–∞–¥–∏–π

–ê–ª–≥–æ—Ä–∏—Ç–º –≤—ã–±–æ—Ä–∫–∏ —Å—Ç–∞–¥–∏–∏ –≤ werf –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

1. –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è [–¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏]({{ "internals/stages_and_storage.html#–¥–∞–π–¥–∂–µ—Å—Ç-—Å—Ç–∞–¥–∏–∏" | true_relative_url }}).
2. –í—ã–±–∏—Ä–∞—é—Ç—Å—è –≤—Å–µ —Å—Ç–∞–¥–∏–∏, –ø–æ–¥—Ö–æ–¥—è—â–∏–µ –ø–æ–¥ –¥–∞–π–¥–∂–µ—Å—Ç, —Ç.–∫. —Å –æ–¥–Ω–∏–º –¥–∞–π–¥–∂–µ—Å—Ç–æ–º –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–≤—è–∑–∞–Ω–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å—Ç–∞–¥–∏–π –≤ [—Ö—Ä–∞–Ω–∏–ª–∏—â–µ]({{ "internals/stages_and_storage.html#—Ö—Ä–∞–Ω–∏–ª–∏—â–µ" | true_relative_url }}).
3. –í—ã–±–∏—Ä–∞–µ—Ç—Å—è —Å—Ç–∞—Ä–µ–π—à–∏–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏ `TIMESTAMP_MILLISEC` (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–π [–∑–¥–µ—Å—å]({{ "internals/stages_and_storage.html#–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ-—Å—Ç–∞–¥–∏–π" | true_relative_url }})).

### –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–ª—è Stapel-–æ–±—Ä–∞–∑–æ–≤ –∏ Stapel-–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

–ö –æ—Å–Ω–æ–≤–Ω–æ–º—É –∞–ª–≥–æ—Ä–∏—Ç–º—É –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–¥—Å—Ç–≤–∞ git-–∫–æ–º–º–∏—Ç–æ–≤. –ü–æ—Å–ª–µ —à–∞–≥–∞ **2** –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Å–µ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏—Å—Ç–æ—Ä–∏–∏ git: –µ—Å–ª–∏ —Ç–µ–∫—É—â–∞—è —Å—Ç–∞–¥–∏—è —Å–≤—è–∑–∞–Ω–∞ —Å git (—Å—Ç–∞–¥–∏—è git-–∞—Ä—Ö–∏–≤, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—Ç–∞–¥–∏—è —Å git-–ø–∞—Ç—á–∞–º–∏ –∏–ª–∏ —Å—Ç–∞–¥–∏—è git latest patch), —Ç–æ–≥–¥–∞ –≤—ã–±–∏—Ä–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–µ —Å—Ç–∞–¥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Å–≤—è–∑–∞–Ω—ã —Å –∫–æ–º–º–∏—Ç–∞–º–∏, —è–≤–ª—è—é—â–∏–º–∏—Å—è –ø—Ä–µ–¥–∫–∞–º–∏ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –∫–æ–º–º–∏—Ç—ã —Å–æ—Å–µ–¥–Ω–∏—Ö –≤–µ—Ç–æ–∫ –±—É–¥—É—Ç –æ—Ç–±—Ä–æ—à–µ–Ω—ã.

–í–æ–∑–º–æ–∂–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è –∫–æ–≥–¥–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–æ–±—Ä–∞–Ω–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º –¥–∞–π–¥–∂–µ—Å—Ç–æ–º. –ë–æ–ª–µ–µ —Ç–æ–≥–æ, —Å—Ç–∞–¥–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö git-–≤–µ—Ç–æ–∫ –º–æ–≥—É—Ç –∏–º–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –¥–∞–π–¥–∂–µ—Å—Ç. –û–¥–Ω–∞–∫–æ werf –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–µ—à–∞ –º–µ–∂–¥—É –Ω–µ—Å–≤—è–∑–∞–Ω–Ω—ã–º–∏ –≤–µ—Ç–∫–∞–º–∏. –ö–µ—à –≤ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ç–∫–∞—Ö –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —ç—Ç–æ—Ç –∫–µ—à –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∫–æ–º–º–∏—Ç—É, –∫–æ—Ç–æ—Ä—ã–π —è–≤–ª—è–µ—Ç—Å—è –±–∞–∑–æ–≤—ã–º, –∫–∞–∫ –¥–ª—è –æ–¥–Ω–æ–π –≤–µ—Ç–∫–∏, —Ç–∞–∫ –∏ –¥–ª—è –¥—Ä—É–≥–æ–π.

## –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—Ç–∞–¥–∏–π –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

–ú–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ werf (–Ω–∞ –æ–¥–Ω–æ–º —Ö–æ—Å—Ç–µ –∏–ª–∏ –Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ö–æ—Å—Ç–∞—Ö) –º–æ–≥—É—Ç –∏–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å —Å–±–æ—Ä–∫—É –æ–¥–Ω–æ–π –∏ —Ç–æ–π –∂–µ —Å—Ç–∞–¥–∏–∏ –≤ –æ–¥–∏–Ω –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏ –µ—â–µ –Ω–µ—Ç –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–≤–µ–∂–µ—Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –ö–æ–≥–¥–∞ —Å–±–æ—Ä–∫–∞ –Ω–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞, werf –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –Ω–∞ –ª—é–±—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ü–µ–ª–µ–≤—ã–º –¥–∞–π–¥–∂–µ—Å—Ç–æ–º:
- –ï—Å–ª–∏ –∑–∞ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –ø–æ–¥—Ö–æ–¥—è—â–µ–≥–æ –æ–±—Ä–∞–∑–∞ –Ω–µ –ø–æ—è–≤–∏–ª–æ—Å—å –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Ç–æ werf —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ–≤—ã–π –æ–±—Ä–∞–∑, —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä `TIMESTAMP_MILLISEC`.
- –ï—Å–ª–∏ –∑–∞ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π –æ–±—Ä–∞–∑ –ø–æ—è–≤–∏–ª—Å—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, —Ç–æ werf –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–≤–µ–∂–µ—Å–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑, –∞ –≤–º–µ—Å—Ç–æ –Ω–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–æ—è–≤–∏–≤—à–∏–π—Å—è –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –æ–±—Ä–∞–∑.

–î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏: –ø–µ—Ä–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–∫–æ–Ω—á–∏—Ç —Å–±–æ—Ä–∫—É –Ω–æ–≤–æ–π —Å—Ç–∞–¥–∏–∏ (—Å–∞–º—ã–π –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ—Ü–µ—Å—Å) –ø–æ–ª—É—á–∏—Ç —à–∞–Ω—Å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã–π –æ–±—Ä–∞–∑ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –ú–µ–¥–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –Ω–µ –±—É–¥–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –±—ã—Å—Ç—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–π —Å—Ä–µ–¥–µ.

–í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤—ã–±–æ—Ä–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Å—Ç–∞–¥–∏–π –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [–º–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫]({{ "advanced/synchronization.html" | true_relative_url }}) –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ werf.

## –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞

–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –≤ werf —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –¥–≤—É–º—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ `-p, --parallel` –∏ `--parallel-tasks-limit`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ –≤–∫–ª—é—á–µ–Ω–∞ –∏ —Å–æ–±–∏—Ä–∞–µ—Ç—Å—è –Ω–µ –±–æ–ª–µ–µ 5 –æ–±—Ä–∞–∑–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.

–ü–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ–±—Ä–∞–∑–æ–≤, werf —Ä–∞–∑–±–∏–≤–∞–µ—Ç —Å–±–æ—Ä–∫—É –Ω–∞ —ç—Ç–∞–ø—ã. –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã—Ö –æ–±—Ä–∞–∑–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ.

```shell
‚îå Concurrent builds plan (no more than 5 images at the same time)
‚îÇ Set #0:
‚îÇ - ‚õµ image common-base
‚îÇ - üõ∏ artifact jq
‚îÇ - üõ∏ artifact libjq
‚îÇ - üõ∏ artifact kcov
‚îÇ
‚îÇ Set #1:
‚îÇ - ‚õµ image base-for-go
‚îÇ
‚îÇ Set #2:
‚îÇ - üõ∏ artifact terraform-provider-vsphere
‚îÇ - üõ∏ artifact terraform-provider-gcp
‚îÇ - üõ∏ artifact candictl
‚îÇ - ‚õµ image candictl-tests
‚îÇ - üõ∏ artifact helm
‚îÇ - üõ∏ artifact controller
‚îÇ
‚îÇ Set #3:
‚îÇ - ‚õµ image base
‚îÇ
‚îÇ Set #4:
‚îÇ - ‚õµ image tests
‚îÇ - ‚õµ image app
‚îî Concurrent builds plan (no more than 5 images at the same time)
```

## Buildah

werf –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Buildah –≤ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ –¥–ª—è —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–æ–≤.

–ü—Ä–∏ —ç—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, –ø–µ—Ä–µ–º–µ–Ω—ã –∫–æ—Å–Ω—É–ª–∏—Å—å —Ç–æ–ª—å–∫–æ –±—ç–∫–µ–Ω–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (—Å–µ—Ä–≤–µ—Ä Docker –±—ã–ª –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ Buildah).

–ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Buildah –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤ —Ä–∞–∑–¥–µ–ª–µ [–†–µ–∂–∏–º —Å–±–æ—Ä–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Buildah.]({{ "/advanced/buildah_mode.html" | true_relative_url }})

# –†–µ–∂–∏–º —Å–±–æ—Ä–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Buildah

> –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: werf –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–±–æ—Ä–∫—É –æ–±—Ä–∞–∑–æ–≤ —Å _–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Docker-—Å–µ—Ä–≤–µ—Ä–∞_ –∏–ª–∏ _—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Buildah_. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è —Å–±–æ—Ä–∫–∞ –∫–∞–∫ Dockerfile-–æ–±—Ä–∞–∑–æ–≤, —Ç–∞–∫ –∏ stapel-–æ–±—Ä–∞–∑–æ–≤ —á–µ—Ä–µ–∑ Buildah.

–î–ª—è —Å–±–æ—Ä–∫–∏ –±–µ–∑ Docker-—Å–µ—Ä–≤–µ—Ä–∞ werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Buildah –≤ rootless-—Ä–µ–∂–∏–º–µ.

## –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ werf –≤ Buildah-—Ä–µ–∂–∏–º–µ –±–µ–∑ Docker/Kubernetes –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤ [–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ](/installation.html). –ê –¥–ª—è –∑–∞–ø—É—Å–∫–∞ werf –≤ Kubernetes –∏–ª–∏ –≤ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è —Å–ª–µ–¥—É—é—â–∏–µ:
* –ï—Å–ª–∏ –≤–∞—à–µ —è–¥—Ä–æ Linux –≤–µ—Ä—Å–∏–∏ 5.13+ (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞—Ö 5.11+) **—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** —Ä–µ–∂–∏–º —Ä–∞–±–æ—Ç—ã —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å —è–¥—Ä–∞ `overlay`:
  * –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥—É–ª—å —è–¥—Ä–∞ `overlay` –∑–∞–≥—Ä—É–∂–µ–Ω —Å `lsmod | grep overlay`.
  * –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —è–¥—Ä–∞ `CONFIG_USER_NS=y` –≤–∫–ª—é—á–µ–Ω–∞ –≤ –≤–∞—à–µ–º —è–¥—Ä–µ —Å –ø–æ–º–æ—â—å—é `grep CONFIG_USER_NS /boot/config-VERSION`.
  * –ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —è–¥—Ä–∞ –≤ debian-—Å–∏—Å—Ç–µ–º–∞—Ö –∫–æ–º–∞–Ω–¥–∞ `sysctl kernel.unprivileged_userns_clone` –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å `1`. –í –∏–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
    ```shell
    echo 'kernel.unprivileged_userns_clone = 1' | sudo tee -a /etc/sysctl.conf
    sudo sysctl -p
    ```
  * –ö–æ–º–∞–Ω–¥–∞ `sysctl user.max_user_namespaces` –¥–æ–ª–∂–Ω–∞ –≤–µ—Ä–Ω—É—Ç—å –ø–æ –º–µ–Ω—å—à–µ–π –º–µ—Ä–µ `15000`. –í –∏–Ω–æ–º —Å–ª—É—á–∞–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
    ```shell
    echo 'user.max_user_namespaces = 15000' | sudo tee -a /etc/sysctl.conf
    sudo sysctl -p
    ```
* –ï—Å–ª–∏ —è–¥—Ä–æ –±–æ–ª–µ–µ —Å—Ç–∞—Ä–æ–µ –∏–ª–∏ —É –≤–∞—Å –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å —è–¥—Ä–∞ `overlay`, —Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ `fuse-overlayfs`, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ã—á–Ω–æ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö –≤–∞—à–µ–≥–æ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞. –í –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –¥—Ä–∞–π–≤–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ `vfs`.

## –í–∫–ª—é—á–µ–Ω–∏–µ Buildah

Buildah –≤–∫–ª—é—á–∞–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_BUILDAH_MODE` –≤ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤: `auto`, `native-chroot`, `native-rootless`. –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ Buildah –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `WERF_BUILDAH_MODE=auto`.

* `auto` ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä —Ä–µ–∂–∏–º–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã –∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è;
* `native-chroot` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Linux –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `chroot`-–∏–∑–æ–ª—è—Ü–∏—é –¥–ª—è —Å–±–æ—Ä–æ—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤;
* `native-rootless` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ Linux –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `rootless`-–∏–∑–æ–ª—è—Ü–∏—é –¥–ª—è —Å–±–æ—Ä–æ—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –ù–∞ —ç—Ç–æ–º —É—Ä–æ–≤–Ω–µ –∏–∑–æ–ª—è—Ü–∏–∏ werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–±–æ—Ä–æ—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö (runc, crun, kata –∏–ª–∏ runsc).

> –ü–†–ò–ú–ï–ß–ê–ù–ò–ï: –ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç Buildah –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π Linux –∏ Windows —Å –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –ø–æ–¥—Å–∏—Å—Ç–µ–º–æ–π WSL2. –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π MacOS –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ werf –≤ —Ä–µ–∂–∏–º–µ Buildah.

## –î—Ä–∞–π–≤–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞

werf –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä–∞–π–≤–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ `overlay` –∏–ª–∏ `vfs`:

* `overlay` –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É OverlayFS. –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏–±–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é –≤ —è–¥—Ä–æ Linux –ø–æ–¥–¥–µ—Ä–∂–∫—É OverlayFS (–µ—Å–ª–∏ –æ–Ω–∞ –¥–æ—Å—Ç—É–ø–Ω–∞), –ª–∏–±–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é fuse-overlayfs. –≠—Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –≤—ã–±–æ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
* `vfs` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ –≤–º–µ—Å—Ç–æ OverlayFS. –≠—Ç–∞ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —É—Å—Ç—É–ø–∞–µ—Ç –ø–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –ø–æ—ç—Ç–æ–º—É –µ–µ –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å. –û–¥–Ω–∞–∫–æ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –æ–Ω–∞ –º–æ–∂–µ—Ç –ø—Ä–∏–≥–æ–¥–∏—Ç—å—Å—è.

–ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä–∞–π–≤–µ—Ä –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (`overlay`). –î—Ä–∞–π–≤–µ—Ä —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_BUILDAH_STORAGE_DRIVER`.

## Ulimits

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Buildah —Ä–µ–∂–∏–º –≤ werf –Ω–∞—Å–ª–µ–¥—É–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–µ ulimits –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Å–±–æ—Ä–æ—á–Ω—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —ç—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_BUILDAH_ULIMIT`.

–§–æ—Ä–º–∞—Ç `WERF_BUILDAH_ULIMIT=type:softlimit[:hardlimit][,type:softlimit[:hardlimit],...]` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤, —É–∫–∞–∑–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é:
* "core": maximum core dump size (ulimit -c)
* "cpu": maximum CPU time (ulimit -t)
* "data": maximum size of a process's data segment (ulimit -d)
* "fsize": maximum size of new files (ulimit -f)
* "locks": maximum number of file locks (ulimit -x)
* "memlock": maximum amount of locked memory (ulimit -l)
* "msgqueue": maximum amount of data in message queues (ulimit -q)
* "nice": niceness adjustment (nice -n, ulimit -e)
* "nofile": maximum number of open files (ulimit -n)
* "nproc": maximum number of processes (ulimit -u)
* "rss": maximum size of a process's (ulimit -m)
* "rtprio": maximum real-time scheduling priority (ulimit -r)
* "rttime": maximum amount of real-time execution between blocking syscalls
* "sigpending": maximum number of pending signals (ulimit -i)
* "stack": maximum stack size (ulimit -s)

# Git worktree

–î–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å–±–æ—Ä—â–∏–∫–∞ stapel werf-—É —Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–ª–Ω–∞—è git-–∏—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–µ–∫—Ç–∞, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞—Ç—å –≤ –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–º —Ä–µ–∂–∏–º–µ. –ü–æ—ç—Ç–æ–º—É –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é werf –≤—ã–ø–æ–ª–Ω—è–µ—Ç fetch –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ git –ø—Ä–æ–µ–∫—Ç–∞, –∫–æ–≥–¥–∞ —ç—Ç–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è. –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ werf –º–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å shallow-clone —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –ø–æ–ª–Ω—ã–π clone –∏ —Å–∫–∞—á–∞—Ç—å –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤–µ—Ç–æ–∫ –∏ —Ç–µ–≥–æ–≤ –∏–∑ origin –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –æ—á–∏—Å—Ç–∫–∏ –æ–±—Ä–∞–∑–æ–≤.

–ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:

```yaml
gitWorktree:
  forceShallowClone: false
  allowUnshallow: true
  allowFetchOriginBranchesAndTags: true
```

–ß—Ç–æ–±—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π unshallow —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ git, –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã —Å–ª–µ–¥—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

```yaml
gitWorktree:
  forceShallowClone: true
  allowUnshallow: false
```

# –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ werf

–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è ‚Äî —ç—Ç–æ –≥—Ä—É–ø–ø–∞ —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ werf, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã—Ö –¥–ª—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ werf –ø—Ä–∏ –≤—ã–±–æ—Ä–∫–µ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Å—Ç–∞–¥–∏–π –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –æ–±—Ä–∞–∑–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ–±—Ä–∞–∑–æ–≤. –°—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Ç–∞–∫–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

1. _–ö–µ—à —Ö—Ä–∞–Ω–∏–ª–∏—â–∞_ ‚Äî —ç—Ç–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–ª—É–∂–µ–±–Ω—ã–π –∫–µ—à werf, –∫–æ—Ç–æ—Ä—ã–π —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–≤—ã—à–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–∞–∑—ã —Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–∞–¥–∏–π –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —ç—Ç–∏ —Å—Ç–∞–¥–∏–∏ —É–∂–µ –µ—Å—Ç—å –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –ö–µ—à —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å –¥–∞–π–¥–∂–µ—Å—Ç–æ–º (–∏–ª–∏ –¥—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏: —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π —à–∞–≥ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –≤—ã–±–æ—Ä–∫–∏ —Å—Ç–∞–¥–∏–π –ø–æ –¥–∞–π–¥–∂–µ—Å—Ç—É). –î–∞–Ω–Ω—ã–π –∫–µ—à —è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–µ—Ä–µ–Ω—Ç–Ω—ã–º –∏ werf –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –µ–≥–æ, –µ—Å–ª–∏ –±—É–¥–µ—Ç –∑–∞–º–µ—á–µ–Ω–∞ –Ω–µ—Å–æ—Å—Ç—ã–∫–æ–≤–∫–∞ –º–µ–∂–¥—É —Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º —Å—Ç–∞–¥–∏–π –∏ –∫–µ—à–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
2. _–ú–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫_. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö —Å—Ç–∞–¥–∏–π –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ, –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –æ–±—Ä–∞–∑–æ–≤ –∏ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –≤—ã–∫–∞—Ç–∞ –≤ Kubernetes (–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏–º—è —Ä–µ–ª–∏–∑–∞).

–í—Å–µ –∫–æ–º–∞–Ω–¥—ã, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (`--repo=...`) —Ç–∞–∫–∂–µ —Ç—Ä–µ–±—É—é—Ç —É–∫–∞–∑–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `--synchronization=...` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `WERF_SYNCHRONIZATION=...`.

–°—É—â–µ—Å—Ç–≤—É–µ—Ç 2 —Ç–∏–ø–∞ –Ω–∞–±–æ—Ä–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:
1. –õ–æ–∫–∞–ª—å–Ω—ã–π. –í–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `--synchronization=:local`.
- –õ–æ–∫–∞–ª—å–Ω—ã–π _–∫–µ—à —Ö—Ä–∞–Ω–∏–ª–∏—â–∞_ —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Ñ–∞–π–ª–∞—Ö `~/.werf/shared_context/storage/stages_storage_cache/1/PROJECT_NAME/DIGEST`, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º—É –¥–∞–π–¥–∂–µ—Å—Ç—É.
- –õ–æ–∫–∞–ª—å–Ω—ã–π _–º–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫_ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–∞–π–ª–æ–≤—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π.
2. Kubernetes. –í–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `--synchronization=kubernetes://NAMESPACE[:CONTEXT][@(base64:CONFIG_DATA)|CONFIG_PATH]`.
- _–ö–µ—à —Ö—Ä–∞–Ω–∏–ª–∏—â–∞_ –≤ Kubernetes –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–π ConfigMap `cm/PROJECT_NAME`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º `NAMESPACE`.
- _–ú–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫_ –≤ Kubernetes –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ConfigMap –ø–æ –∏–º–µ–Ω–∏ –ø—Ä–æ–µ–∫—Ç–∞ `cm/PROJECT_NAME` (—Ç–æ—Ç –∂–µ —Å–∞–º—ã–π —á—Ç–æ –∏ –¥–ª—è –∫–µ—à–∞ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞) –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –≤ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è—Ö —ç—Ç–æ–≥–æ ConfigMap. werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç [–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ lockgate](https://github.com/werf/lockgate), –∫–æ—Ç–æ—Ä–∞—è —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å –ø–æ–º–æ—â—å—é –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–Ω–Ω–æ—Ç–∞—Ü–∏–π –≤ —Ä–µ—Å—É—Ä—Å–∞—Ö Kubernetes.
3. Http. –í–∫–ª—é—á–∞–µ—Ç—Å—è –æ–ø—Ü–∏–µ–π `--synchronization=http[s]://DOMAIN`.
- –ï—Å—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã–π –ø–æ –¥–æ–º–µ–Ω—É `https://synchronization.werf.io`.
- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π http —Å–µ—Ä–≤–µ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –∫–æ–º–∞–Ω–¥–æ–π `werf synchronization`.

werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `--synchronization=:local` (–ª–æ–∫–∞–ª—å–Ω—ã–π _–∫–µ—à —Ö—Ä–∞–Ω–∏–ª–∏—â–∞_ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–π _–º–µ–Ω–µ–¥–∂–µ—Ä –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫_) –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ.

werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `--synchronization=https://synchronization.werf.io` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —É–¥–∞–ª—ë–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ (`--repo=CONTAINER_REGISTRY_REPO`).

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏, –µ—Å–ª–∏ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Å –ø–æ–º–æ—â—å—é —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –æ–ø—Ü–∏–∏ `--synchronization=:local|(kubernetes://NAMESPACE[:CONTEXT][@(base64:CONFIG_DATA)|CONFIG_PATH])|(http[s]://DOMAIN)`.

**–ó–ê–ú–ï–ß–ê–ù–ò–ï:** –ú–Ω–æ–∂–µ—Å—Ç–≤–æ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ werf, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö —Å –æ–¥–Ω–∏–º –∏ —Ç–µ–º –∂–µ –ø—Ä–æ–µ–∫—Ç–æ–º –æ–±—è–∑–∞–Ω—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏ –∞–¥—Ä–µ—Å –Ω–∞–±–æ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

# Stapel

## –ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑

–ü—Ä–∏–º–µ—Ä –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–≥–æ `werf.yaml`:
```yaml
project: my-project
configVersion: 1
---
image: example
from: alpine
```

–ü—Ä–∏–≤–µ–¥–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–ø–∏—Å—ã–≤–∞–µ—Ç _–æ–±—Ä–∞–∑_ `example`, _–±–∞–∑–æ–≤—ã–º –æ–±—Ä–∞–∑–æ–º_ –¥–ª—è –∫–æ—Ç–æ—Ä–æ–≥–æ —è–≤–ª—è–µ—Ç—Å—è –æ–±—Ä–∞–∑ —Å –∏–º–µ–Ω–µ–º `alpine`.

_–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑_ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤ `from`, `fromImage` –∏–ª–∏ `fromArtifact`.

### from, fromLatest

–î–∏—Ä–µ–∫—Ç–∏–≤–∞ `from` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏–º—è –∏ —Ç–µ–≥ _–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞_. –ï—Å–ª–∏ —Ç–µ–≥ –Ω–µ —É–∫–∞–∑–∞–Ω, —Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî `latest`.

```yaml
from: <image>[:<tag>]
```

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç digest _–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞_, –∞ –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `from`.
–ü–æ—ç—Ç–æ–º—É –∏–∑–º–µ–Ω–µ–Ω–∏–µ _–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞_ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –∏–ª–∏ –≤ container registry –Ω–µ –±—É–¥–µ—Ç –≤–ª–∏—è—Ç—å –Ω–∞ —Å–±–æ—Ä–∫—É, –ø–æ–∫–∞ —Å—Ç–∞–¥–∏—è _from_, —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏–µ–º –æ–±—Ä–∞–∑–∞, –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ _stages storage_.

–ï—Å–ª–∏ –≤–∞–º –Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ digest –æ–±—Ä–∞–∑–∞, —á—Ç–æ–±—ã –≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–π _–±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑_, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—É `fromLatest`.
–≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ç–æ–º—É, —á—Ç–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ werf –±—É–¥–µ—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å—Å—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π digest _–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞_ –≤ container registry.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `fromLatest`:

```yaml
fromLatest: true
```

> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `fromLatest` –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≥–∏—Ç–µ—Ä–º–∏–Ω–∏–∑–º–æ–º (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–º –≤ [—Å—Ç–∞—Ç—å–µ]({{ "advanced/giterminism.html" | true_relative_url }}))

### fromImage –∏ fromArtifact

–í –∫–∞—á–µ—Å—Ç–≤–µ _–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞_ –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –æ–±—Ä–∞–∑ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏–ª–∏ container registry, –Ω–æ –∏ –∏–º—è –¥—Ä—É–≥–æ–≥–æ _–æ–±—Ä–∞–∑–∞_ –∏–ª–∏ [_–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_]({{ "advanced/building_images_with_stapel/artifacts.html" | true_relative_url }}), –æ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –≤ —Ç–æ–º –∂–µ —Ñ–∞–π–ª–µ `werf.yaml`. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `fromImage` –∏ `fromArtifact` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.

```yaml
fromImage: <image name>
fromArtifact: <artifact name>
```

–ï—Å–ª–∏ _–±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑_ —É–Ω–∏–∫–∞–ª–µ–Ω –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, —Ç–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–± ‚Äî —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–≤ —Ñ–∞–π–ª–µ `werf.yaml`) –∫–∞–∫ –æ—Ç–¥–µ–ª—å–Ω—ã–π _–æ–±—Ä–∞–∑_ –∏–ª–∏ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç_, –≤–º–µ—Å—Ç–æ —Ç–æ–≥–æ, —á—Ç–æ–±—ã —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ Docker-–æ–±—Ä–∞–∑.

–¢–∞–∫–∂–µ —ç—Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –±—É–¥–µ—Ç –ø–æ–ª–µ–∑–Ω–æ–π, –µ—Å–ª–∏ –≤–∞–º, –ø–æ –∫–∞–∫–∏–º-–ª–∏–±–æ –ø—Ä–∏—á–∏–Ω–∞–º, –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ _–∫–æ–Ω–≤–µ–π–µ—Ä–∞ —Å—Ç–∞–¥–∏–π_.
–ò—Å–ø–æ–ª—å–∑—É—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ _–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞_ –æ–±—Ä–∞–∑, –æ–ø–∏—Å–∞–Ω–Ω—ã–π –≤ —Ç–æ–º –∂–µ `werf.yaml`, –≤—ã –ø–æ —Å—É—Ç–∏ –º–æ–∂–µ—Ç–µ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–π _–∫–æ–Ω–≤–µ–π–µ—Ä —Å—Ç–∞–¥–∏–π_.

<a class="google-drawings" href="{{ "images/configuration/base_image2.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/configuration/base_image2_preview.png" | true_relative_url }}">
</a>

### fromCacheVersion

–ö–∞–∫ –æ–ø–∏—Å–∞–Ω–æ –≤—ã—à–µ, –≤ –æ–±—ã—á–Ω–æ–º —Å–ª—É—á–∞–µ –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ.
–ü—Ä–∏ —Å–±–æ—Ä–∫–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ ‚Äî –∏–∑–º–µ–Ω–∏–ª—Å—è –ª–∏ _–±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑_.
–í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ —ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ digest –∏–ª–∏ –∏–º–µ–Ω–∏ –∏ —Ç–µ–≥–∞ –æ–±—Ä–∞–∑–∞.
–ï—Å–ª–∏ –æ–±—Ä–∞–∑ –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è, —Ç–æ –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ `from` –æ—Å—Ç–∞–µ—Ç—Å—è –ø—Ä–µ–∂–Ω–µ–π, –∏ –µ—Å–ª–∏ –≤ _stages storage_ –µ—Å—Ç—å –æ–±—Ä–∞–∑ —Å —Ç–∞–∫–∏–º –¥–∞–π–¥–∂–µ—Å—Ç–æ–º, —Ç–æ –æ–Ω –∏ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø—Ä–∏ —Å–±–æ—Ä–∫–µ.

–° –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `fromCacheVersion` –≤—ã –º–æ–∂–µ—Ç–µ –≤–ª–∏—è—Ç—å –Ω–∞ –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ `from` (—Ç.–∫. –∑–Ω–∞—á–µ–Ω–∏–µ `fromCacheVersion` ‚Äî —ç—Ç–æ —á–∞—Å—Ç—å –¥–∞–π–¥–∂–µ—Å—Ç–∞ —Å—Ç–∞–¥–∏–∏) –∏, —Ç–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π –æ–±—Ä–∞–∑–∞.
–ï—Å–ª–∏ –≤—ã –∏–∑–º–µ–Ω–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —É–∫–∞–∑–∞–Ω–Ω–æ–µ –≤ –¥–∏—Ä–µ–∫—Ç–∏–≤–µ `fromCacheVersion`, —Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –º–µ–Ω—è–ª—Å—è _–±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑_ (–∏–ª–∏ –µ–≥–æ digest) –∏–ª–∏ –æ—Å—Ç–∞–ª—Å—è –ø—Ä–µ–∂–Ω–∏–º, –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏–∑–º–µ–Ω–∏—Ç—Å—è –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ `from` –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞–¥–∏–π.
–≠—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ —Ç–æ–º—É, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —Å—Ç–∞–¥–∏–π –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω–æ.

```yaml
fromCacheVersion: <arbitrary string>
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ [Dockerfile](https://docs.docker.com/engine/reference/builder/) –º–æ–∂–Ω–æ —É—Å–ª–æ–≤–Ω–æ —Ä–∞–∑–¥–µ–ª–∏—Ç—å –Ω–∞ –¥–≤–µ –≥—Ä—É–ø–ø—ã: —Å–±–æ—Ä–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ manifest Docker-–æ–±—Ä–∞–∑–∞.
–¢–∞–∫ –∫–∞–∫ werf —Å–±–æ—Ä—â–∏–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è —Å–±–æ—Ä–∫–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–ª–µ–¥—É—é—â–∏–µ Dockerfile-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—Ç–æ—Ä–æ–π –≥—Ä—É–ø–ø—ã:

* `USER` ‚Äî –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∏–ª–∏ UID) –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –≥—Ä—É–ø–ø–∞ (–∏–ª–∏ GID) ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#user))
* `WORKDIR` ‚Äî —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#workdir))
* `VOLUME` ‚Äî —Ç–æ—á–∫–∞ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#volume))
* `ENV` ‚Äî –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#env))
* `LABEL` ‚Äî –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#label))
* `EXPOSE` ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ —Å–µ—Ç–µ–≤—ã—Ö –ø–æ—Ä—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –ø—Ä–æ—Å–ª—É—à–∏–≤–∞—Ç—å—Å—è –≤ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#expose))
* `ENTRYPOINT` ‚Äî –∫–æ–º–∞–Ω–¥–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#entrypoint))
* `CMD` ‚Äî –∞—Ä–≥—É–º–µ–Ω—Ç—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è `ENTRYPOINT` ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#cmd))
* `HEALTHCHECK` ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ Docker –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ([–ø–æ–¥—Ä–æ–±–Ω–µ–µ](https://docs.docker.com/engine/reference/builder/#healthcheck))

–≠—Ç–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `docker` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

–ü—Ä–∏–º–µ—Ä:

```yaml
docker:
  WORKDIR: /app
  CMD: ["python", "./index.py"]
  EXPOSE: '5000'
  ENV:
    TERM: xterm
    LC_ALL: en_US.UTF-8
```

–£–∫–∞–∑–∞–Ω–Ω—ã–µ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞–¥–∏–∏ –∫–æ–Ω–≤–µ–π–µ—Ä–∞ —Å—Ç–∞–¥–∏–π, —Å—Ç–∞–¥–∏–∏ `docker_instructions`.
–ü–æ—ç—Ç–æ–º—É —É–∫–∞–∑–∞–Ω–∏–µ Docker-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –≤ `werf.yaml` –Ω–∏–∫–∞–∫ –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Å–∞–º –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏, –∞ —Ç–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∫ —É–∂–µ —Å–æ–±—Ä–∞–Ω–Ω–æ–º—É –æ–±—Ä–∞–∑—É.

–ï—Å–ª–∏ –≤–∞–º —Ç—Ä–µ–±—É—é—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TERM`), —Ç–æ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [–±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑]({{ "advanced/building_images_with_stapel/base_image.html" | true_relative_url }}), –≤ –∫–æ—Ç–æ—Ä–æ–º —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–ª–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ [_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_]({{ "advanced/building_images_with_stapel/assembly_instructions.html#–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ-—Å—Ç–∞–¥–∏–∏" | true_relative_url }}).

## –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –∏–∑ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

### –ß—Ç–æ —Ç–∞–∫–æ–µ git mapping?

***Git mapping*** –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫–æ–π —Ñ–∞–π–ª –∏–ª–∏ –ø–∞–ø–∫–∞ –∏–∑ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–µ –º–µ—Å—Ç–æ –æ–±—Ä–∞–∑–∞.
Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –º–æ–∂–µ—Ç –±—ã—Ç—å –∫–∞–∫ –ª–æ–∫–∞–ª—å–Ω—ã–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ (`werf.yaml`), —Ç–∞–∫ –∏ —É–¥–∞–ª–µ–Ω–Ω—ã–º.
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–¥—Ä–µ—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏ –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞ ‚Äî –≤–µ—Ç–∫–∞, —Ç–µ–≥ –∏–ª–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–º–º–∏—Ç.

werf –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –æ–±—Ä–∞–∑, –∫–æ–ø–∏—Ä—É—è –∏—Ö —Å –ø–æ–º–æ—â—å—é [git archive](https://git-scm.com/docs/git-archive), –ª–∏–±–æ –Ω–∞–∫–ª–∞–¥—ã–≤–∞—è Git-–ø–∞—Ç—á.
–ü—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö —Å–±–æ—Ä–∫–∞—Ö –∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ werf –¥–æ–±–∞–≤–ª—è–µ—Ç patch –∫ —Å–æ–±—Ä–∞–Ω–Ω–æ–º—É —Ä–∞–Ω–µ–µ –æ–±—Ä–∞–∑—É, —á—Ç–æ–±—ã –≤ –∫–æ–Ω–µ—á–Ω–æ–º –æ–±—Ä–∞–∑–µ –æ—Ç—Ä–∞–∑–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–Ω–æ—Å–∞ —Ñ–∞–π–ª–æ–≤ –∏ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–Ω–∏—è –ø–∞—Ç—á–µ–π —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è [–≤ —Å–ª–µ–¥—É—é—â–µ–π —Å–µ–∫—Ü–∏–∏](#–ø–æ–¥—Ä–æ–±–Ω–µ–µ-–ø—Ä–æ-gitarchive-gitcache-gitlatestpatch).

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è _git mapping_ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ª—é–±—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –æ–±—Ä–∞–∑–µ, –∏—Å–ø–æ–ª—å–∑—É—è –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ _git mappings_.
–¢–∞–∫–∂–µ –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –≥—Ä—É–ø–ø—É –∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–æ–Ω–µ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –≤ –æ–±—Ä–∞–∑–µ, —á—Ç–æ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –æ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –¥–µ–ª–∞—Ç—å —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π (`chown`).

–í werf —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–∞–±–º–æ–¥—É–ª–µ–π Git (git submodules) –∏ –µ—Å–ª–∏ werf –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, —á—Ç–æ –∫–∞–∫–∞—è-—Ç–æ —á–∞—Å—Ç—å _git mapping_ —è–≤–ª—è–µ—Ç—Å—è —Å–∞–±–º–æ–¥—É–ª–µ–º, —Ç–æ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –º–µ—Ä—ã, —á—Ç–æ–±—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–∞–±–º–æ–¥—É–ª—è—Ö –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

> –í—Å–µ Git-—Å–∞–±–º–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å–≤—è–∑–∞–Ω—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∫–æ–º–º–∏—Ç–æ–º, –ø–æ—ç—Ç–æ–º—É –≤—Å–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏, —Ä–∞–±–æ—Ç–∞—é—â–∏–µ —Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º —Å —Å–∞–±–º–æ–¥—É–ª—è–º–∏, –ø–æ–ª—É—á–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ.
> werf –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–∞–±–º–æ–¥—É–ª–∏, –∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∫–æ–º–º–∏—Ç—ã.

–ü—Ä–∏–º–µ—Ä –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏–∑ –ø–∞–ø–∫–∏ `/src` –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –ø–∞–ø–∫—É `/app` —Å–æ–±–∏—Ä–∞–µ–º–æ–≥–æ –æ–±—Ä–∞–∑–∞ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ PhantomJS –∏–∑ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –ø–∞–ø–∫—É `/src/phantomjs` —Å–æ–±–∏—Ä–∞–µ–º–æ–≥–æ –æ–±—Ä–∞–∑–∞:

```yaml
git:
- add: /src
  to: /app
- url: https://github.com/ariya/phantomjs
  add: /
  to: /src/phantomjs
```

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

–î–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞ –∏–∑ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å:

- `add` ‚Äî (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä) –ø—É—Ç—å –∫ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∏–ª–∏ —Ñ–∞–π–ª—É, —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ—Ç–æ—Ä–æ–≥–æ (–∫–æ—Ç–æ—Ä–æ–π) –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –≤ –æ–±—Ä–∞–∑. –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å *–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –∫–æ—Ä–Ω—è* —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, —Ç.–µ. –æ–Ω –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å `/`. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `add` —Ä–∞–≤–Ω–æ—Å–∏–ª—å–Ω–æ —É–∫–∞–∑–∞–Ω–∏—é `add: /`;
- `to` ‚Äî –ø—É—Ç—å –≤–Ω—É—Ç—Ä–∏ –æ–±—Ä–∞–∑–∞, –∫—É–¥–∞ –±—É–¥–µ—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ;
- `owner` ‚Äî –∏–º—è –∏–ª–∏ id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–æ–≤ –≤ –æ–±—Ä–∞–∑–µ;
- `group` ‚Äî –∏–º—è –∏–ª–∏ id –≥—Ä—É–ø–ø—ã-–≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–æ–≤ –≤ –æ–±—Ä–∞–∑–µ;
- `excludePaths` ‚Äî —Å–ø–∏—Å–æ–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (–º–∞—Å–∫–∞) –ø—Ä–∏ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–º –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫. –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—É—Ç–∏, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ `add`;
- `includePaths` ‚Äî —Å–ø–∏—Å–æ–∫ –º–∞—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –¥–ª—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –£–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—É—Ç–∏, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ `add`;
- `stageDependencies` ‚Äî —Å–ø–∏—Å–æ–∫ –º–∞—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ —Å—Ç–∞–¥–∏–∏ –æ—Ç –∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π. –ü–æ–∑–≤–æ–ª—è–µ—Ç —É–∫–∞–∑–∞—Ç—å, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å—Ç–∞–¥–∏—é. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç—Å—è [–∑–¥–µ—Å—å]({{ "advanced/building_images_with_stapel/assembly_instructions.html" | true_relative_url }}).

–ü—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —É–¥–∞–ª–µ–Ω–Ω—ã—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
- `url` ‚Äî –∞–¥—Ä–µ—Å —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è;
- `branch`, `tag`, `commit` ‚Äî –∏–º—è –≤–µ—Ç–∫–∏, —Ç–µ–≥–∞ –∏–ª–∏ –∫–æ–º–º–∏—Ç–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ. –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –≤–µ—Ç–∫–∞ master.

> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `branch` –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≥–∏—Ç–µ—Ä–º–∏–Ω–∏–∑–º–æ–º (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–º [–≤ —Å—Ç–∞—Ç—å–µ]({{ "advanced/giterminism.html" | true_relative_url }})).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ git mapping

#### –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π

–ü–∞—Ä–∞–º–µ—Ç—Ä `add` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫, –ø—É—Ç—å –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –æ—Ç–∫—É–¥–∞ —Ñ–∞–π–ª—ã —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∫–æ–ø–∏—Ä—É—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑ –∏ –ø–æ–º–µ—â–∞—é—Ç—Å—è –ø–æ –∞–¥—Ä–µ—Å—É, —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `to`. –ï—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, —Ç–æ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏–µ `/`, —Ç.–µ. –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤–µ—Å—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.
–ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–µ–π—à–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –¥–æ–±–∞–≤–ª—è—é—â–µ–π —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤—Å–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ –æ–±—Ä–∞–∑ –≤ –ø–∞–ø–∫—É `/app`.

```yaml
git:
- add: /
  to: /app
```

<div class="tabs">
  <a href="javascript:void(0)" class="tabs__btn btn__example1 active" onclick="openTab(event, 'btn__example1', 'tab__example1', 'git-mapping-01-source')">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</a>
  <a href="javascript:void(0)" class="tabs__btn btn__example1" onclick="openTab(event, 'btn__example1', 'tab__example1', 'git-mapping-01-dest')">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –æ–±—Ä–∞–∑–µ</a>
</div>
<div id="git-mapping-01-source" class="tabs__content tab__example1 active">
  <img src="{{ "images/build/git_mapping_01.png" | true_relative_url }}" alt="git repository files tree" />
</div>
<div id="git-mapping-01-dest" class="tabs__content tab__example1">
  <img src="{{ "images/build/git_mapping_02.png" | true_relative_url }}" alt="image files tree" />
</div>

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ _git mappings_:

```yaml
git:
- add: /src
  to: /app/src
- add: /assets
  to: /static
```

<div class="tabs">
  <a href="javascript:void(0)" class="tabs__btn btn__example2 active" onclick="openTab(event, 'btn__example2', 'tab__example2', 'git-mapping-02-source')">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</a>
  <a href="javascript:void(0)" class="tabs__btn btn__example2" onclick="openTab(event, 'btn__example2', 'tab__example2', 'git-mapping-02-dest')">–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –æ–±—Ä–∞–∑–µ</a>
</div>
<div id="git-mapping-02-source" class="tabs__content tab__example2 active">
  <img src="{{ "images/build/git_mapping_03.png" | true_relative_url }}" alt="git repository files tree" />
</div>
<div id="git-mapping-02-dest" class="tabs__content tab__example2">
  <img src="{{ "images/build/git_mapping_04.png" | true_relative_url }}" alt="image files tree" />
</div>

–°–ª–µ–¥—É–µ—Ç –æ—Ç–º–µ—Ç–∏—Ç—å, —á—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è _git mapping_ –Ω–µ –ø–æ—Ö–æ–∂–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–∞ `cp -r /src /app`.
–ü–∞—Ä–∞–º–µ—Ç—Ä `add` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ *—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ* –∫–∞—Ç–∞–ª–æ–≥–∞, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ—Ç —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å—Å—è –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.
–ü–æ—ç—Ç–æ–º—É, –µ—Å–ª–∏ –ø–∞–ø–∫–∞ `/assets` —Å–æ –≤—Å–µ–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –ø–∞–ø–∫—É `/app/assets` –æ–±—Ä–∞–∑–∞, —Ç–æ –∏–º—è *assets* –≤—ã –¥–æ–ª–∂–Ω—ã —É–∫–∞–∑–∞—Ç—å –¥–≤–∞ —Ä–∞–∑–∞.
–õ–∏–±–æ, –∫–∞–∫ –≤–∞—Ä–∏–∞–Ω—Ç, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [—Ñ–∏–ª—å—Ç—Ä](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-—Ñ–∏–ª—å—Ç—Ä–æ–≤) (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–∞—Ä–∞–º–µ—Ç—Ä `includePaths`).

–ü—Ä–∏–º–µ—Ä—ã –æ–±–æ–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
```yaml
git:
- add: /assets
  to: /app/assets
```

–ª–∏–±–æ

```yaml
git:
- add: /
  to: /app
  includePaths: assets
```

#### –ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü–∞

–ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ –∏–∑ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –∏–º—è –∏/–∏–ª–∏ –≥—Ä—É–ø–ø—É –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ñ–∞–π–ª–æ–≤ –≤ –æ–±—Ä–∞–∑–µ.
–î–æ–±–∞–≤–ª—è–µ–º—ã–º —Ñ–∞–π–ª–∞–º –∏ –ø–∞–ø–∫–∞–º –≤ –æ–±—Ä–∞–∑–µ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏ –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–∞–≤–∞.
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –≥—Ä—É–ø–ø–∞ –º–æ–≥—É—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω—ã –∫–∞–∫ –∏–º–µ–Ω–µ–º, —Ç–∞–∫ –∏ —á–∏—Å–ª–æ–≤—ã–º id (userid, groupid).

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```yaml
git:
- add: /src/index.php
  to: /app/index.php
  owner: www-data
```

–ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω —Ç–æ–ª—å–∫–æ –ø–∞—Ä–∞–º–µ—Ç—Ä `owner`, –∫–∞–∫ –≤ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ, —Ç–æ –≥—Ä—É–ø–ø–æ–π-–≤–ª–∞–¥–µ–ª—å—Ü–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–∞—è –≥—Ä—É–ø–ø–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–∏—Å—Ç–µ–º–µ.

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤ –ø–∞–ø–∫—É `/app` –æ–±—Ä–∞–∑–∞ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω —Ñ–∞–π–ª `index.php` –∏ –µ–º—É –±—É–¥—É—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø—Ä–∞–≤–∞:

![index.php owned by www-data user and group]({{ "images/build/git_mapping_05.png" | true_relative_url }})

–ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `owner` –∏–ª–∏ `group` –Ω–µ —á–∏—Å–ª–æ–≤—ã–µ id, –∞ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ (—Ç.–µ. –Ω–∞–∑–≤–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≥—Ä—É–ø–ø—ã), —Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏ –≥—Ä—É–ø–ø–∞ –¥–æ–ª–∂–Ω—ã —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º–µ. –ò—Ö –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞—Ä–∞–Ω–µ–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–∫ –ø—Ä–∏–º–µ—Ä—É, –Ω–∞ —Å—Ç–∞–¥–∏–∏ _beforeInstall_), –∏–Ω–∞—á–µ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –≤–æ–∑–Ω–∏–∫–Ω–µ—Ç –æ—à–∏–±–∫–∞.

```yaml
git:
- add: /src/index.php
  to: /app/index.php
  owner: wwwdata
```

#### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤

–ü–∞—Ä–∞–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤, `includePaths` –∏ `excludePaths`, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.
–≠—Ç–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–¥–µ—Ä–∂–∞—Ç –Ω–∞–±–æ—Ä –ø—É—Ç–µ–π –∏–ª–∏ –º–∞—Å–æ–∫, –ø—Ä–∏–º–µ–Ω—è–µ–º—ã—Ö —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –æ–±—Ä–∞–∑.

–§–∏–ª—å—Ç—Ä `excludePaths` —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º: –∫–∞–∂–¥–∞—è –º–∞—Å–∫–∞ —Å–ø–∏—Å–∫–∞ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∫–∞–∂–¥–æ–º—É —Ñ–∞–π–ª—É, –Ω–∞–π–¥–µ–Ω–Ω–æ–º—É –ø–æ –ø—É—Ç–∏ `add`.
–ï—Å–ª–∏ —Ñ–∞–π–ª —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –º–∞—Å–∫–µ, —Ç–æ –æ–Ω –∏—Å–∫–ª—é—á–∞–µ—Ç—Å—è –∏–∑ —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ –Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ.
–ï—Å–ª–∏ —Ñ–∞–π–ª –Ω–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –º–∞—Å–∫–µ, —Ç–æ –æ–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑.

–§–∏–ª—å—Ç—Ä `includePaths` —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–æ–±–æ—Ä–æ—Ç ‚Äî –µ—Å–ª–∏ —Ñ–∞–π–ª —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –º–∞—Å–∫–µ, —Ç–æ –æ–Ω –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑.

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è _git mapping_ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –æ–±–∞ —Ñ–∏–ª—å—Ç—Ä–∞.
–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑, –µ—Å–ª–∏ –µ–≥–æ –ø—É—Ç—å —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ–π –º–∞—Å–∫–µ `includePaths` –∏ –Ω–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –Ω–∏ –æ–¥–Ω–æ–π –º–∞—Å–∫–µ `excludePaths`.

–ü—Ä–∏–º–µ—Ä:

```yaml
git:
- add: /src
  to: /app
  includePaths:
  - '**/*.php'
  - '**/*.js'
  excludePaths:
  - '**/*-dev.*'
  - '**/*-test.*'
```

–í –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è `.php` –∏ `.js` —Ñ–∞–π–ª—ã –∏–∑ –ø–∞–ø–∫–∏  `/src` –∏—Å–∫–ª—é—á–∞—è —Ñ–∞–π–ª—ã —Å —Å—É—Ñ—Ñ–∏–∫—Å–æ–º `-dev.` –∏–ª–∏ `-test.` –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞.

> –ü–æ—Å–ª–µ–¥–Ω–∏–π —à–∞–≥ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º —Å—É—Ñ—Ñ–∏–∫—Å–∞`**/*` —Å–¥–µ–ª–∞–Ω –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ ‚Äî –≤–∞–º –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö _git mapping_, —á—Ç–æ–±—ã –≤—Å–µ –µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–ª–æ —à–∞–±–ª–æ–Ω—É –ø–∞—Ä–∞–º–µ—Ç—Ä–∞

–ú–∞—Å–∫–∞ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—ã:

- `*` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –ª—é–±–æ–º—É —Ñ–∞–π–ª—É. –®–∞–±–ª–æ–Ω –≤–∫–ª—é—á–∞–µ—Ç `.` –∏ –∏—Å–∫–ª—é—á–∞–µ—Ç `/`.
- `**` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ –≤—Å–µ–º –µ–µ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ.
- `?` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –ª—é–±–æ–º—É **–æ–¥–Ω–æ–º—É** —Å–∏–º–≤–æ–ª—É –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ regexp-—à–∞–±–ª–æ–Ω—É `/.{1}/`).
- `[set]` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –ª—é–±–æ–º—É —Å–∏–º–≤–æ–ª—É –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Å–∏–º–≤–æ–ª–æ–≤. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ regexp-—à–∞–±–ª–æ–Ω–∞—Ö, –≤–∫–ª—é—á–∞—è —É–∫–∞–∑–∞–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Ç–∏–ø–∞ `[^a-z]`.
- `\` ‚Äî –≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–∏–º–≤–æ–ª.

–ú–∞—Å–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —à–∞–±–ª–æ–Ω–∞ `*` –∏–ª–∏ `**`, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∑—è—Ç–∞ –≤ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∏–ª–∏ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤ `werf.yaml`:
- `"*.rb"` ‚Äî –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏;
- `'**/*'` ‚Äî –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏.

–ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤:

```yaml
add: /src
to: /app
includePaths:
# –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –≤—Å–µ–º php —Ñ–∞–π–ª–∞–º, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ –≤ –ø–∞–ø–∫–µ /src.
- '*.php'

# –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –≤—Å–µ–º php —Ñ–∞–π–ª–∞–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ, –Ω–∞—á–∏–Ω–∞—è —Å –ø–∞–ø–∫–∏ /src
# (—Ç–∞–∫–∂–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç —Ñ–∞–π–ª–∞–º *.php, —Ç.–∫. '.' –≤–∫–ª—é—á–∞–µ—Ç—Å—è —à–∞–±–ª–æ–Ω **).
- '**/*.php'

# –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –≤—Å–µ–º —Ñ–∞–π–ª–∞–º –≤ –ø–∞–ø–∫–µ /src/module1 —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ.
- module1
```

–§–∏–ª—å—Ç—Ä `includePaths` –º–æ–∂–µ—Ç –ø—Ä–∏–º–µ–Ω—è—Ç—å—Å—è –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∏–º–µ–Ω–∏. –ü—Ä–∏–º–µ—Ä:
```yaml
git:
- add: /src
  to: /app
  includePaths: index.php
```

#### –ù–∞–ª–æ–∂–µ–Ω–∏–µ –ø—É—Ç–µ–π –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è

–ï—Å–ª–∏ –≤—ã –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ _git mappings_, –≤—ã –¥–æ–ª–∂–Ω—ã —É—á–∏—Ç—ã–≤–∞—Ç—å, —á—Ç–æ –ø—Ä–∏ –Ω–∞–ª–æ–∂–µ–Ω–∏–∏ –ø—É—Ç–µ–π –≤ –æ–±—Ä–∞–∑–µ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `to` –≤—ã –º–æ–∂–µ—Ç–µ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤. –ü—Ä–∏–º–µ—Ä:

```yaml
git:
- add: /src
  to: /app
- add: /assets
  to: /app/assets
```

–ß—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Å–±–æ—Ä–∫–∏, werf –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–µ –Ω–∞–ª–æ–∂–µ–Ω–∏—è –∫–∞—Å–∞—é—â–∏–µ—Å—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ `includePaths` –∏ `excludePaths`, –∏ –µ—Å–ª–∏ —Ç–∞–∫–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —Ç–æ werf –ø—ã—Ç–∞–µ—Ç—Å—è —Ä–∞–∑—Ä–µ—à–∏—Ç—å —Å–∞–º—ã–µ –ø—Ä–æ—Å—Ç—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, –Ω–µ—è–≤–Ω–æ –¥–æ–±–∞–≤–ª—è—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä `excludePaths` –≤ _git mapping_.
–û–¥–Ω–∞–∫–æ, —Ç–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–µ—Ç –≤—Å–µ-—Ç–∞–∫–∏ –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º, –ø–æ—ç—Ç–æ–º—É –ª—É—á—à–µ –≤—Å–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å –Ω–∞–ª–æ–∂–µ–Ω–∏—è –ø—É—Ç–µ–π –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏ _git mappings_.

–í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ werf –≤ –∏—Ç–æ–≥–µ –Ω–µ—è–≤–Ω–æ –¥–æ–±–∞–≤–∏—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä  `excludePaths`, –∏ –∏—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–µ–π:

```yaml
git:
- add: /src
  to: /app
  excludePaths:  # werf –¥–æ–±–∞–≤–∏–ª —ç—Ç–æ—Ç —Ñ–∏–ª—å—Ç—Ä, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –Ω–∞–ª–æ–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏—Ö –ø—É—Ç–µ–π
  - assets       # –º–µ–∂–¥—É /src/assets –∏ /assets
- add: /assets
  to: /app/assets
```

### –†–∞–±–æ—Ç–∞ —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

werf –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ —Ñ–∞–π–ª–æ–≤.
–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –∞–¥—Ä–µ—Å–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `url`.
werf –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º `https` –∏ `git+ssh`.

#### HTTPS

–°–∏–Ω—Ç–∞–∫—Å–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã –ø–æ –ø—Ä–æ—Ç–æ–∫–æ–ª—É `https`:

{% raw %}
```yaml
git:
- url: https://[USERNAME[:PASSWORD]@]repo_host/repo_path[.git/]
```
{% endraw %}

–£–∫–∞–∑–∞–Ω–∏–µ –ª–æ–≥–∏–Ω–∞ –∏ –ø–∞—Ä–æ–ª—è –ø—Ä–∏ –¥–æ—Å—Ç—É–ø–µ –ø–æ `https` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.

–ü—Ä–∏–º–µ—Ä –¥–æ—Å—Ç—É–ø–∞ –∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é –∏–∑ pipeline GitLab CI —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:

{% raw %}
```yaml
git:
- url: https://{{ env "CI_REGISTRY_USER" }}:{{ env "CI_JOB_TOKEN" }}@registry.gitlab.company.name/common/helper-utils.git
```
{% endraw %}

–í –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º –ø—Ä–∏–º–µ—Ä–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–µ—Ç–æ–¥ [env](http://masterminds.github.io/sprig/os.html) –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ [Sprig](http://masterminds.github.io/sprig/) –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º –æ–∫—Ä—É–∂–µ–Ω–∏—è.

#### Git, SSH

–î–æ—Å—Ç—É–ø –∫ —É–¥–∞–ª–µ–Ω–Ω–æ–º—É —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—é —Å –ø–æ–º–æ—â—å—é –ø—Ä–æ—Ç–æ–∫–æ–ª–∞ `git` –∑–∞—â–∏—â–∞–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –¥–æ—Å—Ç—É–ø–∞ –ø–æ–≤–µ—Ä—Ö SSH. –≠—Ç–æ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –≤ —á–∞—Å—Ç–Ω–æ—Å—Ç–∏ GitHub, Bitbucket, GitLab, Gogs, Gitolite –∏ —Ç.–¥. –û–±—ã—á–Ω–æ –∞–¥—Ä–µ—Å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤—ã–≥–ª—è–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

```yaml
git:
- url: git@gitlab.company.name:project_group/project.git
```

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –ø–æ SSH –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫ werf –Ω–∞—Ö–æ–¥–∏—Ç SSH-–∫–ª—é—á–∏ (—á–∏—Ç–∞–π –¥–∞–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ).

##### –†–∞–±–æ—Ç–∞ —Å SSH-–∫–ª—é—á–∞–º–∏

SSH-–∫–ª—é—á–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ SSH-agent. SSH-agent ‚Äî —ç—Ç–æ –¥–µ–º–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ —Ñ–∞–π–ª–æ–≤—ã–π —Å–æ–∫–µ—Ç, –ø—É—Ç—å –∫ –∫–æ—Ç–æ—Ä–æ–º—É —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `SSH_AUTH_SOCK`. werf –º–æ–Ω—Ç–∏—Ä—É–µ—Ç —ç—Ç–æ—Ç —Ñ–∞–π–ª–æ–≤—ã–π —Å–æ–∫–µ—Ç –≤–æ –≤—Å–µ _—Å–±–æ—Ä–æ—á–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã_ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `SSH_AUTH_SOCK`. –¢.e. —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–º —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∫–ª—é—á–µ–π, –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤ –∑–∞–ø—É—â–µ–Ω–Ω–æ–º SSH-–∞–≥–µ–Ω—Ç–µ.

werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ SSH-–∞–≥–µ–Ω—Ç–∞:

- werf –∑–∞–ø—É—â–µ–Ω —Å –∫–ª—é—á–æ–º `--ssh-key` (–æ–¥–Ω–∏–º –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏):
  - –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π SSH-–∞–≥–µ–Ω—Ç, –≤ –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ werf –∫–ª—é—á–∏. –≠—Ç–∏ –∫–ª—é—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏.
  - –£–∂–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π SSH-–∞–≥–µ–Ω—Ç –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è.
- werf –∑–∞–ø—É—â–µ–Ω –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –∫–ª—é—á–∞ `--ssh-key` –∏ –µ—Å—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–π SSH-–∞–≥–µ–Ω—Ç:
  - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è `SSH_AUTH_SOCK`, –∫–ª—é—á–∏ –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π SSH-–∞–≥–µ–Ω—Ç –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–∞–ª–µ–µ –ø—Ä–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Ä–∞–±–æ—Ç—ã —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏.
- werf –∑–∞–ø—É—â–µ–Ω –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –∫–ª—é—á–∞ `--ssh-key` –∏ –Ω–µ—Ç –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ SSH-–∞–≥–µ–Ω—Ç–∞:
  - –ï—Å–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Ñ–∞–π–ª `~/.ssh/id_rsa`, –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤—Ä–µ–º–µ–Ω–Ω—ã–π SSH-–∞–≥–µ–Ω—Ç, –≤ –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á –∏–∑ —Ñ–∞–π–ª–∞ `~/.ssh/id_rsa`.
- –ï—Å–ª–∏ –Ω–∏ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–º, —Ç–æ SSH-–∞–≥–µ–Ω—Ç –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏ –ø—Ä–∏ –æ–ø–µ—Ä–∞—Ü–∏—è—Ö —Å –≤–Ω–µ—à–Ω–∏–º–∏ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –Ω–∏–∫–∞–∫–∏–µ SSH-–∫–ª—é—á–∏. –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞, —Å –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã–º–∏ —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –≤ _git mapping_, –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π.

### –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ gitArchive, gitCache, gitLatestPatch

–î–∞–ª–µ–µ –±—É–¥–µ—Ç –±–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ–Ω–µ—á–Ω—ã–π –æ–±—Ä–∞–∑. –ö–∞–∫ —É–ø–æ–º–∏–Ω–∞–ª–æ—Å—å —Ä–∞–Ω–µ–µ, Docker-–æ–±—Ä–∞–∑ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–∞–±–æ—Ä–∞ —Å–ª–æ—ë–≤. –ß—Ç–æ–±—ã –ø–æ–Ω–∏–º–∞—Ç—å, –∫–∞–∫–∏–µ —Å–ª–æ–∏ —Å–æ–∑–¥–∞–µ—Ç werf, –ø—Ä–µ–¥—Å—Ç–∞–≤–∏–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—É—é —Å–±–æ—Ä–∫—É —Ç—Ä–µ—Ö –∫–æ–º–º–∏—Ç–æ–≤: `1`, `2` –∏ `3`:

- –°–±–æ—Ä–∫–∞ –∫–æ–º–º–∏—Ç–∞ 1. –ò—Å—Ö–æ–¥—è –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ _git mapping_, –≤—Å–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤ –æ–¥–∏–Ω —Å–ª–æ–π. –°–∞–º –ø—Ä–æ—Ü–µ—Å—Å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é `git archive`. –ü–æ–ª—É—á–∏–≤—à–∏–π—Å—è —Å–ª–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–¥–∏–∏ _gitArchive_.
- –°–±–æ—Ä–∫–∞ –∫–æ–º–º–∏—Ç–∞ 2. –ù–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –ø–∞—Ç—á —Å –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ —Ñ–∞–π–ª–æ–≤, –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —á–µ–≥–æ –ø–æ–ª—É—á–∞–µ—Ç—Å—è –µ—â–µ –æ–¥–∏–Ω —Å–ª–æ–π. –ü–æ–ª—É—á–∏–≤—à–∏–π—Å—è —Å–ª–æ–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞–¥–∏–∏ _gitLatestPatch_.
- –°–±–æ—Ä–∫–∞ –∫–æ–º–º–∏—Ç–∞ 3. –§–∞–π–ª—ã —É–∂–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã, –∏ werf –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –ø–∞—Ç—á, –æ–±–Ω–æ–≤–ª—è—è —Å–ª–æ–π _gitLatestPatch_.

–°–±–æ—Ä–∫–∏ –¥–ª—è —ç—Ç–∏—Ö –∫–æ–º–º–∏—Ç–æ–≤ –º–æ–∂–Ω–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å ‚Äã‚Äã—Å–ª–µ–¥—É—é—â–∏–º –æ–±—Ä–∞–∑–æ–º:

| | gitArchive | gitLatestPatch |
|---|:---:|:---:|
| Commit No. 1 is made, build at 10:00 |  files as in commit No. 1 | - |
| Commit No. 2 is made, build at 10:05 |  files as in commit No. 1 | files as in commit No. 2 |
| Commit No. 3 is made, build at 10:15 |  files as in commit No. 1 | files as in commit No. 3 |

–°–æ –≤—Ä–µ–º–µ–Ω–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–∏—Ç–æ–≤ —Ä–∞—Å—Ç–µ—Ç, –∏ —Ä–∞–∑–º–µ—Ä –ø–∞—Ç—á–∞ –º–µ–∂–¥—É –∫–æ–º–º–∏—Ç–æ–º ‚Ññ1 –∏ —Ç–µ–∫—É—â–∏–º –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å –¥–æ–≤–æ–ª—å–Ω–æ –±–æ–ª—å—à–∏–º. –≠—Ç–æ –µ—â–µ –±–æ–ª—å—à–µ —É–≤–µ–ª–∏—á–∏—Ç —Ä–∞–∑–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–æ—è –∏ –æ–±—â–∏–π —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–¥–∏–π. –ß—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–æ—Å—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–ª–æ—è, werf –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–π —ç—Ç–∞–ø ‚Äî _gitCache_. –ö–æ–≥–¥–∞ _gitLatestPatch_ diff —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º, –±–æ–ª—å—à–∞—è —á–∞—Å—Ç—å –µ–≥–æ diff –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç—Å—è —Å _gitCache_ diff, —Ç–µ–º —Å–∞–º—ã–º —É–º–µ–Ω—å—à–∞—è —Ä–∞–∑–º–µ—Ä —Å—Ç–∞–¥–∏–∏ _gitLatestPatch_.

#### Rebase –∏ _git-—Å—Ç–∞–¥–∏–∏_

–ö–∞–∂–¥–∞—è Git-—Å—Ç–∞–¥–∏—è —Ö—Ä–∞–Ω–∏—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ –ª–µ–π–±–ª—ã —Å SHA –∫–æ–º–º–∏—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Å—Ç–∞–¥–∏–∏.
–≠—Ç–∏ –∫–æ–º–º–∏—Ç—ã –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —Å–ª–µ–¥—É—é—â–µ–π Git-—Å—Ç–∞–¥–∏–∏ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–∞—Ç—á–µ–π (–ø–æ —Å—É—Ç–∏ —ç—Ç–æ `git diff COMMIT_FROM_PREVIOUS_GIT_STAGE LATEST_COMMIT` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ _git-mapping_).

–ï—Å–ª–∏ –≤ —Å—Ç–∞–¥–∏–∏ —Å–æ—Ö—Ä–∞–Ω—ë–Ω –∫–æ–º–º–∏—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è rebase), werf –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç —ç—Ç—É —Å—Ç–∞–¥–∏—é, –∏—Å–ø–æ–ª—å–∑—É—è –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∫–æ–º–º–∏—Ç.

## –ó–∞–ø—É—Å–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å–±–æ—Ä–∫–∏

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∞–¥–∏–∏

***–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∞–¥–∏–∏*** ‚Äî —ç—Ç–æ [_—Å—Ç–∞–¥–∏–∏_]({{ "internals/stages_and_storage.html" | true_relative_url }}) —Å–æ —Å–±–æ—Ä–æ—á–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –∏–∑ [–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏]({{ "reference/werf_yaml.html#—Å–µ–∫—Ü–∏—è-image" | true_relative_url }}). –î—Ä—É–≥–∏–º–∏ —Å–ª–æ–≤–∞–º–∏ ‚Äî —ç—Ç–æ —Å—Ç–∞–¥–∏–∏, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º (—Å—É—â–µ—Å—Ç–≤—É—é—Ç —Ç–∞–∫–∂–µ —Å–ª—É–∂–µ–±–Ω—ã–µ —Å—Ç–∞–¥–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –º–æ–∂–µ—Ç). –í –Ω–∞—Å—Ç–æ—è—â–µ–µ –≤—Ä–µ–º—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –¥–≤–∞ –≤–∏–¥–∞ —Å–±–æ—Ä–æ—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π: _shell_ –∏ _ansible_.

werf –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á–µ—Ç—ã—Ä–µ _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∞–¥–∏–∏_, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ—Ä—è–¥–∫–µ: _beforeInstall_, _install_, _beforeSetup_ –∏ _setup_. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω Docker-—Å–ª–æ–π. –¢.–µ. –ø–æ –æ–¥–Ω–æ–º—É —Å–ª–æ—é –Ω–∞ –∫–∞–∂–¥—É—é —Å—Ç–∞–¥–∏—é –≤–Ω–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π

werf –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –¥–æ —á–µ—Ç—ã—Ä–µ—Ö _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ —Å–±–æ—Ä–∫–∏. –ù–∞ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–∞–º–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å–±–æ—Ä–∫–∏ werf –Ω–µ –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç –∫–∞–∫–∏—Ö-–ª–∏–±–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, —Ç.–µ. –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤—Å–µ —Ç–µ –∂–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —É–∫–∞–∑—ã–≤–∞–ª–∏ –≤ Dockerfile –≤ –¥–∏—Ä–µ–∫—Ç–∏–≤–µ `RUN`. –û–¥–Ω–∞–∫–æ –≤–∞–∂–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–Ω–µ—Å—Ç–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –∏–∑ Dockerfile, –∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–±–∏—Ç—å –∏—Ö –Ω–∞ _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∞–¥–∏–∏_. –ò—Å—Ö–æ–¥—è –∏–∑ –æ–ø—ã—Ç–∞ —Ä–∞–±–æ—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, –º—ã –ø—Ä–∏—à–ª–∏ –∫ –∑–∞–∫–ª—é—á–µ–Ω–∏—é, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã:

- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤;
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π;
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
- –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤;
- –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–ö–∞–∫–∞—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–∏–ª—É—á—à–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —ç—Ç–∞–ø–æ–≤?

–ü–µ—Ä–≤–∞—è –º—ã—Å–ª—å ‚Äî –ª—É—á—à–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —ç—Ç–∏ —ç—Ç–∞–ø—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –∫—ç—à–∏—Ä—É—è –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, –∞ —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã ‚Äì —Ä–∞–∑–±–∏–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —Ñ–∞–π–ª–æ–≤—ã–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º.

–ü–æ–¥—Ö–æ–¥ —Å _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ —Å—Ç–∞–¥–∏—è–º–∏_ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–¥–∏—é _beforeInstall_ –¥–ª—è –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤;
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–¥–∏—é _install_ –¥–ª—è –∏–Ω—Å—Ç–∞–ª–ª—è—Ü–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–¥–∏—é _beforeSetup_ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è;
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–¥–∏—é _setup_ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

#### beforeInstall

–î–∞–Ω–Ω–∞—è —Å—Ç–∞–¥–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–µ—Ä–µ–¥ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
–≠—Ç–æ—Ç —ç—Ç–∞–ø –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è, –Ω–æ —Ç—Ä–µ–±—É—é—Ç –º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏.
–ü—Ä–∏–º–µ—Ä–æ–º —Ç–∞–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –º–æ–≥—É—Ç –±—ã—Ç—å —è–∑—ã–∫–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Å–±–æ—Ä–∫–∏, —Ç–∞–∫–∏–µ –∫–∞–∫ Composer, Java, Gradle –∏ —Ç.–¥.
–¢–∞–∫–∂–µ —Å—é–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–¥–∫–æ –∏–∑–º–µ–Ω—è—é—Ç—Å—è.
–ù–∞–ø—Ä–∏–º–µ—Ä, —è–∑—ã–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —á–∞—Å–æ–≤–æ–≥–æ –ø–æ—è—Å–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –≥—Ä—É–ø–ø.

–ü–æ—Å–∫–æ–ª—å–∫—É —ç—Ç–∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –º–µ–Ω—è—é—Ç—Å—è —Ä–µ–¥–∫–æ, –æ–Ω–∏ –±—É–¥—É—Ç –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å—Å—è –≤ —Ä–∞–º–∫–∞—Ö —Å—Ç–∞–¥–∏–∏ _beforeInstall_ –Ω–∞ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä–∏–æ–¥.

#### install

–î–∞–Ω–Ω–∞—è —Å—Ç–∞–¥–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –∞ —Ç–∞–∫–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫.

–ù–∞ –¥–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø –∫ –∏—Å—Ö–æ–¥–Ω–æ–º—É –∫–æ–¥—É –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ (–¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `git`) –∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ manifest-—Ñ–∞–π–ª–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–∞–∫–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –∫–∞–∫ Composer, Gradle, npm –∏ —Ç.–¥. –ü–æ—Å–∫–æ–ª—å–∫—É —Å–±–æ—Ä–∫–∞ —Å—Ç–∞–¥–∏–∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç manifest-—Ñ–∞–π–ª–∞, –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –Ω–∞–∏–ª—É—á—à–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –≤–∞–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ manifest-—Ñ–∞–π–ª–∞—Ö —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –¥–ª—è —ç—Ç–æ–π —Å—Ç–∞–¥–∏–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Composer, —Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ `composer.lock` –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å—Ç–∞–¥–∏–∏ _beforeInstall_ –ø–æ–∑–≤–æ–ª–∏—Ç –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å —Å—Ç–∞–¥–∏—é –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞ `composer.lock`.

#### beforeSetup

–î–∞–Ω–Ω–∞—è —Å—Ç–∞–¥–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π.

–ù–∞ –¥–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ä–∞–∑–Ω–æ–≥–æ —Ä–æ–¥–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏—é –∏ –æ–±—Ä–∞–±–æ—Ç–∫—É.
–ù–∞–ø—Ä–∏–º–µ—Ä, –∫–æ–º–ø–∏–ª—è—Ü–∏—è jar-—Ñ–∞–π–ª–æ–≤, –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, —Ñ–∞–π–ª–æ–≤ –±–∏–±–ª–∏–æ—Ç–µ–∫, —Å–æ–∑–¥–∞–Ω–∏–µ –∞—Å—Å–µ—Ç–æ–≤ web-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –º–∏–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è, —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ç.–ø.
–ü–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –∫–æ–¥–µ, –∏ –Ω–∞ –¥–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ —Ç–∞–∫–∂–µ –≤–∞–∂–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –õ–æ–≥–∏—á–Ω–æ, —á—Ç–æ —Å—Ç–∞–¥–∏—è –±—É–¥–µ—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –±–æ–ª—å—à–µ–≥–æ —á–∏—Å–ª–∞ —Ñ–∞–π–ª–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, —á–µ–º –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å—Ç–∞–¥–∏–∏, –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –µ–µ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è —á–∞—â–µ.

–ü—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ —Å—Ç–∞–¥–∏–∏ _beforeSetup_, –∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ manifest-—Ñ–∞–π–ª–∞ –∫ —Å—Ç–∞–¥–∏–∏ _install_ –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞–¥–∏–π.

#### setup

–î–∞–Ω–Ω–∞—è —Å—Ç–∞–¥–∏—è –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

–û–±—ã—á–Ω–æ –Ω–∞ –¥–∞–Ω–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –ø–∞–ø–∫—É `/etc`), —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Ç.–¥.
–¢–∞–∫–æ–≥–æ —Ä–æ–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞—Ç—Ä–∞—Ç–Ω—ã–º–∏ –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —Ç.–∫. –æ–Ω–∏, —Å–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤ –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ —Å–±–æ—Ä–æ–∫.

#### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –∏–∑–ª–æ–∂–µ–Ω–Ω—É—é —á–µ—Ç–∫—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é —à–∞–±–ª–æ–Ω–∞ _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_ –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏, –ø–æ —Å—É—Ç–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –Ω–∏–∫–∞–∫–∏—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π. –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—Ç–∞–¥–∏–π —è–≤–ª—è–µ—Ç—Å—è –ª–∏—à—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–µ–π, –∫–æ—Ç–æ—Ä–∞—è –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –Ω–∞—à–µ–º –æ–ø—ã—Ç–µ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏. –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–Ω—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å—Ç–∞–¥–∏—é, –ª–∏–±–æ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤–æ—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö —Å —É—á–µ—Ç–æ–º –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π —Å–±–æ—Ä–∫–∏ –≤–∞—à–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### –°–∏–Ω—Ç–∞–∫—Å–∏—Å

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∞–¥–∏–∏ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –¥–≤—É—Ö –≤–∑–∞–∏–º–æ–∏—Å–∫–ª—é—á–∞—é—â–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤ ‚Äî `shell` –∏ `ansible`. –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–∑ –º–æ–∂–µ—Ç —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –ª–∏–±–æ –∏—Å–ø–æ–ª—å–∑—É—è —Å–±–æ—Ä–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ ***shell***, –ª–∏–±–æ –∑–∞–¥–∞—á–∏ ***ansible***, –æ–ø–∏—Å–∞–Ω–Ω—ã–µ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∏—Ä–µ–∫—Ç–∏–≤–∞—Ö.

–í –∫–∞–∂–¥–æ–π –¥–∏—Ä–µ–∫—Ç–∏–≤–µ –º–æ–∂–Ω–æ –æ–ø–∏—Å—ã–≤–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ:
- `beforeInstall`;
- `install`;
- `beforeSetup`;
- `setup`.

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—ã –≤–µ—Ä—Å–∏–π –∫—ç—à–∞ (***cacheVersion***), –∫–æ—Ç–æ—Ä—ã–µ –ø–æ —Å—É—Ç–∏ —è–≤–ª—è—é—Ç—Å—è —á–∞—Å—Ç—å—é –¥–∞–π–¥–∂–µ—Å—Ç–∞ –∫–∞–∂–¥–æ–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_. –ë–æ–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ [–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ](#–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å-–æ—Ç-–∑–Ω–∞—á–µ–Ω–∏—è-cacheversion).

### Shell

–°–∏–Ω—Ç–∞–∫—Å–∏—Å –æ–ø–∏—Å–∞–Ω–∏—è _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–±–æ—Ä–æ—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π _shell_:

```yaml
shell:
  beforeInstall:
  - <bash_command 1>
  - <bash_command 2>
  ...
  - <bash_command N>
  install:
  - bash command
  ...
  beforeSetup:
  - bash command
  ...
  setup:
  - bash command
  ...
  cacheVersion: <version>
  beforeInstallCacheVersion: <version>
  installCacheVersion: <version>
  beforeSetupCacheVersion: <version>
  setupCacheVersion: <version>
```

–°–±–æ—Ä–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ _shell_ ‚Äî —ç—Ç–æ –º–∞—Å—Å–∏–≤ Bash-–∫–æ–º–∞–Ω–¥ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_. –í—Å–µ –∫–æ–º–∞–Ω–¥—ã –æ–¥–Ω–æ–π —Å—Ç–∞–¥–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∫–∞–∫ –æ–¥–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `RUN` –≤ Dockerfile, —Ç.–µ. –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Å–ª–æ–π –Ω–∞ –∫–∞–∂–¥—É—é _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å—Ç–∞–¥–∏—é_.

werf –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª `bash`, –∏ –≤–∞–º –Ω–µ –Ω—É–∂–Ω–æ –æ—Ç–¥–µ–ª—å–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –µ–≥–æ –≤ –æ–±—Ä–∞–∑ (–∏–ª–∏ [–±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑]({{ "advanced/building_images_with_stapel/base_image.html" | true_relative_url }})) –ø—Ä–∏ —Å–±–æ—Ä–∫–µ.

–ü—Ä–∏–º–µ—Ä –æ–ø–∏—Å–∞–Ω–∏—è —Å—Ç–∞–¥–∏–∏ _beforeInstall_ —Å–æ–¥–µ—Ä–∂–∞—â–µ–π –∫–æ–º–∞–Ω–¥—ã `apt-get update` –∏ `apt-get install`:

```yaml
beforeInstall:
- apt-get update
- apt-get install -y build-essential g++ libcurl4
```

–ò—Å–ø–æ–ª–Ω—è–µ–º—ã–π —Ñ–∞–π–ª `bash` –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Docker-—Ç–æ–º–∞ _stapel_. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —ç—Ç—É –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å [–≤ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ](https://habr.com/company/flant/blog/352432/) (—É–ø–æ–º–∏–Ω–∞–µ–º—ã–π –≤ —Å—Ç–∞—Ç—å–µ `dappdeps` –±—ã–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `stapel`, –Ω–æ –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è)

### Ansible

–°–∏–Ω—Ç–∞–∫—Å–∏—Å –æ–ø–∏—Å–∞–Ω–∏—è _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–±–æ—Ä–æ—á–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π _ansible_:

```yaml
ansible:
  beforeInstall:
  - <ansible task 1>
  - <ansible task 2>
  ...
  - <ansible task N>
  install:
  - ansible task
  ...
  beforeSetup:
  - ansible task
  ...
  setup:
  - ansible task
  ...
  cacheVersion: <version>
  beforeInstallCacheVersion: <version>
  installCacheVersion: <version>
  beforeSetupCacheVersion: <version>
  setupCacheVersion: <version>
```

#### Ansible config –∏ stage playbook

–°–±–æ—Ä–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ _ansible_ ‚Äî —ç—Ç–æ –º–∞—Å—Å–∏–≤ Ansible-–∑–∞–¥–∞–Ω–∏–π –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_.

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `ansible.cfg` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Ansible:
- –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (transport = local);
- –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ callback –ø–ª–∞–≥–∏–Ω–∞ werf –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (stdout_callback = werf);
- –≤–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ü–≤–µ—Ç–∞ (force_color = 1);
- —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `sudo` –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `become` –≤ Ansible-–∑–∞–¥–∞–Ω–∏—è—Ö).

–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π `playbook.yml` ‚Äî playbook, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –≤—Å–µ –∑–∞–¥–∞–Ω–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_. –ü—Ä–∏–º–µ—Ä `werf.yaml` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º —Å—Ç–∞–¥–∏–∏ _install_:

```yaml
ansible:
  install:
  - debug: msg='Start install'
  - file: path=/etc mode=0777
  - copy:
      src: /bin/sh
      dest: /bin/sh.orig
  - apk:
      name: curl
      update_cache: yes
  ...
```

–ò—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ `ansible` –∏ `python` –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ Docker-—Ç–æ–º–∞ _stapel_. –ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —ç—Ç—É –∫–æ–Ω—Ü–µ–ø—Ü–∏—é –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å [–≤ —ç—Ç–æ–π —Å—Ç–∞—Ç—å–µ](https://habr.com/company/flant/blog/352432/) (—É–ø–æ–º–∏–Ω–∞–µ–º—ã–π –≤ —Å—Ç–∞—Ç—å–µ `dappdeps` –±—ã–ª –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ `stapel`, –Ω–æ –ø—Ä–∏–Ω—Ü–∏–ø —Å–æ—Ö—Ä–∞–Ω–∏–ª—Å—è)

#### –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –º–æ–¥—É–ª–∏

–û–¥–Ω–æ–π –∏–∑ –∫–æ–Ω—Ü–µ–ø—Ü–∏–π, –∫–æ—Ç–æ—Ä—É—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç werf, —è–≤–ª—è–µ—Ç—Å—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ –µ—Å–ª–∏ ¬´–Ω–∏—á–µ–≥–æ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å¬ª, —Ç–æ werf –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º –∏ –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∑–∞–ø—É—Å–∫–∞—Ö —Å–±–æ—Ä–∫–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–∑–¥–∞–≤–∞—Ç—å –±–∏–Ω–∞—Ä–Ω–æ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–µ –æ–±—Ä–∞–∑—ã. –í werf —ç—Ç–∞ –∑–∞–¥–∞—á–∞ —Ä–µ—à–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –ø–æ–¥—Å—á–µ—Ç–∞ _–¥–∞–π–¥–∂–µ—Å—Ç–æ–≤ —Å—Ç–∞–¥–∏–π_.

–ú–Ω–æ–≥–∏–µ –º–æ–¥—É–ª–∏ Ansible –Ω–µ —è–≤–ª—è—é—Ç—Å—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–º–∏, —Ç.–µ. –æ–Ω–∏ –º–æ–≥—É—Ç –¥–∞–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—É—Å–∫–æ–≤ –ø—Ä–∏ –Ω–µ–∏–∑–º–µ–Ω–Ω—ã—Ö –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö. –≠—Ç–æ, –∫–æ–Ω–µ—á–Ω–æ, –Ω–µ –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤—ã—Å—á–∏—Ç—ã–≤–∞—Ç—å _–¥–∞–π–¥–∂–µ—Å—Ç_ —Å—Ç–∞–¥–∏–∏, —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –µ—ë –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ –∏–∑-–∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π. –≠—Ç–æ –ø—Ä–∏–≤–µ–ª–æ –∫ —Ç–æ–º—É, —á—Ç–æ —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –º–æ–¥—É–ª–µ–π –±—ã–ª –æ–≥—Ä–∞–Ω–∏—á–µ–Ω.

–ù–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç, —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö –º–æ–¥—É–ª–µ–π Ansible —Å–ª–µ–¥—É—é—â–∏–π:

- [Commands modules](https://docs.ansible.com/ansible/2.5/modules/list_of_commands_modules.html): command, shell, raw, script.
- [Crypto modules](https://docs.ansible.com/ansible/2.5/modules/list_of_crypto_modules.html): openssl_certificate –∏ –¥—Ä—É–≥–∏–µ.
- [Files modules](https://docs.ansible.com/ansible/2.5/modules/list_of_files_modules.html): acl, archive, copy, stat, tempfile –∏ –¥—Ä—É–≥–∏–µ.
- [Net Tools Modules](https://docs.ansible.com/ansible/2.5/modules/list_of_net_tools_modules.html): get_url, slurp, uri.
- [Packaging/Language modules](https://docs.ansible.com/ansible/2.5/modules/list_of_packaging_modules.html#language): composer, gem, npm, pip –∏ –¥—Ä—É–≥–∏–µ.
- [Packaging/OS modules](https://docs.ansible.com/ansible/2.5/modules/list_of_packaging_modules.html#os): apt, apk, yum –∏ –¥—Ä—É–≥–∏–µ.
- [System modules](https://docs.ansible.com/ansible/2.5/modules/list_of_system_modules.html): user, group, getent, locale_gen, timezone, cron –∏ –¥—Ä—É–≥–∏–µ.
- [Utilities modules](https://docs.ansible.com/ansible/2.5/modules/list_of_utilities_modules.html): assert, debug, set_fact, wait_for.

–ü—Ä–∏ —É–∫–∞–∑–∞–Ω–∏–∏ –≤ _–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏_ –º–æ–¥—É–ª—è, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≤ –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º —Å–ø–∏—Å–∫–µ, —Å–±–æ—Ä–∫–∞ –ø—Ä–µ—Ä–≤–µ—Ç—Å—è —Å –æ—à–∏–±–∫–æ–π. –ù–µ —Å—Ç–µ—Å–Ω—è–π—Ç–µ—Å—å [—Å–æ–æ–±—â–∞—Ç—å](https://github.com/werf/werf/issues/new) –Ω–∞–º, –µ—Å–ª–∏ –≤—ã —Å—á–∏—Ç–∞–µ—Ç–µ —á—Ç–æ –∫–∞–∫–æ–π-–ª–∏–±–æ –º–æ–¥—É–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–∫–ª—é—á–µ–Ω –≤ —Å–ø–∏—Å–æ–∫ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã—Ö.

#### –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

–ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π —Å–ø–æ—Å–æ–± –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ –æ–±—Ä–∞–∑ ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ [_git mapping_]({{ "advanced/building_images_with_stapel/git_directive.html" | true_relative_url }}).
werf –Ω–µ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–ø–∏—Ä—É–µ–º—ã—Ö —Ñ–∞–π–ª–∞—Ö –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –º–æ–¥—É–ª—è `copy`.
–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–µ–≥–æ —Ñ–∞–π–ª–∞ –≤ –æ–±—Ä–∞–∑ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ—Ç–æ–¥ `.Files.Get` Go-—à–∞–±–ª–æ–Ω–∞.
–î–∞–Ω–Ω—ã–π –º–µ—Ç–æ–¥ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ —Å—Ç—Ä–æ–∫—É, —á—Ç–æ –¥–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–∞–∫ —á–∞—Å—Ç—å _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è –¥–∞–π–¥–∂–µ—Å—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞–¥–∏–∏, —á—Ç–æ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ –≤—Å–µ–π —Å—Ç–∞–¥–∏–∏.

–ü—Ä–∏–º–µ—Ä –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞ `nginx.conf` –≤ –æ–±—Ä–∞–∑:

{% raw %}
```yaml
ansible:
  install:
  - copy:
      content: |
{{ .Files.Get "/conf/etc/nginx.conf" | indent 8}}
      dest: /etc/nginx/nginx.conf
```
{% endraw %}

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏—Ç—Å—è –ø–æ–¥–æ–±–Ω—ã–π `playbook.yml`:

```yaml
- hosts: all
  gather_facts: no
  tasks:
    install:
    - copy:
        content: |
          http {
            sendfile on;
            tcp_nopush on;
            tcp_nodelay on;
            ...
```

#### –®–∞–±–ª–æ–Ω—ã Jinja

–í Ansible —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —à–∞–±–ª–æ–Ω–æ–≤ [Jinja](https://docs.ansible.com/ansible/2.5/user_guide/playbooks_templating.html) –≤ playbook'–∞—Ö. –û–¥–Ω–∞–∫–æ —É Go-—à–∞–±–ª–æ–Ω–æ–≤ –∏ Jinja-—à–∞–±–ª–æ–Ω–æ–≤ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å: {% raw %}`{{` –∏ `}}`{% endraw %}. –ß—Ç–æ–±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Jinja-—à–∞–±–ª–æ–Ω—ã –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ werf, –∏—Ö –Ω—É–∂–Ω–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å. –î–ª—è —ç—Ç–æ–≥–æ –µ—Å—Ç—å –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞: —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ {% raw %}`{{`{% endraw %}, –ª–∏–±–æ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞ Jinja.

–ù–∞–ø—Ä–∏–º–µ—Ä, —É –≤–∞—Å –µ—Å—Ç—å —Å–ª–µ–¥—É—é—â–∞—è –∑–∞–¥–∞—á–∞ Ansible:

{% raw %}
```yaml
- copy:
    src: {{item}}
    dest: /etc/nginx
    with_files:
    - /app/conf/etc/nginx.conf
    - /app/conf/etc/server.conf
```
{% endraw %}

{% raw %}
–¢–æ–≥–¥–∞, –≤—ã—Ä–∞–∂–µ–Ω–∏–µ Jinja-—à–∞–±–ª–æ–Ω–∞ `{{item}}` –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ:
{% endraw %}

{% raw %}
```yaml
# –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ {{.
src: {{"{{"}} item }}
```
–ª–∏–±–æ
```yaml
# –≠–∫—Ä–∞–Ω–∏—Ä—É–µ–º –≤—Å–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ.
src: {{`{{item}}`}}
```
{% endraw %}

#### –ü—Ä–æ–±–ª–µ–º—ã —Å Ansible

- Live-–≤—ã–≤–æ–¥ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–¥—É–ª–µ–π `raw` –∏ `command`. –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç –≤—ã–≤–æ–¥ –∫–∞–Ω–∞–ª–æ–≤ `stdout` –∏ `stderr` –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∑–∞–¥–µ—Ä–∂–∫–∞–º –∏ —Å–∫–∞—á–∫–æ–æ–±—Ä–∞–∑–Ω–æ–º—É –≤—ã–≤–æ–¥—É.
- –ú–æ–¥—É–ª—å `apt` –ø–æ–¥–≤–∏—Å–∞–µ—Ç –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –≤–µ—Ä—Å–∏—è—Ö Debian –∏ Ubuntu. –ü—Ä–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–∞–∫–∂–µ –Ω–∞ –Ω–∞—Å–ª–µ–¥—É–µ–º—ã—Ö –æ–±—Ä–∞–∑–∞—Ö ([issue #645](https://github.com/werf/werf/issues/645)).

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ —Å–±–æ—Ä–æ—á–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ, –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –¥–æ—Å—Ç—É–ø–Ω—ã –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö —Å–±–æ—Ä–∫–∏. –ò—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å–±–æ—Ä–∫–∏ –∏ –≤—ã—Ç–µ–∫–∞—é—â–∏–º –∏–∑ —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞–º, –¥–∞–∂–µ –µ—Å–ª–∏ —Å–∞–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è —Å–µ—Ä–≤–∏—Å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –º–µ–Ω—è—é—Ç—Å—è.

–î–æ—Å—Ç—É–ø–Ω—ã —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
- `WERF_COMMIT_HASH`. –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è: `cda9d17265d174c62424e8f7b5e5640bf749c565`.
- `WERF_COMMIT_TIME_HUMAN`. –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è: `2022-01-24 17:26:19 +0300 +0300`.
- `WERF_COMMIT_TIME_UNIX`. –ü—Ä–∏–º–µ—Ä –∑–Ω–∞—á–µ–Ω–∏—è: `1643034379`.

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:
{% raw %}
```yaml
shell:
  install:
  - echo "Commands on the Install stage for $WERF_COMMIT_HASH"
```
{% endraw %}

–í –ø—Ä–∏–º–µ—Ä–µ –≤—ã—à–µ —Ö—ç—à —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞ –±—É–¥–µ—Ç –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω –≤ –∫–æ–º–∞–Ω–¥—É `echo ...`, –Ω–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç —ç—Ç–æ –≤ —Å–∞–º—ã–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –º–æ–º–µ–Ω—Ç ‚Äî –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π shell'–æ–º. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –ø–µ—Ä–µ—Å–±–æ—Ä–æ–∫ —Å–ª–æ—è install –Ω–∞ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –Ω–µ –±—É–¥–µ—Ç.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π

–û–¥–Ω–∞ –∏–∑ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π werf ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ _—Å—Ç–∞–¥–∏–∏_.
–ö–∞–∫ —É–∫–∞–∑–∞–Ω–æ [–≤ —Å—Ç–∞—Ç—å–µ]({{ "internals/stages_and_storage.html" | true_relative_url }}), —Å–±–æ—Ä–∫–∞ _—Å—Ç–∞–¥–∏–π_ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –æ–¥–Ω–∞ –∑–∞ –¥—Ä—É–≥–æ–π, –∏ –¥–ª—è –∫–∞–∂–¥–æ–π _—Å—Ç–∞–¥–∏–∏_ –≤—ã—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è _–¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏_. –£ _–¥–∞–π–¥–∂–µ—Å—Ç–æ–≤_ –µ—Å—Ç—å —Ä—è–¥ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—Ç–æ—Ä—ã—Ö _–¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏_ –º–µ–Ω—è–µ—Ç—Å—è, —á—Ç–æ —Å–ª—É–∂–∏—Ç –¥–ª—è werf —Å–∏–≥–Ω–∞–ª–æ–º –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ —Å—Ç–∞–¥–∏–∏ —Å –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–º _–¥–∞–π–¥–∂–µ—Å—Ç–æ–º_. –ü–æ—Å–∫–æ–ª—å–∫—É –∫–∞–∂–¥–∞—è —Å–ª–µ–¥—É—é—â–∞—è _—Å—Ç–∞–¥–∏—è_ –∏–º–µ–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∏ –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–µ–π _—Å—Ç–∞–¥–∏–∏_ —Å–æ–≥–ª–∞—Å–Ω–æ _–∫–æ–Ω–≤–µ–π–µ—Ä—É —Å—Ç–∞–¥–∏–π_, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–π–¥–∂–µ—Å—Ç–∞ –∫–∞–∫–æ–π-–ª–∏–±–æ _—Å—Ç–∞–¥–∏–∏_ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –∏ _—Å—Ç–∞–¥–∏–∏_ —Å –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–º –¥–∞–π–¥–∂–µ—Å—Ç–æ–º –∏ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö _—Å—Ç–∞–¥–∏–π_.

_–î–∞–π–¥–∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_ –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π:
- –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö —Å–±–æ—Ä–∫–∏;
- –≤ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞—Ö —Å–µ–º–µ–π—Å—Ç–≤–∞ _cacheVersion_;
- –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ (–∏–ª–∏ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö);
- –≤ —Ñ–∞–π–ª–∞—Ö, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∏–∑ [–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤]({{ "advanced/building_images_with_stapel/artifacts.html" | true_relative_url }}).

–ü–µ—Ä–≤—ã–µ —Ç—Ä–∏ –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –ø–æ–¥—Ä–æ–±–Ω–æ –¥–∞–ª–µ–µ.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö —Å–±–æ—Ä–∫–∏

_–î–∞–π–¥–∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, —Ç.–µ. –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞. –õ—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ç–µ–∫—Å—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å —É—á–µ—Ç–æ–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞ Go –∏–ª–∏ Jinja (–≤ —Å–ª—É—á–∞–µ Ansible) –≤ _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_ –ø—Ä–∏–≤–æ–¥—è—Ç –∫ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ _—Å—Ç–∞–¥–∏–∏_. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ _shell-–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏_:

```yaml
shell:
  beforeInstall:
  - echo "Commands on the Before Install stage"
  install:
  - echo "Commands on the Install stage"
  beforeSetup:
  - echo "Commands on the Before Setup stage"
  setup:
  - echo "Commands on the Setup stage"
```

–ü—Ä–∏ –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–µ —ç—Ç–æ–≥–æ –æ–±—Ä–∞–∑–∞ –±—É–¥—É—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω—ã –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—Å–µ—Ö —á–µ—Ç—ã—Ä–µ—Ö _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_.
–í –¥–∞–Ω–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –Ω–µ—Ç _git mapping_, —Ç–∞–∫ —á—Ç–æ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏ –Ω–µ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ –ø–æ–≤—Ç–æ—Ä–Ω–æ–º—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π ‚Äî _–¥–∞–π–¥–∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π_ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, —Å–±–æ—Ä–æ—á–Ω—ã–π –∫—ç—à —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é.

–ò–∑–º–µ–Ω–∏–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é —Å–±–æ—Ä–∫–∏ –¥–ª—è —Å—Ç–∞–¥–∏–∏ _install_:

```yaml
shell:
  beforeInstall:
  - echo "Commands on the Before Install stage"
  install:
  - echo "Commands on the Install stage"
  - echo "Installing ..."
  beforeSetup:
  - echo "Commands on the Before Setup stage"
  setup:
  - echo "Commands on the Setup stage"
```

–î–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ _install_ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å, –∏ –∑–∞–ø—É—Å–∫ werf –¥–ª—è —Å–±–æ—Ä–∫–∏ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å—Ç–∞–¥–∏–∏ _install_ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö _—Å—Ç–∞–¥–∏–π_, —Ç.–µ. _beforeSetup_ –∏ _setup_.

–î–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å—Å—è —Ç–∞–∫–∂–µ –∏–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ Go-—à–∞–±–ª–æ–Ω–æ–≤.
–ï—Å–ª–∏ –Ω–µ —É–¥–µ–ª—è—Ç—å —ç—Ç–æ–º—É –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ –ø—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, –º–æ–∂–Ω–æ —Å—Ç–æ–ª–∫–Ω—É—Ç—å—Å—è —Å –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º–∏ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞–º–∏ —Å—Ç–∞–¥–∏–π. –ù–∞–ø—Ä–∏–º–µ—Ä:

{% raw %}
```yaml
shell:
  beforeInstall:
  - echo "Commands on the Before Install stage for {{ env "CI_COMMIT_SHA‚Äù }}"
  install:
  - echo "Commands on the Install stage"
  ...
```
{% endraw %}

–ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ –≤—ã—Å—á–∏—Ç–∞–µ—Ç –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ _beforeInstall_ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–æ–º–∞–Ω–¥—ã (—Ö—ç—à –∫–æ–º–º–∏—Ç–∞, –∫–æ–Ω–µ—á–Ω–æ, –±—É–¥–µ—Ç –¥—Ä—É–≥–æ–π):
```shell
echo "Commands on the Before Install stage for 0a8463e2ed7e7f1aa015f55a8e8730752206311b"
```

–ü–æ—Å–ª–µ –æ—á–µ—Ä–µ–¥–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞, –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ _beforeInstall_ —É–∂–µ –±—É–¥–µ—Ç –¥—Ä—É–≥–æ–π (—Å –¥—Ä—É–≥–∏—Ö —Ö–µ—à–µ–º –∫–æ–º–º–∏—Ç–∞):

```shell
echo "Commands on the Before Install stage for 36e907f8b6a639bd99b4ea812dae7a290e84df27"
```

–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É—è –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `CI_COMMIT_SHA` –¥–∞–π–¥–∂–µ—Å—Ç —Å—Ç–∞–¥–∏–∏ _beforeInstall_ –±—É–¥–µ—Ç –º–µ–Ω—è—Ç—å—Å—è –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–º–∏—Ç–∞, —á—Ç–æ –±—É–¥–µ—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

<a class="google-drawings" href="{{ "images/configuration/assembly_instructions3.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/configuration/assembly_instructions3_preview.png" | true_relative_url }}" alt="–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏">
</a>

–ö–∞–∫ –æ–ø–∏—Å—ã–≤–∞–ª–æ—Å—å –≤ —Å—Ç–∞—Ç—å–µ [–ø—Ä–æ _git mapping_]({{ "advanced/building_images_with_stapel/git_directive.html" | true_relative_url }}), —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å—Ç–∞–¥–∏–∏ _gitArchive_ –∏ _gitLatestPatch_.
–°—Ç–∞–¥–∏—è _gitArchive_ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏ _beforeInstall_, –∞ —Å—Ç–∞–¥–∏—è _gitLatestPatch_ –ø–æ—Å–ª–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏ _setup_, –µ—Å–ª–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –µ—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.
–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —á—Ç–æ–±—ã –≤—ã–ø–æ–ª–Ω–∏—Ç—å —Å–±–æ—Ä–∫—É —Å –ø–æ—Å–ª–µ–¥–Ω–µ–π –≤–µ—Ä—Å–∏–µ–π –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞, –º–æ–∂–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å —Å—Ç–∞–¥–∏—é _beforeInstall_, –∏–∑–º–µ–Ω–∏–≤ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã _cacheVersion_ –ª–∏–±–æ –∏–∑–º–µ–Ω–∏–≤ —Å–∞–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å—Ç–∞–¥–∏–∏ _beforeInstall_.

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∞–¥–∏–∏ _install_, _beforeSetup_ –∏ _setup_ —Ç–∞–∫–∂–µ –º–æ–≥—É—Ç –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ (–µ—Å–ª–∏ —Ç–∞–∫–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞) Git-–ø–∞—Ç—á –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_, —á—Ç–æ–±—ã —Å–±–æ—Ä–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å —Å –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –≤–µ—Ä—Å–∏–µ–π –∫–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

> –í–æ –≤—Ä–µ–º—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∫–∏ –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è **—Ç–æ–ª—å–∫–æ –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–π —Å—Ç–∞–¥–∏–∏**, –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç–∞–¥–∏–∏, –∑–∞–≤–∏—Å—è—â–∏–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞, –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–∞–∫–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é —Ñ–∞–π–ª–æ–≤.
> –ü–µ—Ä–≤–∞—è —Å–±–æ—Ä–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª—ã –∏–∑ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –Ω–∞ —Å—Ç–∞–¥–∏–∏ _gitArchive_. –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å–±–æ—Ä–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç —Ñ–∞–π–ª—ã –Ω–∞ —Å—Ç–∞–¥–∏–∏ _gitCache_, _gitLatestPatch_ –∏–ª–∏ –Ω–∞ –æ–¥–Ω–æ–π –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π: _install_, _beforeSetup_, _setup_.
<br />
<br />
–ü—Ä–∏–º–µ—Ä —ç—Ç–æ–≥–æ —ç—Ç–∞–ø–∞ (—Ñ–∞–∑–∞ –ø–æ–¥—Å—á–µ—Ç–∞ –¥–∞–π–¥–∂–µ—Å—Ç–æ–≤, _calculating digests_):
![git files actualized on specific stage]({{ "images/build/git_mapping_updated_on_stage.png" | true_relative_url }})

–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `git.stageDependencies`. –°–∏–Ω—Ç–∞–∫—Å–∏—Å:

```yaml
git:
- ...
  stageDependencies:
    install:
    - <mask 1>
    ...
    - <mask N>
    beforeSetup:
    - <mask>
    ...
    setup:
    - <mask>
```

–£ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `git.stageDependencies` –≤–æ–∑–º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å 3 –∫–ª—é—á–∞: `install`, `beforeSetup` –∏ `setup`.
–ó–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–∞ ‚Äî –º–∞—Å—Å–∏–≤ –º–∞—Å–æ–∫ —Ñ–∞–π–ª–æ–≤, –æ—Ç–Ω–æ—Å—è—â–∏—Ö—Å—è –∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π —Å—Ç–∞–¥–∏–∏. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å—Ç–∞–¥–∏—è_ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç—Å—è, –µ—Å–ª–∏ –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥–ø–∞–¥–∞—é—â–∏–µ –ø–æ–¥ —É–∫–∞–∑–∞–Ω–Ω—É—é –º–∞—Å–∫—É.

–î–ª—è –∫–∞–∂–¥–æ–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_ werf —Å–æ–∑–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∞–¥–∞—é—â–∏—Ö –ø–æ–¥ –º–∞—Å–∫—É —Ñ–∞–π–ª–æ–≤ –∏ –≤—ã—á–∏—Å–ª—è–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É—é —Å—É–º–º—É –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ —Å —É—á–µ—Ç–æ–º –µ–≥–æ –∞—Ç—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ. –≠—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã —è–≤–ª—è—é—Ç—Å—è —á–∞—Å—Ç—å—é _–¥–∞–π–¥–∂–µ—Å—Ç–∞ —Å—Ç–∞–¥–∏–∏_, –ø–æ—ç—Ç–æ–º—É –ª—é–±–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –ø–æ–¥–ø–∞–¥–∞—é—â–µ–µ –ø–æ–¥ –º–∞—Å–∫—É, –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º _–¥–∞–π–¥–∂–µ—Å—Ç–∞ —Å—Ç–∞–¥–∏–∏_. –ö —ç—Ç–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –æ—Ç–Ω–æ—Å—è—Ç—Å—è: –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —Ñ–∞–π–ª–∞, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∞–¥–∞—é—â–µ–≥–æ –ø–æ–¥ –º–∞—Å–∫—É —Ñ–∞–π–ª–∞ –∏ —Ç.–ø.

–ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –º–∞—Å–∫–∏, —É–∫–∞–∑–∞–Ω–Ω–æ–π –≤ `git.stageDependencies`, —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `git.includePaths` –∏ `git.excludePaths` (—Å–º–æ—Ç—Ä–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ –Ω–∏—Ö [–≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ]({{ "advanced/building_images_with_stapel/git_directive.html#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ-—Ñ–∏–ª—å—Ç—Ä–æ–≤" | true_relative_url }})). werf —Å—á–∏—Ç–∞–µ—Ç –ø–æ–¥–ø–∞–¥–∞—é—â–∏–º–∏ –ø–æ–¥ –º–∞—Å–∫—É —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã, —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—É `includePaths` –∏ –ø–æ–¥–ø–∞–¥–∞—é—â–∏–µ –ø–æ–¥ –º–∞—Å–∫—É `stageDependencies`. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ werf —Å—á–∏—Ç–∞–µ—Ç –ø–æ–¥–ø–∞–¥–∞—é—â–∏–º–∏ –ø–æ–¥ –º–∞—Å–∫—É —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã, –Ω–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è—é—â–∏–µ —Ñ–∏–ª—å—Ç—Ä—É `excludePaths` –∏ –Ω–µ –ø–æ–¥–ø–∞–¥–∞—é—â–∏–µ –ø–æ–¥ –º–∞—Å–∫—É `stageDependencies`.

–ü—Ä–∞–≤–∏–ª–∞ –æ–ø–∏—Å–∞–Ω–∏—è –º–∞—Å–∫–∏ –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `stageDependencies` –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã –æ–ø–∏—Å–∞–Ω–∏—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `includePaths` –∏ `excludePaths`. –ú–∞—Å–∫–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —à–∞–±–ª–æ–Ω –¥–ª—è —Ñ–∞–π–ª–æ–≤ –∏ –ø—É—Ç–µ–π –∏ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–±–ª–æ–Ω—ã:

- `*` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –ª—é–±–æ–º—É —Ñ–∞–π–ª—É. –®–∞–±–ª–æ–Ω –≤–∫–ª—é—á–∞–µ—Ç `.` –∏ –∏—Å–∫–ª—é—á–∞–µ—Ç `/`.
- `**` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å–æ –≤—Å–µ–º –µ–µ —Å–æ–¥–µ—Ä–∂–∏–º—ã–º, —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ.
- `?` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –ª—é–±–æ–º—É –æ–¥–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É –≤ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ regexp-—à–∞–±–ª–æ–Ω—É `/.{1}/`).
- `[set]` ‚Äî –£–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –ª—é–±–æ–º—É —Å–∏–º–≤–æ–ª—É –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –Ω–∞–±–æ—Ä–∞ —Å–∏–º–≤–æ–ª–æ–≤. –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –≤ regexp-—à–∞–±–ª–æ–Ω–∞—Ö, –≤–∫–ª—é—á–∞—è —É–∫–∞–∑–∞–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤ —Ç–∏–ø–∞ `[^a-z]`.
- `\` ‚Äî –≠–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Å–∏–º–≤–æ–ª.


–ú–∞—Å–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å —à–∞–±–ª–æ–Ω–∞ `*` –∏–ª–∏ `**`, –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–∑—è—Ç–∞ –≤ –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ –∏–ª–∏ –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏ –≤ `werf.yaml`:

```
# * –≤ –Ω–∞—á–∞–ª–µ –º–∞—Å–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–≤–æ–π–Ω—ã–µ –∫–∞–≤—ã—á–∫–∏
- "*.rb"
# –æ–¥–∏–Ω–∞—Ä–Ω—ã–µ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞—é—Ç
- '**/*'
# –Ω–µ—Ç * –≤ –Ω–∞—á–∞–ª–µ, –º–æ–∂–Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–≤—ã—á–∫–∏
- src/**/*.js
```

–§–∞–∫—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ werf –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—è –∏—Ö –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã. –î–ª—è _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_ –∏ –¥–ª—è –∫–∞–∂–¥–æ–π –º–∞—Å–∫–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º:

- werf —Å–æ–∑–¥–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤ —Å–æ–≥–ª–∞—Å–Ω–æ –ø—É—Ç–∏, –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º—É –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `add`, –∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ñ–∏–ª—å—Ç—Ä—ã `excludePaths` –∏ `includePaths`;
- –ö –∫–∞–∂–¥–æ–º—É —Ñ–∞–π–ª—É —Å —É—á–µ—Ç–æ–º –µ–≥–æ –ø—É—Ç–∏ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –º–∞—Å–∫–∞, —Å–æ–≥–ª–∞—Å–Ω–æ –ø—Ä–∞–≤–∏–ª–∞–º –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–æ–≤;
- –ï—Å–ª–∏ –ø–æ–¥ –º–∞—Å–∫—É –ø–æ–¥–ø–∞–¥–∞–µ—Ç –∫–∞—Ç–∞–ª–æ–≥, —Ç–æ –≤—Å–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —ç—Ç–æ–≥–æ –∫–∞—Ç–∞–ª–æ–≥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø–æ–¥–ø–∞–¥–∞—é—â–µ–π –ø–æ–¥ –º–∞—Å–∫—É —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ;
- –£ –ø–æ–ª—É—á–∏–≤—à–µ–≥–æ—Å—è —Å–ø–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤ werf –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã —Å —É—á–µ—Ç–æ–º –∞—Ç—Ç—Ä–∏–±—É—Ç–æ–≤ —Ñ–∞–π–ª–æ–≤ –∏ –∏—Ö —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ.

–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –ø–æ–¥—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –≤–Ω–∞—á–∞–ª–µ —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∫–∞–∫–æ–π-–ª–∏–±–æ —Å—Ç–∞–¥–∏–∏.

–ü—Ä–∏–º–µ—Ä:

```yaml
image: app
git:
- add: /src
  to: /app
  stageDependencies:
    beforeSetup:
    - "*"
shell:
  install:
  - echo "install stage"
  beforeSetup:
  - echo "beforeSetup stage"
  setup:
  - echo "setup stage"
```

–í –ø—Ä–∏–≤–µ–¥–µ–Ω–Ω–æ–º —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `werf.yaml` —É–∫–∞–∑–∞–Ω _git mapping_, —Å–æ–≥–ª–∞—Å–Ω–æ –∫–æ—Ç–æ—Ä–æ–º—É —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –ø–∞–ø–∫–∏ `/src` –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–ø–∫—É `/app` —Å–æ–±–∏—Ä–∞–µ–º–æ–≥–æ –æ–±—Ä–∞–∑–∞.
–í–æ –≤—Ä–µ–º—è –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–∏ —Ñ–∞–π–ª—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ _gitArchive_ –∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —Å–±–æ—Ä–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å—Ç–∞–¥–∏–π _install_, _beforeSetup_ –∏ _setup_.

–°–±–æ—Ä–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ –∫–æ–º–º–∏—Ç–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∑–∞ –ø—Ä–µ–¥–µ–ª–∞–º–∏ –ø–∞–ø–∫–∏ `/src`, –Ω–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∫–∞–∫–∏—Ö-–ª–∏–±–æ —Å—Ç–∞–¥–∏–π. –ï—Å–ª–∏ –∫–æ–º–º–∏—Ç –±—É–¥–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤–Ω—É—Ç—Ä–∏ –ø–∞–ø–∫–∏ `/src`, –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã —Ñ–∞–π–ª–æ–≤ –ø–æ–¥–ø–∞–¥–∞—é—â–∏—Ö –ø–æ–¥ –º–∞—Å–∫—É –∏–∑–º–µ–Ω—è—Ç—Å—è, werf –ø—Ä–∏–º–µ–Ω–∏—Ç Git-–ø–∞—Ç—á –∏ –ø–µ—Ä–µ—Å–æ–±–µ—Ä—ë—Ç –≤—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å—Ç–∞–¥–∏–∏, –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å—Ç–∞–¥–∏–∏ _beforeSetup_, –∞ –∏–º–µ–Ω–Ω–æ ‚Äî _beforeSetup_ –∏ _setup_. –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Git-–ø–∞—Ç—á–∞ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ —Å—Ç–∞–¥–∏–∏ _beforeSetup_.

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è CacheVersion

–°—É—â–µ—Å—Ç–≤—É—é—Ç —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –∏–ª–∏ –∫–∞–∫—É—é-—Ç–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å—Ç–∞–¥–∏—é_. –≠—Ç–æ–≥–æ –º–æ–∂–Ω–æ –¥–æ—Å—Ç–∏—á—å, –∏–∑–º–µ–Ω—è—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `cacheVersion` –∏–ª–∏ `<user stage name>CacheVersion`.

–î–∞–π–¥–∂–µ—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏ _install_ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `installCacheVersion`. –ß—Ç–æ–±—ã –ø–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Å—Ç–∞–¥–∏—é _install_ (–∏ –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ —Å—Ç–∞–¥–∏–∏), –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `installCacheVersion`.

> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `cacheVersion` –∏ `beforeInstallCacheVersion` –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —ç—Ñ—Ñ–µ–∫—Ç ‚Äî –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —ç—Ç–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ —Å—Ç–∞–¥–∏–∏ _beforeInstall_ –∏ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö —Å—Ç–∞–¥–∏–π.

#### –ü—Ä–∏–º–µ—Ä: –û–±—â–∏–π –æ–±—Ä–∞–∑ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

–í—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–±—Ä–∞–∑, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –æ–±—â–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ñ–∞–π–ª–µ `werf.yaml`. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `cacheVersion` –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ —ç—Ç–æ–≥–æ –æ–±—Ä–∞–∑–∞, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –≤–µ—Ä—Å–∏–∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤.

```yaml
image: ~
from: ubuntu:latest
shell:
  beforeInstallCacheVersion: 2
  beforeInstall:
  - apt update
  - apt install ...
```

–≠—Ç–æ—Ç –æ–±—Ä–∞–∑ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –∫–∞–∫ –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –æ–±—Ä–∞–∑ —Å hub.docker.com –Ω–µ —É–¥–æ–≤–ª–µ—Ç–≤–æ—Ä—è–µ—Ç –≤–∞—à–∏–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º).

#### –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã _CacheVersion_ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–æ–≤–º–µ—Å—Ç–Ω–æ [—Å —à–∞–±–ª–æ–Ω–∞–º–∏ Go-—à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä–∞]({{ "reference/werf_yaml_template_engine.html" | true_relative_url }}), —á—Ç–æ–±—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_ –æ—Ç —Ñ–∞–π–ª–æ–≤, –Ω–µ –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è –≤ Git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

{% raw %}
```yaml
image: ~
from: ubuntu:latest
shell:
  installCacheVersion: {{.Files.Get "some-library-latest.tar.gz" | sha256sum}}
  install:
  - tar zxf some-library-latest.tar.gz
  - <build application>
```
{% endraw %}

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–∫—Ä–∏–ø—Ç –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ `some-library-latest.tar.gz` –∏ –∑–∞–ø—É—Å–∫–∞—Ç—å werf –¥–ª—è —Å–±–æ—Ä–∫–∏ —É–∂–µ –ø–æ—Å–ª–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–∞, —Ç–æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏ _install_ (–∏ –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö) –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ —Å–ª—É—á–∞–µ, –µ—Å–ª–∏ —Å–∫–∞—á–∞–Ω –Ω–æ–≤—ã–π (–∏–∑–º–µ–Ω–µ–Ω–Ω—ã–π) —Ñ–∞–π–ª.

## –£—Å–∫–æ—Ä–µ–Ω–∏–µ —Å–±–æ—Ä–∫–∏ –∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞ —Å—á—ë—Ç –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

–î–æ–≤–æ–ª—å–Ω–æ —á–∞—Å—Ç–æ –±—ã–≤–∞—é—Ç —Å–ª—É—á–∞–∏, –∫–æ–≥–¥–∞ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ —É –≤–∞—Å –ø–æ—è–≤–ª—è—é—Ç—Å—è —Ñ–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ—Å—Ç–∞–≤–ª—è—Ç—å –≤ –æ–±—Ä–∞–∑–µ, –∏ –∏—Ö –Ω—É–∂–Ω–æ –∏—Å–∫–ª—é—á–∏—Ç—å. –ù–∞–ø—Ä–∏–º–µ—Ä:
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ —Å–æ–∑–¥–∞—é—Ç –≤ —Å–∏—Å—Ç–µ–º–µ –∫—ç—à –ø–∞–∫–µ—Ç–æ–≤ –∏ —Å–ª—É–∂–µ–±–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
  - [APT](https://wiki.debian.org/Apt) —Ö—Ä–∞–Ω–∏—Ç —Å–ø–∏—Å–æ–∫ –ø–∞–∫–µ—Ç–æ–≤ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/var/lib/apt/lists/`.
  - APT —Ç–∞–∫–∂–µ —Ö—Ä–∞–Ω–∏—Ç —Å–∞–º–∏ –ø–∞–∫–µ—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/var/cache/apt/`.
  - [YUM](http://yum.baseurl.org/) –º–æ–∂–µ—Ç –æ—Å—Ç–∞–≤–ª—è—Ç—å —Å–∫–∞—á–∞–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `/var/cache/yum/.../packages/`.
- –ú–µ–Ω–µ–¥–∂–µ—Ä—ã –ø–∞–∫–µ—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏, —Ç–∞–∫–∏–µ –∫–∞–∫, ‚Äãnpm (Node.js), Glide (Go), pip (Python), —Ö—Ä–∞–Ω—è—Ç —Ñ–∞–π–ª—ã –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –∫—ç—à–∞.
- –ö–æ–º–ø–∏–ª—è—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –Ω–∞ C/C++ –∏ —Ç.–ø. —è–∑—ã–∫–∞—Ö –æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–±—ä–µ–∫—Ç–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ —Ç.–ø.

–¢–∞–∫–æ–≥–æ —Ä–æ–¥–∞ —Ñ–∞–π–ª—ã:
- –Ω–µ –Ω—É–∂–Ω—ã –≤ –æ–±—Ä–∞–∑–µ;
- –º–æ–≥—É—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞;
- –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã –ø—Ä–∏ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π —Å–±–æ—Ä–∫–µ –æ–±—Ä–∞–∑–∞ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö –æ–±—Ä–∞–∑–æ–≤.

–ï—Å–ª–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–∫–æ–≥–æ —Ä–æ–¥–∞ —Ñ–∞–π–ª—ã –≤ —Å–±–æ—Ä–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä, —Ç–æ –º–æ–∂–Ω–æ –¥–æ–±–∏—Ç—å—Å—è –Ω–µ —Ç–æ–ª—å–∫–æ —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞ –æ–±—Ä–∞–∑–∞, –Ω–æ –∏ —É—Å–∫–æ—Ä–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∫–∏. –í Docker —Ç–∞–∫–æ–π –º–µ—Ö–∞–Ω–∏–∑–º —Ä–µ–∞–ª–∏–∑—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é [—Ç–æ–º–æ–≤](https://docs.docker.com/storage/volumes/).

–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è —Ç–æ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∏—Ä–µ–∫—Ç–∏–≤–∞ `mount`. –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —É–∑–ª–∞ —Å–±–æ—Ä–∫–∏ –º–æ–Ω—Ç–∏—Ä—É—é—Ç—Å—è –≤ —Å–±–æ—Ä–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–æ–≥–ª–∞—Å–Ω–æ –¥–∏—Ä–µ–∫—Ç–∏–≤–∞–º `from`/`fromPath` –∏ `to` –æ–ø–∏—Å–∞–Ω–∏—è —Ç–æ–º–æ–≤. –î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–±–æ—Ä–æ—á–Ω–æ–º —É–∑–ª–µ –ª—é–±–æ–≥–æ —Ñ–∞–π–ª–∞ –∏–ª–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—É `fromPath`. –õ–∏–±–æ, –∏—Å–ø–æ–ª—å–∑—É—è –¥–∏—Ä–µ–∫—Ç–∏–≤—É `from`, –≤—ã –º–æ–∂–µ—Ç–µ —É–∫–∞–∑–∞—Ç—å –æ–¥–Ω—É –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É–∂–µ–±–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π:
- `tmp_dir` –≤—Ä–µ–º–µ–Ω–Ω–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–∞—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–ø–∏—Å–∞–Ω–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞, —Å–æ–∑–¥–∞–≤–∞–µ–º–∞—è –∑–∞–Ω–æ–≤–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–±–æ—Ä–∫–µ;
- `build_dir` –æ–±—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è, –¥–æ—Å—Ç—É–ø–Ω–∞—è –≤—Å–µ–º –æ–±—Ä–∞–∑–∞–º –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º–∞—è –º–µ–∂–¥—É —Å–±–æ—Ä–∫–∞–º–∏ (–Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ –ø—É—Ç–∏ `~/.werf/shared_context/mounts/projects/<project name>/<mount id>/`). –í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –∫—ç—à–∞ –∏ —Ç.–ø.

> werf –º–æ–Ω—Ç–∏—Ä—É–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–π —Å–±–æ—Ä–∫–µ, –Ω–æ –≤ –æ–±—Ä–∞–∑–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —ç—Ç–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –Ω–µ –±—É–¥–µ—Ç. –ï—Å–ª–∏ –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∫–∞–∫–∏–µ-–ª–∏–±–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ —ç—Ç–∏—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ –æ–±—Ä–∞–∑–µ, —Ç–æ –≤—ã –¥–æ–ª–∂–Ω—ã –∏—Ö —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏ —Å–±–æ—Ä–∫–µ

–ù–∞ —Å—Ç–∞–¥–∏–∏ `from`, werf –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ª–µ–π–±–ª—ã –∫ –æ–±—Ä–∞–∑—É —Å—Ç–∞–¥–∏–∏, —Å–æ–≥–ª–∞—Å–Ω–æ –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è. –ó–∞—Ç–µ–º, –Ω–∞ –∫–∞–∂–¥–æ–π —Å—Ç–∞–¥–∏–∏, werf –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç–∏ –ª–µ–π–±–ª—ã –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π –≤ —Å–±–æ—Ä–æ—á–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä. –¢–∞–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç [–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞]({{ "advanced/building_images_with_stapel/base_image.html" | true_relative_url }}).

–¢–∞–∫–∂–µ, –Ω—É–∂–Ω–æ –∏–º–µ—Ç—å –≤ –≤–∏–¥—É, —á—Ç–æ –Ω–∞ —Å—Ç–∞–¥–∏–∏ `from` werf –æ—á–∏—â–∞–µ—Ç —Ç–æ—á–∫–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ [–±–∞–∑–æ–≤–æ–º –æ–±—Ä–∞–∑–µ]({{ "advanced/building_images_with_stapel/base_image.html" | true_relative_url }}) (—Ç.–µ. —ç—Ç–∏ –ø–∞–ø–∫–∏ –±—É–¥—É—Ç –ø—É—Å—Ç—ã).

> –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `fromPath` –∏ `from: build_dir` –∑–∞–ø—Ä–µ—â–µ–Ω–æ –≥–∏—Ç–µ—Ä–º–∏–Ω–∏–∑–º–æ–º (–ø–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± —ç—Ç–æ–º –≤ [—Å—Ç–∞—Ç—å–µ]({{ "/advanced/giterminism.html#mount" | true_relative_url }}))

## –ò–º–ø–æ—Ä—Ç –∏–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –∏ –æ–±—Ä–∞–∑–æ–≤

–ò–∑-–∑–∞ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–±–æ—Ä–∫–∏, –ª–∏–±–æ –ø—Ä–æ—Å—Ç–æ –∏–∑-–∑–∞ –∏—Å—Ö–æ–¥–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, —Ä–∞–∑–º–µ—Ä –∫–æ–Ω–µ—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –º–æ–∂–µ—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è –≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. –ó–∞—á–∞—Å—Ç—É—é —ç—Ç–∏ —Ñ–∞–π–ª—ã –Ω–µ –Ω—É–∂–Ω—ã –≤ –∫–æ–Ω–µ—á–Ω–æ–º –æ–±—Ä–∞–∑–µ. –î–ª—è —Ä–µ—à–µ–Ω–∏—è —Ç–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º, —Å–æ–æ–±—â–µ—Å—Ç–≤–æ Docker –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, —Å–±–æ—Ä–∫—É –∏ —É–¥–∞–ª–µ–Ω–∏–µ –Ω–µ–Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∑–∞ –æ–¥–∏–Ω —à–∞–≥.

–£—Å–ª–æ–≤–Ω—ã–π –ø—Ä–∏–º–µ—Ä:
```
RUN ‚Äúdownload-source && cmd && cmd2 && remove-source‚Äù
```

> –ê–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π –ø—Ä–∏–º–µ—Ä –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∏ –≤ werf. –î–ª—è —ç—Ç–æ–≥–æ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø–∏—Å–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ –æ–¥–Ω–æ–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_. –ü—Ä–∏–º–µ—Ä –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ _shell-—Å–±–æ—Ä—â–∏–∫–∞_ –¥–ª—è —Å—Ç–∞–¥–∏–∏ _install_ (–∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –∏ –¥–ª—è _ansible-—Å–±–æ—Ä—â–∏–∫–∞_):
```yaml
shell:
  install:
  - "download-source"
  - "cmd"
  - "cmd2"
  - "remove-source"
```

–û–¥–Ω–∞–∫–æ –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Ç–∞–∫–æ–≥–æ –º–µ—Ç–æ–¥–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç, –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–±–æ—Ä–∫–∏ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑.

–î—Ä—É–≥–æ–π —Å–ø–æ—Å–æ–± ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ multi-stage —Å–±–æ—Ä–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –Ω–∞—á–∏–Ω–∞—è —Å –≤–µ—Ä—Å–∏–∏ 17.05 Docker.

```
FROM node:latest AS storefront
WORKDIR /app
COPY react-app .
RUN npm install
RUN npm run build

FROM maven:latest AS appserver
WORKDIR /app
COPY . .
RUN mvn package

FROM java:8-jdk-alpine
COPY --from=storefront /app/react-app/build/ /static
COPY --from=appserver /app/target/AtSea-0.0.1-SNAPSHOT.jar /app/AtSea.jar
```

–°–º—ã—Å–ª —Ç–∞–∫–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º ‚Äî –æ–ø–∏—Å–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –∏ –≤—ã–±–æ—Ä–æ—á–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏–∑ –æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ –≤ –¥—Ä—É–≥–æ–π, –æ—Å—Ç–∞–≤–ª—è—è –≤—Å–µ —Ç–æ, —á—Ç–æ –Ω–µ –Ω—É–∂–Ω–æ –≤ –∫–æ–Ω–µ—á–Ω–æ–º –æ–±—Ä–∞–∑–µ.

werf –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç–∞–∫–æ–π-–∂–µ –ø–æ–¥—Ö–æ–¥, –Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º [_–æ–±—Ä–∞–∑–æ–≤_]({{ "reference/werf_yaml.html#—Å–µ–∫—Ü–∏—è-image" | true_relative_url }}) –∏ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤_.

> –ü–æ—á–µ–º—É werf –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç multi-stage —Å–±–æ—Ä–∫—É?
* –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏, –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å _–∏–º–ø–æ—Ä—Ç–∞_ –ø–æ—è–≤–∏–ª–∞—Å—å –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–Ω—å—à–µ —á–µ–º –≤ Docker –ø–æ—è–≤–∏–ª–∞—Å—å multi-stage —Å–±–æ—Ä–∫–∞.
* werf –¥–∞–µ—Ç –±–æ–ª—å—à–µ –≥–∏–±–∫–æ—Å—Ç–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–º–∏ –æ–±—Ä–∞–∑–∞–º–∏

–ò–º–ø–æ—Ä—Ç _—Ä–µ—Å—É—Ä—Å–æ–≤_ –∏–∑ _–æ–±—Ä–∞–∑–æ–≤_ –∏ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤_ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω –≤ –¥–∏—Ä–µ–∫—Ç–∏–≤–µ `import` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ [_–æ–±—Ä–∞–∑–∞_]({{ "reference/werf_yaml.html#—Å–µ–∫—Ü–∏—è-image" | true_relative_url }}) –∏–ª–∏ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_ –∫—É–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Ñ–∞–π–ª—ã. `import` ‚Äî –º–∞—Å—Å–∏–≤ –∑–∞–ø–∏—Å–µ–π, –∫–∞–∂–¥–∞—è –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

- `image: <image name>` –∏–ª–∏ `artifact: <artifact name>`: _–∏—Å—Ö–æ–¥–Ω—ã–π –æ–±—Ä–∞–∑_, –∏–º—è –æ–±—Ä–∞–∑–∞ –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–∞–ø–∫–∏.
- `stage: <stage name>`: _—Å—Ç–∞–¥–∏—è –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞_, –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–∞—è —Å—Ç–∞–¥–∏—è _–∏—Å—Ö–æ–¥–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞_ –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –≤—ã —Ö–æ—Ç–∏—Ç–µ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–∞–ø–∫–∏.
- `add: <absolute path>`: _–∏—Å—Ö–æ–¥–Ω—ã–π –ø—É—Ç—å_, –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏–ª–∏ –ø–∞–ø–∫–µ –≤ _–∏—Å—Ö–æ–¥–Ω–æ–º –æ–±—Ä–∞–∑–µ_ –¥–ª—è –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è.
- `to: <absolute path>`: _–ø—É—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è_, –∞–±—Å–æ–ª—é—Ç–Ω—ã–π –ø—É—Ç—å –≤ _–æ–±—Ä–∞–∑–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è_ (–∫—É–¥–∞ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è —Ñ–∞–π–ª—ã –∏–ª–∏ –ø–∞–ø–∫–∏). –í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ä–∞–≤–Ω—ã–º –∑–Ω–∞—á–µ–Ω–∏—é —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤ –ø–∞—Ä–∞–º–µ—Ç—Ä–µ `add`.
- `before: <install || setup>` or `after: <install || setup>`: _—Å—Ç–∞–¥–∏—è –æ–±—Ä–∞–∑–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è_ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞. –í –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç –≤–æ–∑–º–æ–∂–µ–Ω –∏–º–ø–æ—Ä—Ç —Ç–æ–ª—å–∫–æ –¥–æ/–ø–æ—Å–ª–µ —Å—Ç–∞–¥–∏–∏ _install_ –∏–ª–∏ _setup_.

–ü—Ä–∏–º–µ—Ä:
```yaml
import:
- artifact: application-assets
  add: /app/public/assets
  to: /var/www/site/assets
  after: install
- image: frontend
  add: /app/assets
  after: setup
```

–¢–∞–∫ –∂–µ –∫–∞–∫ –∏ –ø—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ _git mappings_ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –º–∞—Å–∫–∏ –≤–∫–ª—é—á–µ–Ω–∏—è –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫.
–î–ª—è —É–∫–∞–∑–∞–Ω–∏—è –º–∞—Å–∫–∏ –≤–∫–ª—é—á–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä `include_paths: []`, –∞ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è `exclude_paths: []`. –ú–∞—Å–∫–∏ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø—É—Ç–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–ø–∞—Ä–∞–º–µ—Ç—Ä `add`).
–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∏ –≥—Ä—É–ø–ø—É –¥–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `owner: <owner>` –∏ `group: <group>` —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ.
–≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º–æ–º—É –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –∫–æ–¥–∞ –∏–∑ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤, –∏ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø–æ—á–∏—Ç–∞—Ç—å –æ–± —ç—Ç–æ–º –≤ [—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–º —Ä–∞–∑–¥–µ–ª–µ]({{ "advanced/building_images_with_stapel/git_directive.html" | true_relative_url }}).

> –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø—É—Ç—å –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –∏ –ø—É—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–π –≤ _git mappings_ –Ω–µ –¥–æ–ª–∂–Ω—ã –ø–µ—Ä–µ—Å–µ–∫–∞—Ç—å—Å—è

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ–± –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤_ –º–æ–∂–Ω–æ —É–∑–Ω–∞—Ç—å –≤ [–æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç–∞—Ç—å–µ]({{ "advanced/building_images_with_stapel/artifacts.html" | true_relative_url }}).

## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã

### –ß—Ç–æ —Ç–∞–∫–æ–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã?

***–ê—Ä—Ç–µ—Ñ–∞–∫—Ç*** ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤ –¥—Ä—É–≥–∏—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞—Ö –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –æ–±—Ä–∞–∑–∞—Ö, –æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏. –ê—Ä—Ç–µ—Ñ–∞–∫—Ç –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –¥–ª—è –æ—Ç–¥–µ–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —Å–±–æ—Ä–∫–∏ –æ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–∏–º–µ—Ä–∞–º–∏ —Ç–∞–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤ –º–æ–≥—É—Ç –±—ã—Ç—å ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã –¥–ª—è —Å–±–æ—Ä–∫–∏, –Ω–æ –Ω–µ –Ω—É–∂–Ω—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –∏ —Ç.–ø.

–ò—Å–ø–æ–ª—å–∑—É—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã, –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–±–∏—Ä–∞—Ç—å –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ—à–∞—Ç—å, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–¥–∞—á–∏:
- –ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–∞–±–æ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –∫–∞–∂–¥—ã–π —Å–æ —Å–≤–æ–∏–º–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏, —Ç–æ –æ–±—ã—á–Ω–æ –≤–∞–º –ø—Ä–∏—Ö–æ–¥–∏—Ç—Å—è –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∫–∞–∂–¥—ã–π —Ä–∞–∑. –í–∞–º –±—ã —Ö–æ—Ç–µ–ª–æ—Å—å –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–º —ç—Ç–æ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –Ω—É–∂–Ω–æ.
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–±—Ä–∞–Ω—ã –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö.

–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ _—Ä–µ—Å—É—Ä—Å–æ–≤_ –∏–∑ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤_ —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é [–¥–∏—Ä–µ–∫—Ç–∏–≤—ã import]({{ "advanced/building_images_with_stapel/import_directive.html" | true_relative_url }}) –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ [_—Å–µ–∫—Ü–∏–∏ –æ–±—Ä–∞–∑–∞_]({{ "reference/werf_yaml.html#—Å–µ–∫—Ü–∏—è-image" | true_relative_url }}) –∏–ª–∏ _—Å–µ–∫—Ü–∏–∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_ –ø–æ—Ö–æ–∂–∞ –Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –æ–±—ã—á–Ω–æ–≥–æ _–æ–±—Ä–∞–∑–∞_. –ö–∞–∂–¥—ã–π _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç_ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–ø–∏—Å–∞–Ω –≤ —Å–≤–æ–µ–π —Å–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å–æ —Å—Ç–∞–¥–∏–µ–π _from_ (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —É–∫–∞–∑–∞–Ω–∏—è [–±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞]({{ "advanced/building_images_with_stapel/base_image.html" | true_relative_url }}) –∏ [–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è]({{ "advanced/building_images_with_stapel/mount_directive.html" | true_relative_url }})), –∞ —Ç–∞–∫–∂–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ [–∏–º–ø–æ—Ä—Ç–∞]({{ "advanced/building_images_with_stapel/import_directive.html" | true_relative_url }}) —Ç–æ—á–Ω–æ —Ç–∞–∫–∏–µ –∂–µ –∫–∞–∫ –∏ –ø—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏–∏ _–æ–±—Ä–∞–∑–∞_.

–°—Ç–∞–¥–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π Docker (`docker_instructions`) –∏ [—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤—ã]({{ "advanced/building_images_with_stapel/docker_directive.html" | true_relative_url }}) –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏–∏ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤_. _–ê—Ä—Ç–µ—Ñ–∞–∫—Ç_ ‚Äî —ç—Ç–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–±–æ—Ä–∫–∏, –∏ –≤—Å–µ —á—Ç–æ –æ—Ç –Ω–µ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —ç—Ç–æ ‚Äî —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ.

–û—Å—Ç–∞–ª—å–Ω—ã–µ _—Å—Ç–∞–¥–∏–∏_ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ–ø–∏—Å–∞–Ω–∏—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—é—Ç—Å—è –¥–∞–ª–µ–µ –ø–æ–¥—Ä–æ–±–Ω–æ.

#### –ò–º–µ–Ω–æ–≤–∞–Ω–∏–µ

<div class="summary" markdown="1">
```yaml
artifact: string
```
</div>

_–û–±—Ä–∞–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_ –æ–±—ä—è–≤–ª—è–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –¥–∏—Ä–µ–∫—Ç–∏–≤—ã `artifact`. –°–∏–Ω—Ç–∞–∫—Å–∏—Å: `artifact: string`. –¢–∞–∫ –∫–∞–∫ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å–∞–º–∏–º werf, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –∫–∞–∫–∏–µ-–ª–∏–±–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤, –≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ [–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –æ–±—ã—á–Ω—ã—Ö _–æ–±—Ä–∞–∑–æ–≤_]({{ "reference/werf_yaml.html#—Å–µ–∫—Ü–∏—è-image" | true_relative_url }}).

–ü—Ä–∏–º–µ—Ä:
```yaml
artifact: "application assets"
```

#### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –∏–∑ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤

<div class="summary">

<a class="google-drawings" href="{{ "images/configuration/stapel_artifact2.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/configuration/stapel_artifact2_preview.png" | true_relative_url }}">
</a>

</div>

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω—ã—Ö _–æ–±—Ä–∞–∑–æ–≤_, —É _–∫–æ–Ω–≤–µ–π–µ—Ä–∞ —Å—Ç–∞–¥–∏–π –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤_ –Ω–µ—Ç —Å—Ç–∞–¥–∏–π _gitCache_ –∏ _gitLatestPatch_.

> –í werf –¥–ª—è _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤_ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è—Ö. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é werf –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç –∫–∞–∫–∏–µ-–ª–∏–±–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏, –∫—ç—à–∏—Ä—É—è –æ–±—Ä–∞–∑ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–∏. –ù–æ –≤—ã –º–æ–∂–µ—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–∞–π–ª–æ–≤ –∏ –ø–∞–ø–æ–∫, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ–±—Ä–∞–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞ –±—É–¥–µ—Ç –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å—Å—è

–ß–∏—Ç–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Ä–∞–±–æ—Ç—É —Å _git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏_ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π [—Å—Ç–∞—Ç—å–µ]({{ "advanced/building_images_with_stapel/git_directive.html" | true_relative_url }}).

#### –ó–∞–ø—É—Å–∫ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π —Å–±–æ—Ä–∫–∏

<div class="summary">

<a class="google-drawings" href="{{ "images/configuration/stapel_artifact3.png" | true_relative_url }}" data-featherlight="image">
<img src="{{ "images/configuration/stapel_artifact3_preview.png" | true_relative_url }}">
</a>

</div>

–£ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ —Ç–æ—á–Ω–æ —Ç–∞–∫–æ–µ –∂–µ –∫–∞–∫ –∏ —É –æ–±—ã—á–Ω—ã—Ö –æ–±—Ä–∞–∑–æ–≤ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–∏–≤ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö —Å—Ç–∞–¥–∏–π ‚Äî _beforeInstall_, _install_, _beforeSetup_ –∏ _setup_.

–ï—Å–ª–∏ –≤ –¥–∏—Ä–µ–∫—Ç–∏–≤–µ `stageDependencies` –≤ –±–ª–æ–∫–µ git –¥–ª—è _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Å—Ç–∞–¥–∏–∏_ –Ω–µ —É–∫–∞–∑–∞–Ω–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∫–∞–∫–∏—Ö-–ª–∏–±–æ —Ñ–∞–π–ª–æ–≤, —Ç–æ –æ–±—Ä–∞–∑ –∫—ç—à–∏—Ä—É–µ—Ç—Å—è –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–π —Å–±–æ—Ä–∫–∏, –∏ –Ω–µ –±—É–¥–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å—Å—è –ø–æ–∫–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è _—Å—Ç–∞–¥–∏—è_ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ _stages storage_.

> –ï—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ —Å–æ–±–∏—Ä–∞—Ç—å –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –ø—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ git, –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å _stageDependency_ `**/*` –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π _–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π_ —Å—Ç–∞–¥–∏–∏. –ü—Ä–∏–º–µ—Ä –¥–ª—è —Å—Ç–∞–¥–∏–∏ _install_:
```yaml
git:
- to: /
  stageDependencies:
    install: "**/*"
```

–ß–∏—Ç–∞–π—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —Ä–∞–±–æ—Ç—É —Å _–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ —Å–±–æ—Ä–∫–∏_ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π [—Å—Ç–∞—Ç—å–µ]({{ "advanced/building_images_with_stapel/assembly_instructions.html" | true_relative_url }}).

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

–í –æ—Ç–ª–∏—á–∏–µ –æ—Ç [*–æ–±—ã—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞*]({{ "advanced/building_images_with_stapel/assembly_instructions.html" | true_relative_url }}), —É *–æ–±—Ä–∞–∑–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞* –Ω–µ—Ç —Å—Ç–∞–¥–∏–∏ _git latest patch_. –≠—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ, —Ç.–∫. —Å—Ç–∞–¥–∏—è _git latest patch_ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –æ–±—ã—á–Ω–æ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∫–æ–º–º–∏—Ç–µ, –ø—Ä–∏–º–µ–Ω—è—è –ø–æ—è–≤–∏–≤—à–∏–µ—Å—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫ —Ñ–∞–π–ª–∞–º. –û–¥–Ω–∞–∫–æ *–∞—Ä—Ç–µ—Ñ–∞–∫—Ç* —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –æ–±—Ä–∞–∑ —Å –≤—ã—Å–æ–∫–æ–π –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–¥–∫–æ –∏–ª–∏ –Ω–µ—á–∞—Å—Ç–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤).

–ü—Ä–∏–º–µ—Ä: –Ω—É–∂–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ git, –∏ –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å –∞—Å—Å–µ—Ç—ã —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –∏–∑–º–µ–Ω—è—é—Ç—Å—è –≤–ª–∏—è—é—â–∏–µ –Ω–∞ —Å–±–æ—Ä–∫—É –∞—Å—Å–µ—Ç–æ–≤ —Ñ–∞–π–ª—ã. –¢.–µ. –≤ —Å–ª—É—á–∞–µ, –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–∞–∫–∏—Ö-–ª–∏–±–æ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–æ–≤ –≤ git, –∞—Å—Å–µ—Ç—ã –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞—Ç—å—Å—è –Ω–µ –¥–æ–ª–∂–Ω—ã.

–ö–æ–Ω–µ—á–Ω–æ, —Å—É—â–µ—Å—Ç–≤—É—é—Ç —Å–ª—É—á–∞–∏ –∫–æ–≥–¥–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–∫–ª—é—á–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –ª—é–±—ã—Ö —Ñ–∞–π–ª–æ–≤ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è –≤ _–æ–±—Ä–∞–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å–±–æ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–∞ Go). –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–¥–∏–∏ (—Å–±–æ—Ä–∫—É –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ git) —Å –ø–æ–º–æ—â—å—é `git.stageDependencies` –∏ `*` –≤ –∫–∞—á–µ—Å—Ç–≤–µ —à–∞–±–ª–æ–Ω–∞. –ü—Ä–∏–º–µ—Ä:

```yaml
git:
- add: /
  to: /app
  stageDependencies:
    setup:
    - "*"
```

–í —ç—Ç–æ–º —Å–ª—É—á–∞–µ –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –≤ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –±—É–¥—É—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –∫ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–µ _–æ–±—Ä–∞–∑–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_, –∏ –≤—Å–µ—Ö _–æ–±—Ä–∞–∑–æ–≤_, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ–ø—Ä–µ–¥–µ–ª–µ–Ω –∏–º–ø–æ—Ä—Ç —ç—Ç–æ–≥–æ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞.

**–ó–∞–º–µ—á–∞–Ω–∏–µ:** –ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–∞–∫–∏–µ-–ª–∏–±–æ —Ñ–∞–π–ª—ã –∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ _–∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞_ –∏ –ø—Ä–∏ —Å–±–æ—Ä–∫–µ [*–æ–±—ã—á–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞*]({{ "advanced/building_images_with_stapel/assembly_instructions.html" | true_relative_url }}), –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–∏–≤—É `git.add` –ø—Ä–∏ –æ–ø–∏—Å–∞–Ω–∏–∏ –∫–∞–∂–¥–æ–≥–æ –æ–±—Ä–∞–∑–∞, –≥–¥–µ —ç—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —Ç.–µ. –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑. **–ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π** –≤–∞—Ä–∏–∞–Ω—Ç ‚Äî –¥–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã –ø—Ä–∏ —Å–±–æ—Ä–∫–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞, –∞ –ø–æ—Ç–æ–º –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –∏—Å–ø–æ–ª—å–∑—É—è –¥–∏—Ä–µ–∫—Ç–∏–≤—É `import` –≤ –¥—Ä—É–≥–æ–π –æ–±—Ä–∞–∑.


# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SSH-–∞–≥–µ–Ω—Ç–æ–º

werf –Ω–µ–æ–±—Ö–æ–¥–∏–º ssh-–∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —Å–ª–µ–¥—É—é—â–∏—Ö —Å–ª—É—á–∞—è—Ö:

1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –≤ —Ñ–∞–π–ª–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ `werf.yaml`.
1. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞ —Ç—Ä–µ–±—É—é—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–Ω–µ—à–Ω–∏–º –¥–∞–Ω–Ω—ã–º –ø–æ ssh.

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é (–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –∫–∞–∫–∏—Ö-–ª–∏–±–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤) werf –ø—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ssh-agent –∑–∞–ø—É—â–µ–Ω–Ω—ã–π –≤ —Å–∏—Å—Ç–µ–º–µ, –ø—Ä–æ–≤–µ—Ä—è—è –µ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å –ø–æ–º–æ—â—å—é –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `SSH_AUTH_SOCK`.

–í —Å–ª—É—á–∞–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤ —Å–∏—Å—Ç–µ–º–µ –∑–∞–ø—É—â–µ–Ω–Ω–æ–≥–æ ssh-–∞–≥–µ–Ω—Ç–∞, werf –ø—ã—Ç–∞–µ—Ç—Å—è –≤—ã—Å—Ç—É–ø–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ ssh-–∫–ª–∏–µ–Ω—Ç–∞, –¥–ª—è —á–µ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ssh-–∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, —Ç.–µ. (`~/.ssh/id_rsa|id_dsa`). –ï—Å–ª–∏ werf –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ —ç—Ç–∏—Ö —Ñ–∞–π–ª–æ–≤, —Ç–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∑–∞–ø—É—Å–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ ssh-–∞–≥–µ–Ω—Ç–∞ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π.

–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö ssh-–∫–ª—é—á–µ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑—ã–≤–∞—Ç—å –æ–ø—Ü–∏—é –∑–∞–ø—É—Å–∫–∞ `--ssh-key PRIVATE_KEY_FILE_PATH` (–º–æ–∂–µ—Ç –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑, –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö ssh-–∫–ª—é—á–µ–π). –í —ç—Ç–æ–º —Å–ª—É—á–∞–µ werf –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–ø—É—Å–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ ssh-–∞–≥–µ–Ω—Ç–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –µ–º—É —Ç–æ–ª—å–∫–æ —É–∫–∞–∑–∞–Ω–Ω—ã–µ ssh-–∫–ª—é—á–∏.

## –ö–∞–∫ werf —Ä–∞–±–æ—Ç–∞–µ—Ç —Å ssh-–∞–≥–µ–Ω—Ç–æ–º

–ü—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —É–¥–∞–ª–µ–Ω–Ω—ã–º–∏ git-—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è UNIX-—Å–æ–∫–µ—Ç `SSH_AUTH_SOCK`, –∫–æ—Ç–æ—Ä—ã–π –º–æ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –≤–æ –≤—Å–µ —Å–±–æ—Ä–æ—á–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, —Å–±–æ—Ä–æ—á–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ssh-–∞–≥–µ–Ω—Ç —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞–Ω–Ω—ã–π UNIX-—Å–æ–∫–µ—Ç.

**–ó–ê–ú–ï–ß–ê–ù–ò–ï** –°—É—â–µ—Å—Ç–≤—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ç–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `root` –≤–Ω—É—Ç—Ä–∏ —Å–±–æ—Ä–æ—á–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ UNIX-—Å–æ–∫–µ—Ç—É –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è `SSH_AUTH_SOCK`.

## –í—Ä–µ–º–µ–Ω–Ω—ã–π ssh-–∞–≥–µ–Ω—Ç

werf –º–æ–∂–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–π ssh-–∞–≥–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–∞–Ω–¥. –¢–∞–∫–æ–π ssh-–∞–≥–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Ä–∞–±–æ—Ç—É –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–æ–º–∞–Ω–¥—ã werf.
–í —Å–ª—É—á–∞–µ –µ—Å–ª–∏ –≤ —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å –∑–∞–ø—É—â–µ–Ω–Ω—ã–π ssh-–∞–≥–µ–Ω—Ç, —Ç–æ –∑–∞–ø—É—Å–∫–∞–µ–º—ã–π werf –≤—Ä–µ–º–µ–Ω–Ω—ã–π ssh-–∞–≥–µ–Ω—Ç –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç —Å –∑–∞–ø—É—â–µ–Ω–Ω—ã–º –≤ —Å–∏—Å—Ç–µ–º–µ ssh-–∞–≥–µ–Ω—Ç–æ–º.
